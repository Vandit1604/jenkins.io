<!DOCTYPE html>
<html lang="en">
<head>
<title>
Using new core APIs with the Beta annotation
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2018/04/30/using-the-beta-annotation/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="Using new core APIs with the Beta annotation" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Using new core APIs with the Beta annotation" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Using new core APIs with the Beta annotation" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2018/04/30/using-the-beta-annotation/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="Using new core APIs with the Beta annotation" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.app-post-page h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<article class="container app-post-page">
<div class="app-!-display-flex">
<a class="app-back-link" href="/jenkins.io/independent-scrolling-patch/node/">
Back to blog
</a>
</div>
<h1>
Using new core APIs with the Beta annotation
</h1>
<div class="post-attrs">
<a class="app-author-link" href="/blog/authors/jglick/"><div class="app-avatar"></div> Jesse Glick</a>
April 30, 2018
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/intent/tweet?text=Using+new+core+APIs+with+the+Beta+annotation&amp;url=https%3A%2F%2Fwww.jenkins.io%2Fjenkins.io%2Findependent-scrolling-patch%2Fblog%2F2018%2F04%2F30%2Fusing-the-beta-annotation%2F" rel="noreferrer nofollow" target="_blank">
Tweet
</a>
</div>
<div class="blog-content">
<div class="paragraph">
<p>This sort of slid under the radar in the middle of some bigger changes
for the <a href="https://github.com/jenkinsci/jep/tree/master/jep/202">JEP-202</a>
reference implementation, so I wanted to call it out now. Arguably this could
deserve a retroactive JEP, though I would rather fold it into a JEP for
<a href="https://issues.jenkins.io/browse/JENKINS-49651">JENKINS-49651</a> (see below).</p>
</div>
<div class="paragraph">
<p>As of Jenkins 2.118, or plugin parent POM 3.7, you can mark any Java member
(<code>class</code>, <code>method</code>, <code>constructor</code>, <code>field</code>, or I suppose also interface,
<code>enum</code>, or <code>annotation</code>) with API visibility (<code>protected</code> or <code>public</code>) with an
<a href="https://github.com/kohsuke/access-modifier/pull/11">annotation</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><span class="nd">@Restricted</span><span class="o">(</span><span class="nc">Beta</span><span class="o">.</span><span class="na">class</span><span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The idea is to announce to potential users of the member that the API
may still be in flux and only code prepared to keep up should be using
it. For an example, 2.118 added a <code>VirtualFile.toExternalURL()</code> method
that is being implemented in <code>artifact-manager-s3</code> and (pending some
PR merges) called in <code>copyartifact</code> and <code>workflow-basic-steps</code>. We do
not necessarily want this to be called yet by unknown parties out
there in the Jenkins ecosystem. To enforce that, any attempt to call
or implement <code>toExternalURL</code> will produce a build failure, unless you
add this property to your plugin POM, as these plugins have done:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="xml"><span class="nt">&lt;useBeta&gt;</span>true<span class="nt">&lt;/useBeta&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Why? Because there is a chance the design is wrong and it might need
to be changed—perhaps some upcoming bug fix would demand a <code>boolean</code>
parameter be added, for example.</p>
</div>
<div class="paragraph">
<p>Under the conventional notion of Jenkins API deprecation and compatibility
policy, once an API like this makes it into a release version, that is it—we
might mark it <code>@Deprecated</code> but we need to maintain compatibility indefinitely,
and find some way to migrate existing implementations / call sites.</p>
</div>
<div class="paragraph">
<p>With the <code>@Beta</code> annotation, that promise is not being made. If it needs
a <code>boolean</code> parameter for some reason, that will be added and those
three plugins updated to match; we are not going to bother retaining
the original overload and somehow delegating to the new one. This
simplification of the developer workflow is important to the use cases
of <a href="https://github.com/jenkins-infra/evergreen">Essentials</a> (JEP-3xx), and I would expect the <code>useBeta</code> mark to
become widespread among plugins included in Essentials. Such as the situation
where one team needs to feel
comfortable refactoring code under its aegis freely, and the refactored result
should be deliverable as a unit to production via the Evergreen distribution
system.</p>
</div>
<div class="paragraph">
<p>So that leaves two important questions:</p>
</div>
<div class="paragraph">
<p><strong>First</strong>, is the annotation
permanent, and if not, when should it be removed? I do not think there
is any hard policy, but the intention is that it should be removed
once the API is in more or less widespread use and has held up. For
this example, if people start using S3 artifacts, and especially if
someone successfully writes an implementation of artifact storage in
Azure that uses the API, the concept will have been reasonably proven.
At that point we want the API to be used wherever it would make sense,
and if there is some very belated realization that the design is not
quite right, we accept the burden of deprecating the original and
migrating callers compatibly.</p>
</div>
<div class="paragraph">
<p><strong>Second</strong>, it is fine and well to say that someone changing the signature
of a beta <code>toExternalURL</code> is on the hook to update the three plugins
using it, but what if a Jenkins admin (<em>not</em> running Essentials, for
shame) upgrades to (say) Jenkins 2.125 with the new signature but
declines to accept the updates to those plugins (say,
<code>workflow-basic-steps</code> 2.9) which adapt to the change? It is not
enough to say that it is their fault for holding back on the updates
arbitrarily; the plugin manager <em>offers</em> you updates but does nothing
to tell you when they are <em>required</em>, so suddenly throwing
<code>NoSuchMethodError</code> is not a helpful response.</p>
</div>
<div class="paragraph">
<p>The solution needs to be ironed out, but my expectation is to use
<a href="https://issues.jenkins.io/browse/JENKINS-49651">JENKINS-49651</a>
for this. For example, <code>workflow-basic-steps</code> 2.8,
using <code>toExternalURL()</code>, would have declared itself compatible with
<code>Jenkins-Version: 2.118</code>, and thus implicitly anything newer. The
developer doing the refactoring would also amend some 2.125 (and
newer) core metadata to say that it conflicts with anything older than
the 2.9 release of the plugin. The plugin manager would therefore
block the 2.8 plugin from even being loaded on the 2.125 core; the
admin would need to update before using it. In the case of an
incompatible change made to a plugin API, rather than a core API, the
UX is a little smoother since the plugin manager could just refuse to
let you update one without the other.</p>
</div>
<hr>
<div class="paragraph">
<p>If you&#8217;re a plugin or core developer who is interested in using the <code>@Beta</code>
annotations, or have questions about our motiviations, please join the
discussion on
<a href="https://groups.google.com/d/msgid/jenkinsci-dev/CANfRfr0Ngpm_f-F_BhTzHijyPse7pMVT8-oVazHrO%3Di_d7ZR4A%40mail.gmail.com">this mailing list thread</a>.</p>
</div>
</div>
<ul class="app-tags">
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/core/">
core
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/developer/">
developer
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/plugin/">
plugin
</a>
</li>
</ul>
<h2>
About the author
</h2>
<!-- starting partial author.html.haml -->
<div class="app-author" id="about-the-author">
<!-- starting partial avatar.html.haml -->
<div class="app-avatar" style="min-width: 64px; width: 25vw; max-width: 128px"></div>

<!-- ending partial avatar.html.haml -->
<div class="app-author__content">
<p class="app-author__name">
<a href="/blog/authors/jglick/">
Jesse Glick
</a>
</p>
<div class="paragraph">
<p>Jesse has been developing Jenkins core and plugins for years.
He is the coauthor with Kohsuke of the core infrastructure of the Pipeline system.</p>
</div>
<!-- starting partial social-media-buttons.html.haml -->
<ul class="app-social-media-buttons">
<li>
<a href="https://github.com/jglick" rel="noreferrer noopener" target="_blank">
GitHub
</a>
</li>
<li>
<a href="https://twitter.com/tyvole" rel="noreferrer noopener" target="_blank">
Twitter
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</div>
</div>

<!-- ending partial author.html.haml -->
<!-- starting partial discuss.html.haml -->

<!-- ending partial discuss.html.haml -->
</article>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//blog/2018/04/2018-04-30-using-the-beta-annotation.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
