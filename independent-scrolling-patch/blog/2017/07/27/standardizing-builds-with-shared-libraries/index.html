<!DOCTYPE html>
<html lang="en">
<head>
<title>
Codifying the Build and Release Process with a Pipeline Shared Library
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2017/07/27/standardizing-builds-with-shared-libraries/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="Codifying the Build and Release Process with a Pipeline Shared Library" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Codifying the Build and Release Process with a Pipeline Shared Library" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Codifying the Build and Release Process with a Pipeline Shared Library" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2017/07/27/standardizing-builds-with-shared-libraries/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="Codifying the Build and Release Process with a Pipeline Shared Library" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.app-post-page h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<article class="container app-post-page">
<div class="app-!-display-flex">
<a class="app-back-link" href="/jenkins.io/independent-scrolling-patch/node/">
Back to blog
</a>
</div>
<h1>
Codifying the Build and Release Process with a Pipeline Shared Library
</h1>
<div class="post-attrs">
<a class="app-author-link" href="/blog/authors/rtyler/"><div class="app-avatar"><img alt="R. Tyler Croy" class="app-avatar__image" src="/images/avatars/rtyler.jpeg"></div> R. Tyler Croy</a>
July 27, 2017
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/intent/tweet?text=Codifying+the+Build+and+Release+Process+with+a+Pipeline+Shared+Library&amp;url=https%3A%2F%2Fwww.jenkins.io%2Fjenkins.io%2Findependent-scrolling-patch%2Fblog%2F2017%2F07%2F27%2Fstandardizing-builds-with-shared-libraries%2F" rel="noreferrer nofollow" target="_blank">
Tweet
</a>
</div>
<div class="blog-content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is a guest post by Alvin Huang, DevOps Engineer at
<a href="https://www.fireeye.com">FireEye</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As a security company, FireEye relentlessly protects our customers from cyber attacks. To act
quickly on intelligence and expertise learned, the feedback loop from the front lines to features
and capabilities in software must be small. Jenkins helps us achieve this by allowing us to build,
test, and deploy to our hardware and software platforms faster, so we can stop the bad guys
before they reach our customers.</p>
</div>
<div class="paragraph">
<p>More capabilities and functionalities in our product offerings means more applications and
systems, which means more software builds and jobs in Jenkins. Within the FaaS (FireEye as a
Service) organization, the tens of Jenkins jobs that were manageable manually in the web GUI
quickly grew to hundreds of jobs that required more automation. Along the way, we outgrew
our old legacy datacenter and were tasked with migrating 150+ Freestyle jobs on an old 1.x
Jenkins instance to a newer 2.x instance in the new datacenter in 60 days.</p>
</div>
<div class="paragraph">
<p>Copying Freestyle job XML configuration files to the new server would leave
technical debt.  Using Freestyle job templates would be better but for
complicated jobs that require multiple templates, this would still create large
dependency chains that would be hard to trace in the log output. Finally,
developers were not excited about having to replicate global changes, such as
add an email recipient when a new member joins the team, across tens of jobs
manually or using the
<a href="https://wiki.jenkins.io/display/JENKINS/Configuration+Slicing+Plugin">Configuration
Slicer</a>. We needed a way to migrate the jobs in a timely fashion while getting
rid of as much technical debt as possible.</p>
</div>
<div class="paragraph">
<p>Jenkins Pipeline to the rescue! In 2.0, Jenkins added the capability to create pipelines as first-
class entities. At FireEye, we leveraged many of the features available in pipeline to aid in the
migration process including the ability to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create Pipeline as Code in a <code>Jenkinsfile</code> stored in SCM</p>
</li>
<li>
<p>create Jenkins projects automatically when new branches or repos get added with a <code>Jenkinsfile</code></p>
</li>
<li>
<p>continue jobs after the Jenkins controller or build agent crashes</p>
</li>
<li>
<p>and most importantly, build a Pipeline
<a href="/doc/book/pipeline/shared-libraries">Shared Library</a> that keeps projects
<a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a> and
allows new applications to be on boarded into Jenkins within seconds</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, Jenkins Pipeline came with a DSL that our users would have to learn to translate their
Freestyle jobs to pipeline jobs. This would be a significant undertaking across multiple teams
just to create Jenkins jobs. Instead, the DevOps team identified similarities across all the
Freestyle jobs that we were migrating, learned the Jenkins DSL to become SMEs for the
organization, and built a shared library of functions and wrappers that saved each Dev/QA
engineer hours of time.</p>
</div>
<div class="paragraph">
<p>Below is an example function we created to promote builds in Artifactory:</p>
</div>
<div class="listingblock">
<div class="title">vars/promoteBuild.groovy</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="kt">def</span> <span class="nf">call</span><span class="o">(</span><span class="n">source_repo</span><span class="o">,</span> <span class="n">target_repo</span><span class="o">,</span> <span class="n">build_name</span><span class="o">,</span> <span class="n">build_number</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">stage</span><span class="o">(</span><span class="s1">'Promote to Production repo'</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">milestone</span> <span class="nl">label:</span> <span class="s1">'promote to production'</span>
        <span class="n">input</span> <span class="s1">'Promote this build to Production?'</span>

        <span class="n">node</span> <span class="o">{</span>
            <span class="n">Artifactory</span><span class="o">.</span><span class="na">server</span><span class="o">(</span><span class="n">getArtifactoryServerID</span><span class="o">()).</span><span class="na">promote</span><span class="o">([</span>
                <span class="s1">'buildName'</span>   <span class="o">:</span> <span class="n">build_name</span><span class="o">,</span>
                <span class="s1">'buildNumber'</span> <span class="o">:</span> <span class="n">build_number</span><span class="o">,</span>
                <span class="s1">'targetRepo'</span>  <span class="o">:</span> <span class="n">target_repo</span><span class="o">,</span>
                <span class="s1">'sourceRepo'</span>  <span class="o">:</span> <span class="n">source_repo</span><span class="o">,</span>
                <span class="s1">'copy'</span>        <span class="o">:</span> <span class="kc">true</span><span class="o">,</span>
            <span class="o">])</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kt">def</span> <span class="nf">call</span><span class="o">(</span><span class="n">source_repo</span><span class="o">,</span> <span class="n">target_repo</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">buildInfo</span> <span class="o">=</span> <span class="n">getBuildInfo</span><span class="o">()</span>

    <span class="n">call</span><span class="o">(</span><span class="n">source_repo</span><span class="o">,</span> <span class="n">target_repo</span><span class="o">,</span> <span class="n">buildInfo</span><span class="o">.</span><span class="na">name</span><span class="o">,</span> <span class="n">buildInfo</span><span class="o">.</span><span class="na">number</span><span class="o">)</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Rather than learning the Jenkins DSL and looking up how the Artifactory Plugin worked in
Pipeline, users could easily call this function and pass it parameters to do the promotion work
for them. In the Shared Library, we can also create build wrappers of opinionated workflows,
that encompasses multiple functions, based on a set of parameters defined in the Jenkinsfile.
In addition to migrating the jobs, we also had to migrate the build agents. No one knew the
exact list of packages, versions, and build tools installed on each build server, so rebuilding
them would be extremely difficult. Rather than copying the VMs or trying to figure out what
packages were on the build agents, we opted to use Docker to build containers with all
dependencies needed for an application.</p>
</div>
<div class="paragraph">
<p>I hope you will join me at my Jenkins World session:
<a href="https://jenkinsworld20162017.sched.com/event/ALOj/codifying-the-build-and-release-process-with-a-jenkins-pipeline-shared-library">Codifying the Build and Release Process with a Jenkins
Pipeline Shared Library</a>, as I deep dive into the inner workings of our Shared
Pipeline Library and explore how we integrated Docker into our CI/CD pipeline.
Come see how we can turn a <code>Jenkinsfile</code> with just a set of parameters like this:</p>
</div>
<div class="listingblock">
<div class="title">Jenkinsfile</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="n">standardBuild</span> <span class="o">{</span>
    <span class="n">machine</span>          <span class="o">=</span> <span class="s1">'docker'</span>
    <span class="n">dev_branch</span>       <span class="o">=</span> <span class="s1">'develop'</span>
    <span class="n">release_branch</span>   <span class="o">=</span> <span class="s1">'master'</span>
    <span class="n">artifact_apttern</span> <span class="o">=</span> <span class="s1">'*.rpm'</span>
    <span class="n">html_pattern</span>     <span class="o">=</span> <span class="o">[</span><span class="nl">keepAll:</span> <span class="kc">true</span><span class="o">,</span> <span class="nl">reportDir:</span> <span class="s1">'.'</span><span class="o">,</span> <span class="nl">reportFiles:</span> <span class="s1">'output.html'</span><span class="o">,</span> <span class="nl">reportName:</span> <span class="s1">'OutputReport'</span><span class="o">]</span>
    <span class="n">dev_repo</span>         <span class="o">=</span> <span class="s1">'pipeline-examples-dev'</span>
    <span class="n">prod_repo</span>        <span class="o">=</span> <span class="s1">'pipeline-examples-prod'</span>
    <span class="n">pr_script</span>        <span class="o">=</span> <span class="s1">'make prs'</span>
    <span class="n">dev_script</span>       <span class="o">=</span> <span class="s1">'make dev'</span>
    <span class="n">release_script</span>   <span class="o">=</span> <span class="s1">'make release'</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and a <code>Dockerfile</code> like this:</p>
</div>
<div class="listingblock">
<div class="title">Dockerfile</div>
<div class="content">
<pre class="rouge highlight nowrap"><code>FROM faas/el7-python:base

RUN yum install -y python-virtualenv \
        rpm-build &amp;&amp; \
        yum clean all</code></pre>
</div>
</div>
<div class="paragraph">
<p>Into a full Jenkins Pipeline like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/post-images/jenkinsworld2017/fireeye-pipeline.png" alt="Full Stage View">
</div>
</div>
<div class="paragraph">
<p>As we look ahead at FireEye, I will explore how the Shared Library sets us up for easier future
migrations of other tools such as Puppet, JIRA, and Artifactory, and easier integration with new
tools like Openshift. I will also cover our strategies for deployments and plans to move to
Declarative Pipeline.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Alvin will be
<a href="https://jenkinsworld20162017.sched.com/event/ALOj/codifying-the-build-and-release-process-with-a-jenkins-pipeline-shared-library">presenting</a>
more on this topic at
<a href="https://www.cloudbees.com/jenkinsworld/home">Jenkins World</a> in August,
register with the code <code>JWFOSS</code> for a 30% discount off your pass.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<ul class="app-tags">
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/event/">
event
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/JenkinsWorld/">
JenkinsWorld
</a>
</li>
</ul>
<h2>
About the author
</h2>
<!-- starting partial author.html.haml -->
<div class="app-author" id="about-the-author">
<!-- starting partial avatar.html.haml -->
<div class="app-avatar" style="min-width: 64px; width: 25vw; max-width: 128px">
<img alt="R. Tyler Croy" class="app-avatar__image" src="/jenkins.io/independent-scrolling-patch/images/avatars/rtyler.jpeg">
</div>

<!-- ending partial avatar.html.haml -->
<div class="app-author__content">
<p class="app-author__name">
<a href="/blog/authors/rtyler/">
R. Tyler Croy
</a>
</p>
<div class="paragraph">
<p>R&#46; Tyler Croy has been part of the Jenkins project for the past seven years.
While avoiding contributing any Java code, Tyler is involved in many of the
other aspects of the project which keep it running, such as this website,
infrastructure, governance, etc.</p>
</div>
<!-- starting partial social-media-buttons.html.haml -->
<ul class="app-social-media-buttons">
<li>
<a href="https://github.com/rtyler" rel="noreferrer noopener" target="_blank">
GitHub
</a>
</li>
<li>
<a href="https://twitter.com/agentdero" rel="noreferrer noopener" target="_blank">
Twitter
</a>
</li>
<li>
<a href="http://unethicalblogger.com" rel="noreferrer noopener" target="_blank">
Blog
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</div>
</div>

<!-- ending partial author.html.haml -->
<!-- starting partial discuss.html.haml -->

<!-- ending partial discuss.html.haml -->
</article>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//blog/2017/07/2017-07-27-standardizing-builds-with-shared-libraries.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
