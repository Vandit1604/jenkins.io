<!DOCTYPE html>
<html lang="en">
<head>
<title>
Limitations of Credentials Masking
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2019/02/21/credentials-masking/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="Limitations of Credentials Masking" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Limitations of Credentials Masking" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Limitations of Credentials Masking" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2019/02/21/credentials-masking/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="Limitations of Credentials Masking" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.app-post-page h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<article class="container app-post-page">
<div class="app-!-display-flex">
<a class="app-back-link" href="/jenkins.io/independent-scrolling-patch/node/">
Back to blog
</a>
</div>
<h1>
Limitations of Credentials Masking
</h1>
<div class="post-attrs">
<a class="app-author-link" href="/blog/authors/daniel-beck/"><div class="app-avatar"></div> Daniel Beck</a>
February 21, 2019
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/intent/tweet?text=Limitations+of+Credentials+Masking&amp;url=https%3A%2F%2Fwww.jenkins.io%2Fjenkins.io%2Findependent-scrolling-patch%2Fblog%2F2019%2F02%2F21%2Fcredentials-masking%2F" rel="noreferrer nofollow" target="_blank">
Tweet
</a>
</div>
<div class="blog-content">
<div class="paragraph">
<p>In the Jenkins project, we ask that people <a href="/security/#reporting-vulnerabilities">report security issues to our private issue tracker</a>.
This allows us to review issues and prepare fixes in private, often resulting in better, safer security fixes.</p>
</div>
<div class="paragraph">
<p>As a side effect of that, we also learn about common misconceptions and usability problems related to security in Jenkins.
This post is intended to address one of those:
The goal and limitations of credentials masking.</p>
</div>
<div class="sect1">
<h2 id="the-problem"><a class="anchor" href="#the-problem"></a>The Problem</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One very common example of that is the role of credentials masking in Jenkins, typically involving a pipeline snippet that looks like this:</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-script"
        style="display: true">
    <div class="title">Jenkinsfile (Scripted Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">withCredentials([usernamePassword(<span style="color:#606">credentialsId</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">topSecretCredentials</span><span style="color:#710">'</span></span>, <span style="color:#606">passwordVariable</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">PWD</span><span style="color:#710">'</span></span>, <span style="color:#606">usernameVariable</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">USR</span><span style="color:#710">'</span></span>)])
  sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">./deploy.sh</span><span style="color:#710">'</span></span> <span style="color:#777">// requires PWD and USR to be set</span>
}</code></pre>
</div></div></div>
<div class="paragraph">
<p>Credentials that are in scope are made available to the pipeline without limitation.
To prevent accidental exposure in the build log, credentials are masked from regular output, so an invocation of <code>env</code> (Linux) or <code>set</code> (Windows), or programs printing their environment or parameters would not reveal them in the build log to users who would not otherwise have access to the credentials.</p>
</div>
<div class="paragraph">
<p>The misconception here is that Jenkins will prevent other, perhaps deliberate ways to reveal the password.
Some examples:</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-script"
        style="display: true">
    <div class="title">Jenkinsfile (Scripted Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">withCredentials([usernamePassword(<span style="color:#606">credentialsId</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">topSecretCredentials</span><span style="color:#710">'</span></span>, <span style="color:#606">passwordVariable</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">PWD</span><span style="color:#710">'</span></span>, <span style="color:#606">usernameVariable</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">USR</span><span style="color:#710">'</span></span>)])
  sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">echo $PWD | base64</span><span style="color:#710">'</span></span> <span style="color:#777">// will print e.g. dDBwczNjcjN0Cg= which is trivially converted back to the top secret password</span>
}</code></pre>
</div></div></div>
<div class="pipeline-block">  <div class="listingblock pipeline-script"
        style="display: true">
    <div class="title">Jenkinsfile (Scripted Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">withCredentials([usernamePassword(<span style="color:#606">credentialsId</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">topSecretCredentials</span><span style="color:#710">'</span></span>, <span style="color:#606">passwordVariable</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">PWD</span><span style="color:#710">'</span></span>, <span style="color:#606">usernameVariable</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">USR</span><span style="color:#710">'</span></span>)])
  sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">echo $PWD &gt; myfile</span><span style="color:#710">'</span></span>
  archiveArtifacts <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">myfile</span><span style="color:#710">'</span></span> <span style="color:#777">// then browse archived artifacts from the Jenkins UI</span>
}</code></pre>
</div></div></div>
<div class="paragraph">
<p>Both of these snippets circumvent credentials masking in the build log, and show that people with control over the build script can use credentials in ways not necessarily intended or approved by admins.</p>
</div>
<div class="paragraph">
<p>Obviously these are just the most straightforward examples illustrating the problem.
Others could involve the proc file system, sending it to an HTTP server in response to a 401 authentication challenge, embedding it in the (otherwise legitimate) build result, etc.</p>
</div>
<div class="paragraph">
<p>It would be great if Jenkins could allow the flexible use of credentials with no risk of exposing them through straightforward build script modifications, but realistically, it is impossible for Jenkins to police use of the credential by a build script without the support of a very specific environment setup (e.g. restrictive network configuration).</p>
</div>
<div class="paragraph">
<p>It should also be noted that credentials aren&#8217;t just at risk from users able to control the pipeline, typically by editing the <code>Jenkinsfile</code>.
Actual build scripts invoked by pipelines, either shell scripts as in the example above, or more standard build tools such as Maven (controlled by <code>pom.xml</code>) are just as much of a risk if they are run inside a <code>withCredentials</code> block, or executing on the same agent as another block that passed such credentials.</p>
</div>
<div class="paragraph">
<p>Disclosure of secrets can also happen inadvertently:
Jenkins will prevent <em>exact</em> matches of the password or other secret to appear in the log file.
Consider that the secret may contain shell metacharacters that <code>bash +x</code> would escape by adding a <code>\</code> before those characters.
The sequence of characters to be printed is no longer identical to the secret, so would not be masked.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-solution"><a class="anchor" href="#the-solution"></a>The Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Credentials can be defined in different scopes:
Credentials defined on the root <em>Jenkins</em> store (the default) will be available to all jobs on the instance.
The only exception are credentials with <em>System</em> scope, intended for the global configuration only, for example, to connect to agents.
Credentials defined in a folder are only available within that folder (transitively, i.e. also in folders inside this folder).</p>
</div>
<div class="paragraph">
<p>This allows defining sensitive credentials, such as deployment credentials, on specific folders whose contents only users trusted with those credentials are allowed to configure:
Directly in Jenkins using <a href="https://plugins.jenkins.io/matrix-auth">Matrix Authorization Plugin</a> and by limiting write access to repositories defining pipelines as code.</p>
</div>
<div class="paragraph">
<p>Pipelines inside this folder can use the (e.g. deployment) credentials without limitation, while they&#8217;re inaccessible to pipelines outside the folder.
Those would need to use the <a href="https://plugins.jenkins.io/pipeline-build-step"><code>build</code> step</a> or similar approaches to invoke the pipelines inside the folder to deploy their output.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="caveats"><a class="anchor" href="#caveats"></a>Caveats</h2>
<div class="sectionbody">
<div class="paragraph">
<p>While the previous section outlines a solution to the problem of restricting access to credentials, care needs to be taken so that credentials are not captured anyway.
For example, a deployment pipeline that allows its users to define where to deploy to as a build parameter might still be used to send credentials to a maliciously set up host to capture them.
<a href="/blog/2018/05/15/incremental-deployment/">A blog post explaining the design of some Jenkins project infrastructure</a> discusses some of these concerns around trust.</p>
</div>
<div class="paragraph">
<p>It should also be noted that credential domains are a UI hint only&#8201;&#8212;&#8201;defining a credential to only be valid for <code>github.com</code> does not actually prevent its use elsewhere.</p>
</div>
</div>
</div>
</div>
<ul class="app-tags">
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/security/">
security
</a>
</li>
</ul>
<h2>
About the author
</h2>
<!-- starting partial author.html.haml -->
<div class="app-author" id="about-the-author">
<!-- starting partial avatar.html.haml -->
<div class="app-avatar" style="min-width: 64px; width: 25vw; max-width: 128px"></div>

<!-- ending partial avatar.html.haml -->
<div class="app-author__content">
<p class="app-author__name">
<a href="/blog/authors/daniel-beck/">
Daniel Beck
</a>
</p>
<div class="paragraph">
<p>Daniel is a Jenkins core maintainer and member of the <a href="/security/#team">Jenkins security team</a>.
He was the inaugural Jenkins security officer from 2015 to 2021.
He sometimes contributes to developer documentation and project infrastructure in his spare time.</p>
</div>
<!-- starting partial social-media-buttons.html.haml -->
<ul class="app-social-media-buttons">
<li>
<a href="https://github.com/daniel-beck" rel="noreferrer noopener" target="_blank">
GitHub
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</div>
</div>

<!-- ending partial author.html.haml -->
<!-- starting partial discuss.html.haml -->

<!-- ending partial discuss.html.haml -->
</article>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//blog/2019/02/2019-02-21-credentials-masking.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
