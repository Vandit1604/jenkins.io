<!DOCTYPE html>
<html lang="en">
<head>
<title>
Pipeline CPS Method Mismatches
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/doc/book/pipeline/cps-method-mismatches/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="Pipeline CPS Method Mismatches" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Pipeline CPS Method Mismatches" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Pipeline CPS Method Mismatches" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/doc/book/pipeline/cps-method-mismatches/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="Pipeline CPS Method Mismatches" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.container .row .col-lg-9 h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<div class="container">
<div class="row body flex-lg-nowrap">
<div class="col-lg-3" id="sidebar-menu">
<div class="sidebar-nav tour" id="sidebar-content">
<p>
<a href="/jenkins.io/independent-scrolling-patch/doc/" class="">> User Documentation Home</a>
</p>
<h5>
User Handbook
</h5>
<ul>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/getting-started/" class="">User Handbook Overview</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/installing/" class="">Installing Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/using/" class="">Using Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/" class="active">Pipeline</a>
<small>
<ul style="padding-left: 1rem;">
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/getting-started/" class="">Getting started with Pipeline</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/jenkinsfile/" class="">Using a Jenkinsfile</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/running-pipelines/" class="">Running Pipelines</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/multibranch/" class="">Branches and Pull Requests</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/docker/" class="">Using Docker with Pipeline</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/shared-libraries/" class="">Extending with Shared Libraries</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/development/" class="">Pipeline Development Tools</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/syntax/" class="">Pipeline Syntax</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/pipeline-best-practices/" class="">Pipeline Best Practices</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/scaling-pipeline/" class="">Scaling Pipelines</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/cps-method-mismatches/" class="active">Pipeline CPS Method Mismatches</a>
</li>
</ul>
</small>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/blueocean/" class="">Blue Ocean</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/" class="">Managing Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/security/" class="">Securing Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/system-administration/" class="">System Administration</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/scaling/" class="">Scaling Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/troubleshooting/" class="">Troubleshooting Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/glossary/" class="">Glossary</a>
</li>
</ul>
<h5>
Tutorials
</h5>
<ul>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/pipeline/tour/getting-started/" class="">Guided Tour</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/tutorials#pipeline" class="">Jenkins Pipeline</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/tutorials#tools" class="">Using Build Tools</a>
</li>
</ul>
<h5>
Resources
</h5>
<ul>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/syntax/" class="">Pipeline Syntax reference</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/pipeline/steps/" class="">Pipeline Steps reference</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/upgrade-guide/" class="">LTS Upgrade guides</a>
</li>
</ul>
</div>
</div>
<div class="col-lg-9">
<div>
<div class="row">
<div class="col-md-4">
<a class="prev doc-page-link" href="../scaling-pipeline">
⇐ Scaling Pipelines
</a>
</div>
<div class="col-md-4">
<a class="up doc-page-link" href="../">
⇑ Pipeline
</a>
<a class="index doc-page-link" href="../../">
Index
</a>
</div>
<div class="col-md-4">
<a class="next doc-page-link" href="../../blueocean">
Blue Ocean ⇒
</a>
</div>
</div>
</div>
<div>
<div class="row body">
<div class="section">
<h1>
Pipeline CPS Method Mismatches
</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#common-problems-and-solutions">Common problems and solutions</a>
<ul class="sectlevel2">
<li><a href="#use-of-pipeline-steps-fromnoncps">Use of Pipeline steps from <code>@NonCPS</code></a></li>
<li><a href="#calling-non-cps-transformed-methods-with-cps-transformed-arguments">Calling non-CPS-transformed methods with CPS-transformed arguments</a></li>
<li><a href="#constructors">Constructors</a></li>
<li><a href="#overrides-of-non-cps-transformed-methods">Overrides of non-CPS-transformed methods</a></li>
<li><a href="#PipelineCPSmethodmismatches-ClosuresinsideGString">Closures inside <code>GString</code> </a></li>
</ul>
</li>
<li><a href="#false-positives">False Positives</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Jenkins Pipeline uses a library called Groovy CPS to run Pipeline scripts.
While Pipeline uses the Groovy parser and compiler, unlike a regular Groovy environment it runs most of the program inside a special interpreter.
This uses a continuation-passing style (CPS) transform to turn your code into a version that can save its current state to disk (a file called <code>program.dat</code>  inside your build directory) and continue running even after Jenkins has restarted.
(You can get some more technical background on the <a href="https://plugins.jenkins.io/workflow-cps">Pipeline: Groovy plugin page</a> and the <a href="https://github.com/cloudbees/groovy-cps/blob/master/README.md">library page</a>.)</p>
</div>
<div class="paragraph">
<p>While the CPS transform is usually transparent to users, there are limitations to what Groovy language constructs can be supported, and in some circumstances it can lead to counterintuitive behavior.
<a href="https://issues.jenkins.io/browse/JENKINS-31314">JENKINS-31314</a> makes the runtime try to detect the most common mistake: calling CPS-transformed code from non-CPS-transformed code.
The following kinds of things are CPS-transformed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Almost all of the Pipeline script you write (including in libraries)</p>
</li>
<li>
<p>Most Pipeline steps, including all those which take a block</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following kinds of things are <em>not</em> CPS-transformed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Compiled Java bytecode, including</p>
<div class="ulist">
<ul>
<li>
<p>the Java Platform</p>
</li>
<li>
<p>Jenkins core and plugins</p>
</li>
<li>
<p>the runtime for the Groovy language</p>
</li>
</ul>
</div>
</li>
<li>
<p>Constructor bodies in your Pipeline script</p>
</li>
<li>
<p>Any method in your Pipeline script marked with the <code>@NonCPS</code> annotation</p>
</li>
<li>
<p>A few Pipeline steps which take no block and act instantaneously, such as <code>echo</code> or <code>properties</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>CPS-transformed code may call non-CPS-transformed code or other CPS-transformed code, and non-CPS-transformed code may call other non-CPS-transformed code, but non-CPS-transformed code <strong>may not</strong> call CPS-transformed code.
If you try to call CPS-transformed code from non-CPS-transformed code, the CPS interpreter is unable to operate correctly, resulting in incorrect and often confusing results.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="common-problems-and-solutions"><a class="anchor" href="#common-problems-and-solutions"></a>Common problems and solutions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="use-of-pipeline-steps-fromnoncps"><a class="anchor" href="#use-of-pipeline-steps-fromnoncps"></a>Use of Pipeline steps from <code>@NonCPS</code></h3>
<div class="paragraph">
<p>Sometimes users will apply the <code>@NonCPS</code>  annotation to a method definition in order to bypass the CPS transform inside that method.
This can be done to work around limitations in Groovy language coverage (since the body of the method will execute using the native Groovy semantics), or to get better performance (the interpreter imposes a substantial overhead).
However, such methods must not call CPS-transformed code such as Pipeline steps.
For example, the following will not work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="nd">@NonCPS</span>
<span class="kt">def</span> <span class="nf">compileOnPlatforms</span><span class="o">()</span> <span class="o">{</span>
  <span class="o">[</span><span class="s1">'linux'</span><span class="o">,</span> <span class="s1">'windows'</span><span class="o">].</span><span class="na">each</span> <span class="o">{</span> <span class="n">arch</span> <span class="o">-&gt;</span>
    <span class="n">node</span><span class="o">(</span><span class="n">arch</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">sh</span> <span class="s1">'make'</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="n">compileOnPlatforms</span><span class="o">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the <code>node</code>  or <code>sh</code>  steps from this method is illegal, and the behavior will be anomalous.
The warning in the logs from running this script looks like this:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>expected to call WorkflowScript.compileOnPlatforms but wound up catching node</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>To fix this case, simply remove the annotation — it was not needed.
(Longtime Pipeline users might have thought it was, prior to the fix of <a href="https://issues.jenkins.io/browse/JENKINS-26481">JENKINS-26481</a>.)</p>
</div>
</div>
<div class="sect2">
<h3 id="calling-non-cps-transformed-methods-with-cps-transformed-arguments"><a class="anchor" href="#calling-non-cps-transformed-methods-with-cps-transformed-arguments"></a>Calling non-CPS-transformed methods with CPS-transformed arguments</h3>
<div class="paragraph">
<p>Some Groovy and Java methods take complex types as parameters to support dynamic behavior.
A common case is sorting methods that allow callers to specify a method to use for comparing objects (<a href="https://issues.jenkins.io/browse/JENKINS-44924">JENKINS-44924</a>).
Many similar methods in the Groovy standard library work correctly after the fix for <a href="https://issues.jenkins.io/browse/JENKINS-26481">JENKINS-26481</a>, but some methods remain unfixed.
For example, the following will not work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="kt">def</span> <span class="nf">sortByLength</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">list</span><span class="o">.</span><span class="na">toSorted</span> <span class="o">{</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span> <span class="o">-&gt;</span> <span class="n">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="na">length</span><span class="o">()).</span><span class="na">compareTo</span><span class="o">(</span><span class="n">b</span><span class="o">.</span><span class="na">length</span><span class="o">())</span> <span class="o">}</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="n">sorted</span> <span class="o">=</span> <span class="n">sortByLength</span><span class="o">([</span><span class="s1">'333'</span><span class="o">,</span> <span class="s1">'1'</span><span class="o">,</span> <span class="s1">'4444'</span><span class="o">,</span> <span class="s1">'22'</span><span class="o">])</span>
<span class="n">echo</span><span class="o">(</span><span class="n">sorted</span><span class="o">.</span><span class="na">toString</span><span class="o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The closure passed to <code>Iterable.toSorted</code> is CPS-transformed, but <code>Iterable.toSorted</code> itself is not CPS-transformed internally, so this will not work as intended.
The current behavior is that the return value of the call to <code>toSorted</code> will be the return value of the first call to the closure.
In the example, this results in <code>sorted</code> being set to <code>-1</code>, and the warning in the logs looks like this:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>expected to call java.util.ArrayList.toSorted but wound up catching org.jenkinsci.plugins.workflow.cps.CpsClosure2.call</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>To fix this case, any argument passed to these methods must not be CPS-transformed.
This can be accomplished by encapsulating the problematic method (<code>Iterable.toSorted</code> in the example) inside another method, and annotating the outer method with <code>@NonCPS</code>, or by creating an explicit class definition for the closure and annotating all methods on that class with <code>@NonCPS</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="constructors"><a class="anchor" href="#constructors"></a>Constructors</h3>
<div class="paragraph">
<p>Occasionally, users may attempt to use CPS-transformed code such as Pipeline steps inside of a constructor in a Pipeline script.
Unfortunately, the construction of objects via the <code>new</code> operator in Groovy is not something that can be CPS-transformed (<a href="https://issues.jenkins.io/browse/JENKINS-26313">JENKINS-26313</a>), and so this will not work.
Here is an example that calls a CPS-transformed method in a constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>
  <span class="kt">def</span> <span class="n">x</span>
  <span class="kd">public</span> <span class="nf">Test</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">setX</span><span class="o">()</span>
  <span class="o">}</span>
  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">setX</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="n">x</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Test</span><span class="o">().</span><span class="na">x</span>
<span class="n">echo</span> <span class="s2">"${x}"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The construction of <code>Test</code> will fail when the constructor calls <code>Test.setX</code> because <code>setX</code> is a CPS-transformed method.
The warning in the logs from running this script looks like this:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>expected to call Test.&lt;init&gt; but wound up catching Test.setX</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>To fix this case, ensure that any methods defined in a Pipeline script that are called from inside of a constructor are annotated with <code>@NonCPS</code> and that constructors do not call any Pipeline steps.
If you must call CPS-transformed code such a Pipeline steps from the constructor, you need move the logic related to the CPS-transformed methods out of the constructor, for example into a static factory method that calls the CPS-transformed code and then passes the results to the constructor.</p>
</div>
</div>
<div class="sect2">
<h3 id="overrides-of-non-cps-transformed-methods"><a class="anchor" href="#overrides-of-non-cps-transformed-methods"></a>Overrides of non-CPS-transformed methods</h3>
<div class="paragraph">
<p>Users may create a class in a Pipeline Script that extends a preexisting class defined outside of the Pipeline script, for example from the Java or Groovy standard libraries.
When doing so, the subclass must ensure that any overriding methods are annotated with <code>@NonCPS</code> and do not use any CPS-transformed code internally.
Otherwise, the overriding methods will fail if called from a non-CPS context.
For example, the following will not work:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="kd">class</span> <span class="nc">Test</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="s2">"Test"</span>
  <span class="o">}</span>
<span class="o">}</span>
<span class="kt">def</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">()</span>
<span class="n">builder</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="k">new</span> <span class="n">Test</span><span class="o">())</span>
<span class="n">echo</span><span class="o">(</span><span class="n">builder</span><span class="o">.</span><span class="na">toString</span><span class="o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Calling the CPS-transformed override of <code>toString</code> from non-CPS-transformed code such as <code>StringBuilder.append</code> is not permitted and will not work as expected in most cases.
The warning in the logs from running this script looks like this:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>expected to call java.lang.StringBuilder.append but wound up catching Test.toString</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>To fix this case, add the <code>@NonCPS</code> annotation to the overriding method, and remove any uses of CPS-transformed code such as Pipeline steps from the method.</p>
</div>
</div>
<div class="sect2">
<h3 id="PipelineCPSmethodmismatches-ClosuresinsideGString"><a class="anchor" href="#PipelineCPSmethodmismatches-ClosuresinsideGString"></a>Closures inside <code>GString</code> </h3>
<div class="paragraph">
<p>In Groovy, it is possible to use a closure in a <code>GString</code> so that the closure is evaluated every time the <code>GString</code> is used as a <code>String</code>.
However, in Pipeline scripts, this will not work as expected, because the closure inside of the GString will be CPS-transformed.
Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="kt">def</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="kt">def</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">"x = ${-&gt; x}"</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">echo</span><span class="o">(</span><span class="n">s</span><span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Using a closure inside of a <code>GString</code>  as in this example will not work.
The warning from the logs when running this script looks like this:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>expected to call WorkflowScript.echo but wound up catching org.jenkinsci.plugins.workflow.cps.CpsClosure2.call</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>To fix this case, replace the original GString with a closure that returns a GString that uses a normal expression rather than a closure, and then call the closure where you would have used the original <code>GString</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="kt">def</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
<span class="kt">def</span> <span class="n">s</span> <span class="o">=</span> <span class="o">{</span> <span class="o">-&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="s2">"${x}"</span> <span class="o">}</span>
<span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">echo</span><span class="o">(</span><span class="n">s</span><span class="o">())</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="false-positives"><a class="anchor" href="#false-positives"></a>False Positives</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unfortunately, some expressions may incorrectly trigger this warning even though they execute correctly.
If you run into such a case, please <a href="https://www.jenkins.io/participate/report-issue/redirect/#21713">file a new issue</a> (after first checking for duplicates) for <code>workflow-cps-plugin</code>.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<hr>
<div>
<div class="row">
<div class="col-md-4">
<a class="prev doc-page-link" href="../scaling-pipeline">
⇐ Scaling Pipelines
</a>
</div>
<div class="col-md-4">
<a class="up doc-page-link" href="../">
⇑ Pipeline
</a>
<a class="index doc-page-link" href="../../">
Index
</a>
</div>
<div class="col-md-4">
<a class="next doc-page-link" href="../../blueocean">
Blue Ocean ⇒
</a>
</div>
</div>
</div>
<hr>
<div class="container"></div>
<!-- starting partial _feedback-footer.html -->
<!-- HTML inclusion for chapter and section layouts (i.e. as footers) as well as
     for use in AsciiDoc file inclusions. -->

<!--
This feedback form was prepared from a Google Form, based on the techniques in
the following documentation sources:
https://codepen.io/learningcode/post/customize-a-google-form-for-your-website,
https://mrhaki.blogspot.com.au/2014/06/awesome-asciidoc-include-raw-html.html,
https://www.freshtechtips.com/2013/05/custom-google-drive-contact-form.html,
https://stackoverflow.com/questions/24436165/set-value-of-hidden-input-inside-form
-->

<!-- Feedback form functionality in JavaScript - refer to comments in this file
     for details on the functionality. -->
<script>
var feedbackForm = {
    formKey : 'e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w'
};
$(document).ready(function() {
    window.onload = feedbackForm.start(window.location.href);
});
</script>
<script src="/js/feedback-form-functionality.js"></script>

<p><a href="#feedback" data-bs-toggle="collapse">Was this page helpful?</a></p>

<div id="feedback" class="collapse">

<p>Please submit your feedback about this page through this
<a href="/doc/feedback-form/">quick form</a>.</p>

<p>Alternatively, if you don't wish to complete the quick form, you can simply
indicate if you found this page helpful?</p>

<!-- Redirects to custom "thank you" page once form is submitted. -->
<script type="text/javascript">
var submitted=false;
</script>
<iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"
onload="if(submitted) {window.location='/doc/thank-you-for-your-feedback/';}">
</iframe>
<form action="https://docs.google.com/forms/d/e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w/formResponse" method="POST" id="ss-form" target="hidden_iframe" onsubmit="submitted=true;">

<!-- Set the value of the current URL into the form. -->
<input type="hidden" name="entry.1246830226" id="current-url" value=""/>

<!-- The answer bit -->
<p><input type="radio" name="entry.790002525" id="h1" value="Yes" required/>
<label for="h1">Yes</label>&nbsp;&nbsp;&nbsp;&nbsp;
<input type="radio" name="entry.790002525" id="h2" value="No"/>
<label for="h2">No</label></p>

<!-- The CAPTCHA bit -->

<p><label id="ssTestLabel" for="ssTestValue"></label><br/>
<input type="text" name="ssTestValue" value="" id="ssTestValue"/></p>

<!-- Submit button -->

<p><input class="button" type="submit" value="Submit"/></p>

</form>

<p>See existing feedback <a href="https://docs.google.com/spreadsheets/d/1IIdpVs39JDYKg0sLQIv-MNO928qcGApAIfdW5ohfD78" target="_blank" rel="noreferrer noopener">here</a>.</p>

</div>

<!-- ending partial _feedback-footer.html -->

</div>
</div>
</div>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//doc/book/pipeline/cps-method-mismatches.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
