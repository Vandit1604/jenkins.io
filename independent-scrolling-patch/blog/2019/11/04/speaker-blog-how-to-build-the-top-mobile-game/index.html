<!DOCTYPE html>
<html lang="en">
<head>
<title>
How to build the top mobile game for every platform imaginable
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2019/11/04/speaker-blog-how-to-build-the-top-mobile-game/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="How to build the top mobile game for every platform imaginable" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="How to build the top mobile game for every platform imaginable" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="How to build the top mobile game for every platform imaginable" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2019/11/04/speaker-blog-how-to-build-the-top-mobile-game/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="How to build the top mobile game for every platform imaginable" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.app-post-page h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<article class="container app-post-page">
<div class="app-!-display-flex">
<a class="app-back-link" href="/jenkins.io/independent-scrolling-patch/node/">
Back to blog
</a>
</div>
<h1>
How to build the top mobile game for every platform imaginable
</h1>
<div class="post-attrs">
<a class="app-author-link" href="/blog/authors/ignacio_fernandez/"><div class="app-avatar"><img alt="Ignacio 'Nacho' Fernández" class="app-avatar__image" src="/images/avatars/ignacio_fernandez.jpg"></div> Ignacio 'Nacho' Fernández</a>
November 04, 2019
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/intent/tweet?text=How+to+build+the+top+mobile+game+for+every+platform+imaginable&amp;url=https%3A%2F%2Fwww.jenkins.io%2Fjenkins.io%2Findependent-scrolling-patch%2Fblog%2F2019%2F11%2F04%2Fspeaker-blog-how-to-build-the-top-mobile-game%2F" rel="noreferrer nofollow" target="_blank">
Tweet
</a>
</div>
<div class="blog-content">
<div class="sect2">
<h3 id="context"><a class="anchor" href="#context"></a>Context</h3>
<div class="paragraph">
<p>You have been tasked with managing the Jenkins instance for the highest grossing mobile
game in the world. You learn that this involves helping the game studio iterate their work
against eight different target platforms, each with their SDK, on four different main pipelines,
plus a lot of extra auxiliary jobs. And, of course, the studio wants all of this to go smoothly, in
order to maintain a good pace of features and bugfixes for every release - a release happening
every two weeks. Hitting hundreds of millions of players worldwide.</p>
</div>
<div class="paragraph">
<p>How are you going to make sure that the environment stays correctly configured, with the
right versions of the required software; helping the studio maintain stability and scalability of
their pipelines; ensuring operability of the Jenkins instance; improving the speed of the builds
month after month?</p>
</div>
<div class="paragraph">
<p>It’s OK to sweat. You are going to need some help!</p>
</div>
<div class="paragraph">
<p>This is just a regular day in the office for a build engineer working at King. Facing a very
broad problem, with high quality standards and even higher stakes. Thankfully, we are not
alone. We have access to a lot of tools - either open source tools, tools developed by the
studios or tools developed by our stellar build infrastructure team in Barcelona - to help carry
us all the way to the publish line. We put all of these tools together, and by their powers
combined, we provide fast, easily operable workflows for the studios, cutting minutes here
and there, ensuring the features a smooth sail from dev, to master, to release.</p>
</div>
<div class="paragraph">
<p>I will explain all of the tricks we use at King to speed builds up, and to make Jenkins operation
easier for our studios on December 4, 2019, at <a href="https://www.cloudbees.com/devops-world/lisbon">DevOps World | Jenkins
World Lisbon</a>.
Use <strong>JWFOSS</strong> for 30% discount on registration!
For now, let&#8217;s take a look at some of them.</p>
</div>
</div>
<div class="sect2">
<h3 id="where-do-we-start"><a class="anchor" href="#where-do-we-start"></a>Where do we start?</h3>
<div class="paragraph">
<p>We use on-premises elastic infrastructure, spawning machines from certain templates
whenever they are needed. This means that for every build, we are getting a fresh
environment - no intermediate artifacts leftover or anything of the sort, which is good. That
also means that we need to clone our repositories and compile everything every time, which is
bad. However, we have solutions for these two problems.</p>
</div>
<div class="paragraph">
<p>We make full use of linkclones/snapshots when spawning a VM. Every night we run a
bootstrapper that will power on the base image and perform whatever operations we decide on
it, before turning it back into a template and re-creating the snapshot. In the case of Candy
Crush, we update our caches, and this helps us cut some time off of git clone and compilation.
We call this bootstrapper “cacheo”. It looks more or less like this:</p>
</div>
<div class="listingblock">
<div class="title">Cacheo</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="mi">1</span><span class="o">.</span> <span class="n">Start</span> <span class="n">elastic</span> <span class="n">agent</span> <span class="n">template</span> <span class="n">image</span>
<span class="mi">2</span><span class="o">.</span> <span class="n">Connect</span> <span class="n">it</span> <span class="n">to</span> <span class="n">Jenkins</span>
<span class="mi">3</span><span class="o">.</span> <span class="n">Perform</span> <span class="n">cleanup</span>
<span class="mi">4</span><span class="o">.</span> <span class="n">Trigger</span> <span class="n">git</span> <span class="n">reference</span> <span class="n">cache</span> <span class="n">jobs</span>
<span class="mi">5</span><span class="o">.</span> <span class="n">Trigger</span> <span class="n">all</span> <span class="n">the</span> <span class="n">builds</span> <span class="n">you</span> <span class="n">want</span> <span class="n">cached</span>
<span class="mi">6</span><span class="o">.</span> <span class="n">Turn</span> <span class="n">off</span> <span class="n">template</span> <span class="n">image</span><span class="o">,</span> <span class="n">delete</span> <span class="n">the</span> <span class="n">agent</span> <span class="n">and</span> <span class="n">recreate</span> <span class="n">the</span> <span class="n">linked</span> <span class="n">clone</span> <span class="n">snapshot</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Every studio can specify on which templates will cacheo run, and what will it do in each of them.
Maybe you want to make sure your Android license is on point. Or download some
packages from artifactory. Perhaps pre-load your gradle dependencies. Whatever it is, cacheo
does it for you and updates your base images every night.</p>
</div>
<div class="paragraph">
<p>One of the most common uses is to pre-fill a local git cache, and when doing so, the
improvement is very visible, especially on Windows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">Linux</th>
<th class="tableblock halign-left valign-top">MacOS</th>
<th class="tableblock halign-left valign-top">Windows</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NFS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 min 11s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2min 34s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8min 32s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 min 20s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1min 35s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3min 49s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Difference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>39% faster</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>39% faster</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>55% faster</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This means, speeding up source code fetching by 55% on Windows, on average. That is a LOT!!</p>
</div>
</div>
<div class="sect2">
<h3 id="but-what-about-actual-compilation"><a class="anchor" href="#but-what-about-actual-compilation"></a>But what about actual compilation?</h3>
<div class="paragraph">
<p>All of our major games use the same engine; we bring this code in by means of submodules. This means
there is a big bunch of shared code that needs to be compiled and linked whenever we build the game.
And it&#8217;s not rare that this shared code is bigger than the actual game code!
Thankfully, the engine team lent us a hand, and they developed a way to package the compiled shared code.
Normally, the game code lives alongside a specific version of the shared code, which doesn&#8217;t get updated too frequently.
Sometimes once a month, sometimes to grab a hotfix. This translates to us potentially compiling the
exact same shared code for quite some time, every time we build the game. Thanks to these
prebuilt artifacts, we are able to skip a huge part of the compilation, at the cost of a simple artifactory download.</p>
</div>
<div class="listingblock">
<div class="title">Cacheo</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="cmake">if generate_prebuilt_libs:
    <span class="nf">compile_project</span><span class="p">()</span>

    <span class="nf">generate_empty_cmakelists</span><span class="p">()</span>

    for dependency in dependencies:
        <span class="nf">merge_compiled_dependency_into_metalib</span><span class="p">(</span>dependency<span class="p">)</span>
        <span class="nf">write_dependency_to_generated_cmakelists_as_alias_for_metalib</span><span class="p">(</span>dependency<span class="p">)</span>

elif use_prebuilt_libs:
    <span class="nf">add_generated_cmakelists_with_metalib_as_dependency</span><span class="p">()</span>

    <span class="nf">compile_project</span><span class="p">()</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Thanks to these prebuilt libraries, we are able to skip a big chunk of the compilation,
and it builds up really quickly! Iterative work on several branches, as long as they have
the same engine version, gets sped up in noticeable ways.
There are, however, specific cases when we do choose to build the shared code regardless, such as
when we build release candidates for instance.</p>
</div>
<div class="paragraph">
<p>Just so you get an idea, times on this table are on average:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-left valign-top">iOS</th>
<th class="tableblock halign-left valign-top">Windows</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No prebuilts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20min 17s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40min 30s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prebuilts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10min 2s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">23min 20s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Difference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>51% faster</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>43% faster</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect1">
<h2 id="i-just-dont-want-to-have-to-deal-with-bureaucracy"><a class="anchor" href="#i-just-dont-want-to-have-to-deal-with-bureaucracy"></a>I just don&#8217;t want to have to deal with bureaucracy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Operating Jenkins can be quite complicated. Talk about “Tell me
something I don’t know”, right? And with so many moving pieces (elastic
infrastructure, plugins, dirty workspaces), it might not be easy for
everyone to run specific maintenance tasks. We have a lot of small
pipelines, created by the build infrastructure group, that we can use to
diagnose and work around certain errors, as well as gather useful
information that might be otherwise difficult to find. These pipelines
do things like printing all the installed plugins, deleting offline
on-demand agents, cleaning disconnected VMs from vSphere, or re-run
puppet in a specific Jenkins instance. And any user can run these jobs,
there is no need to be an admin. This allows the team to unblock
themselves if they need to by using these jobs. Here&#8217;s one that I
particularly like. How many times have you modified a pipeline and, when
trying to run it, the first thing that happens is that Jenkins says that
it needs approval?</p>
</div>
<div class="listingblock">
<div class="title">Script Approval</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="kn">import</span> <span class="nn">org.jenkinsci.plugins.scriptsecurity.scripts.*</span>

<span class="nd">@NonCPS</span>

<span class="c1">// Disclaimer - this can have serious security consequences</span>
<span class="c1">// Be mindful when you run this!</span>

<span class="kt">def</span> <span class="nf">call</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">sa</span> <span class="o">=</span> <span class="n">ScriptApproval</span><span class="o">.</span><span class="na">get</span><span class="o">()</span>
    <span class="n">toApproveScripts</span> <span class="o">=</span> <span class="n">sa</span><span class="o">.</span><span class="na">getPendingScripts</span><span class="o">().</span><span class="na">collect</span><span class="o">()</span>
    <span class="n">println</span> <span class="o">(</span><span class="s2">"toApproveScripts: "</span> <span class="o">+</span> <span class="n">toApproveScripts</span><span class="o">)</span>
    <span class="n">toApproveScripts</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span><span class="n">pending</span> <span class="o">-&gt;</span>
        <span class="n">sa</span><span class="o">.</span><span class="na">get</span><span class="o">().</span><span class="na">approveScript</span><span class="o">(</span><span class="n">pending</span><span class="o">.</span><span class="na">getHash</span><span class="o">())</span>
	<span class="n">println</span> <span class="o">(</span><span class="s2">"approvedScripts: "</span> <span class="o">+</span> <span class="n">pending</span><span class="o">.</span><span class="na">getHash</span><span class="o">())</span>
	<span class="o">}</span>
    <span class="n">sa</span><span class="o">.</span><span class="na">save</span><span class="o">()</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The best part? All our Jenkins instances include these jobs, by default, so
no one misses out on the fun.</p>
</div>
</div>
</div>
</div>
<ul class="app-tags">
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/jenkinsworld/">
jenkinsworld
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/jenkinsworld2019/">
jenkinsworld2019
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/mobile-game/">
mobile-game
</a>
</li>
</ul>
<h2>
About the author
</h2>
<!-- starting partial author.html.haml -->
<div class="app-author" id="about-the-author">
<!-- starting partial avatar.html.haml -->
<div class="app-avatar" style="min-width: 64px; width: 25vw; max-width: 128px">
<img alt="Ignacio &#39;Nacho&#39; Fernández" class="app-avatar__image" src="/jenkins.io/independent-scrolling-patch/images/avatars/ignacio_fernandez.jpg">
</div>

<!-- ending partial avatar.html.haml -->
<div class="app-author__content">
<p class="app-author__name">
<a href="/blog/authors/ignacio_fernandez/">
Ignacio 'Nacho' Fernández
</a>
</p>
<div class="paragraph">
<p>Nacho is a Build Engineer with several years of experience in the videogame industry, and has worked in both AAA projects as well as free-to-play and mobile.
Currently, Nacho works at King Stockholm, taking care of Jenkins operations for Candy Crush Saga and Candy Crush Soda Saga.</p>
</div>
<!-- starting partial social-media-buttons.html.haml -->
<ul class="app-social-media-buttons">
<li>
<a href="https://github.com/Napo2k" rel="noreferrer noopener" target="_blank">
GitHub
</a>
</li>
<li>
<a href="https://twitter.com/@napo2k" rel="noreferrer noopener" target="_blank">
Twitter
</a>
</li>
<li>
<a href="https://www.linkedin.com/in/ignaciofernandezpuerta" rel="noreferrer noopener" target="_blank">
LinkedIn
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</div>
</div>

<!-- ending partial author.html.haml -->
<!-- starting partial discuss.html.haml -->

<!-- ending partial discuss.html.haml -->
</article>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//blog/2019/11/2019-11-04-speaker-blog-how-to-build-the-top-mobile-game.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
