<!DOCTYPE html>
<html lang="en">
<head>
<title>
Scaling Jenkins with Kubernetes on Google Container Engine
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2017/07/21/scaling-jenkins-with-kubernetes-on-google-container-engine/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="Scaling Jenkins with Kubernetes on Google Container Engine" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Scaling Jenkins with Kubernetes on Google Container Engine" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Scaling Jenkins with Kubernetes on Google Container Engine" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2017/07/21/scaling-jenkins-with-kubernetes-on-google-container-engine/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="Scaling Jenkins with Kubernetes on Google Container Engine" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.app-post-page h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<article class="container app-post-page">
<div class="app-!-display-flex">
<a class="app-back-link" href="/jenkins.io/independent-scrolling-patch/node/">
Back to blog
</a>
</div>
<h1>
Scaling Jenkins with Kubernetes on Google Container Engine
</h1>
<div class="post-attrs">
<a class="app-author-link" href="/blog/authors/glaforge/"><div class="app-avatar"></div> Guillaume Laforge</a>
July 21, 2017
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/intent/tweet?text=Scaling+Jenkins+with+Kubernetes+on+Google+Container+Engine&amp;url=https%3A%2F%2Fwww.jenkins.io%2Fjenkins.io%2Findependent-scrolling-patch%2Fblog%2F2017%2F07%2F21%2Fscaling-jenkins-with-kubernetes-on-google-container-engine%2F" rel="noreferrer nofollow" target="_blank">
Tweet
</a>
</div>
<div class="blog-content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is a guest post by Guillaume Laforge,
Developer Advocate for <a href="https://cloud.google.com/">Google Cloud</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Last week, I had the pleasure to speak at the
<a href="https://jcd-paris.jfrog.com/">Jenkins Community Day conference</a>, in Paris,
organized by my friends from <a href="https://www.jfrog.com/">JFrog</a>,
provider of awesome tools for software management and distribution.
I covered how to scale Jenkins with <a href="https://kubernetes.io/">Kubernetes</a> on
<a href="https://cloud.google.com/container-engine/">Google Container Engine</a>.</p>
</div>
<div class="paragraph">
<p>For the impatient, here are the slides of the presentation I’ve given:</p>
</div>
<div class="imageblock">
<div class="content">
<a class="image" href="https://speakerdeck.com/glaforge/scaling-jenkins-with-kubernetes-on-google-container-engine"><img src="/images/post-images/jenkins-k8s-gke.png" alt="Scaling Jenkins with Kubernetes on Google Container Engine" width="500"></a>
</div>
</div>
<div class="paragraph">
<p>But let’s step back a little. In this article, I’d like to share with you why you would want to run Jenkins in the cloud,
as well as give you some pointers to interesting resources on the topic.</p>
</div>
<div class="sect1">
<h2 id="why-running-jenkins-in-the-cloud"><a class="anchor" href="#why-running-jenkins-in-the-cloud"></a>Why running Jenkins in the cloud?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So why running Jenkins in the cloud? First of all, imagine your small team, working on a single project.
You have your own little server, running under a desk somewhere, happily building your application on each commit,
a few times a day. So far so good, your build machine running Jenkins isn’t too busy, and stays idle most of the day.</p>
</div>
<div class="paragraph">
<p>Let’s do some bottom of the napkin calculations. Let’s say you have a team of 3 developers,
committing roughly 4 times a day, on one single project, and the build takes roughly 10 minutes to go.</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">3 developers * 4 commits / day / developer * 10 minutes build time * 1 project = 1 hour 20 minutes</pre>
</div>
</div>
<div class="paragraph">
<p>So far so good, your server indeed stays idle most of the day. Usually, at most,
your developers will wait just 10 minutes to see the result of their work.</p>
</div>
<div class="paragraph">
<p>But your team is growing to 10 persons, the team is still as productive, but the project becoming bigger,
the build time goes up to 15 minutes:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">10 developers * 4 commits / day / developer * 15 minutes build time * 1 project = 10 hours</pre>
</div>
</div>
<div class="paragraph">
<p>You’re already at 10 hours build time, so your server is busy the whole day, and at times,
you might have several build going on at the same time, using several CPU cores in parallel.
And instead of building in 15 minutes, sometimes, the build might take longer, or your build might be queued.
So in theory, it might be 15 minutes, but in practice, it could be half an hour because of the length of the queue
or the longer time to build parallel projects.</p>
</div>
<div class="paragraph">
<p>Now, the company is successful, and has two projects instead of one (think a backend and a mobile app).
Your teams grow further up to 20 developers per project. The developers are a little less productive
because of the size of the codebase and project, so they only commit 3 times a day.
The build takes more time too, at 20 minutes (in ideal time). Let’s do some math again:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">20 developers * 3 commits / day / developer * 20 minutes build time * 2 projects = 40 hours</pre>
</div>
</div>
<div class="paragraph">
<p>Whoa, that’s already 40 hours of total build time, if all the builds are run serially.
Fortunately, our server is multi-core, but still, there are certainly already many builds that are enqueued,
and many of them, perhaps up to 2-3 or perhaps even 4 could be run in parallel.
But as we said, the build queue increases further, the real effective time of build is certainly longer than 30 minutes.
Perhaps at times, developers won’t see the result of their developments before at least an hour, if not more.</p>
</div>
<div class="paragraph">
<p>One last calculation? With team sizes of 30 developers, decreased productivity of 2 commits, 25 build time,
and 3 projects? And you’ll get 75 hours total build time. You may start creating a little build farm,
with a controller and several build agents. But you also increase the burden of server management.
Also, if you move towards a full Continuous Delivery or Continuous Deployment approach,
you may further increase your build times to go up to deployment, make more but smaller commits, etc.
You could think of running builds less often, or even on a nightly basis, to cope with the demand, but then,
your company is less agile, and the time-to-market for fixes of new features might increase,
and your developers may also become more frustrated because they are developing in the blind,
not knowing before the next day if their work was successful or not.</p>
</div>
<div class="paragraph">
<p>With my calculations, you might think that it makes more sense for big companies, with tons of projects and developers.
This is quite true, but when you’re a startup, you also want to avoid taking care of local server management,
provisioning, etc. You want to be agile, and use only compute resources you need for the time you need them.
So even if you’re a small startup, a small team, it might still make sense to take advantage of the cloud.
You pay only for the actual time taken by your builds as the build agent containers are automatically provisioned
and decommissioned. The builds can scale up via Kubernetes, as you need more (or less) CPU time for building everything.</p>
</div>
<div class="paragraph">
<p>And this is why I was happy to dive into scaling Jenkins in the cloud. For that purpose,
I decided to go with building with containers, with Kubernetes, as my app was also containerized as well.
Google Cloud offers Container Engine, which is basically just Kubernetes in the cloud.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="useful-pointers"><a class="anchor" href="#useful-pointers"></a>Useful pointers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I based my presentation and demo on some great solutions that are published on the Google Cloud documentation portal.
Let me give you some pointers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://cloud.google.com/solutions/jenkins-on-container-engine">Overview of Jenkins on Container Engine</a></p>
</li>
<li>
<p><a href="https://cloud.google.com/solutions/jenkins-on-container-engine-tutorial">Setting up Jenkins on Container Engine</a></p>
</li>
<li>
<p><a href="https://cloud.google.com/solutions/configuring-jenkins-container-engine">Configuring Jenkins for Container Engine</a></p>
</li>
<li>
<p><a href="https://cloud.google.com/solutions/continuous-delivery-jenkins-container-engine">Continuous Deployment to Container Engine using Jenkins</a></p>
</li>
<li>
<p><a href="https://github.com/GoogleCloudPlatform/continuous-deployment-on-kubernetes">Lab: Build a Continuous Deployment Pipeline with Jenkins and Kubernetes</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The latter one is the tutorial I actually followed for the demo that I presented during the conference.
It’s a simple Go application, with a frontend and backend.
It’s continuously build, on each commit (well, every minute to check if there’s a new commit),
and deployed automatically in different environments: dev, canary, production.
The sources of the project are stored in Cloud Source Repository (it can be mirrored from Github, for example).
The containers are stored in Cloud Container Registry.
And both the Jenkins controller and agents, as well as the application are running inside Kubernetes clusters in Container Engine.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary-and-perspective"><a class="anchor" href="#summary-and-perspective"></a>Summary and perspective</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Don’t bother with managing servers! Quickly, you’ll run out of CPU cycles,
and you’ll have happier developers with builds that are super snappy!</p>
</div>
<div class="paragraph">
<p>And for the record, at Google, dev teams are also running Jenkins!
There was a presentation (<a href="https://www.youtube.com/watch?v=7ERV9C20GSE">video</a> and
<a href="https://www.cloudbees.com/sites/default/files/2016-jenkins-world-jenkins_inside_google.pdf">slides</a>
available) given last year by David Hoover at Jenkins World
talking about how developers inside Google are running hundreds of build agents to build projects on various platforms.</p>
</div>
</div>
</div>
</div>
<ul class="app-tags">
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/jenkins/">
jenkins
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/kubernetes/">
kubernetes
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/jenkins-community-day-paris/">
jenkins-community-day-paris
</a>
</li>
</ul>
<h2>
About the author
</h2>
<!-- starting partial author.html.haml -->
<div class="app-author" id="about-the-author">
<!-- starting partial avatar.html.haml -->
<div class="app-avatar" style="min-width: 64px; width: 25vw; max-width: 128px"></div>

<!-- ending partial avatar.html.haml -->
<div class="app-author__content">
<p class="app-author__name">
<a href="/blog/authors/glaforge/">
Guillaume Laforge
</a>
</p>
This author has no biography defined.
See social media links referenced below.
<!-- starting partial social-media-buttons.html.haml -->
<ul class="app-social-media-buttons">
<li>
<a href="https://github.com/glaforge" rel="noreferrer noopener" target="_blank">
GitHub
</a>
</li>
<li>
<a href="https://twitter.com/glaforge" rel="noreferrer noopener" target="_blank">
Twitter
</a>
</li>
<li>
<a href="https://glaforge.appspot.com/" rel="noreferrer noopener" target="_blank">
Blog
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</div>
</div>

<!-- ending partial author.html.haml -->
<!-- starting partial discuss.html.haml -->

<!-- ending partial discuss.html.haml -->
</article>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//blog/2017/07/2017-07-21-scaling-jenkins-with-kubernetes-on-google-container-engine.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
