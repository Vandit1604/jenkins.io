<!DOCTYPE html>
<html lang="en">
<head>
<title>
End-to-End Multibranch Pipeline Project Creation
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/doc/tutorials/build-a-multibranch-pipeline-project/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="End-to-End Multibranch Pipeline Project Creation" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="End-to-End Multibranch Pipeline Project Creation" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="End-to-End Multibranch Pipeline Project Creation" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/doc/tutorials/build-a-multibranch-pipeline-project/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="End-to-End Multibranch Pipeline Project Creation" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.container .row .col-lg-9 h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<div class="container">
<div class="row body flex-lg-nowrap">
<div class="col-lg-3" id="sidebar-menu">
<div class="sidebar-nav tour" id="sidebar-content">
<p>
<a href="/jenkins.io/independent-scrolling-patch/doc/" class="">> User Documentation Home</a>
</p>
<h5>
User Handbook
</h5>
<ul>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/getting-started/" class="">User Handbook Overview</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/installing/" class="">Installing Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/using/" class="">Using Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/" class="">Pipeline</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/blueocean/" class="">Blue Ocean</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/" class="">Managing Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/security/" class="">Securing Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/system-administration/" class="">System Administration</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/scaling/" class="">Scaling Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/troubleshooting/" class="">Troubleshooting Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/glossary/" class="">Glossary</a>
</li>
</ul>
<h5>
Tutorials
</h5>
<ul>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/pipeline/tour/getting-started/" class="">Guided Tour</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/tutorials#pipeline" class="">Jenkins Pipeline</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/tutorials#tools" class="">Using Build Tools</a>
</li>
</ul>
<h5>
Resources
</h5>
<ul>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/syntax/" class="">Pipeline Syntax reference</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/pipeline/steps/" class="">Pipeline Steps reference</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/upgrade-guide/" class="">LTS Upgrade guides</a>
</li>
</ul>
</div>
</div>
<div class="col-lg-9">
<h1>
End-to-End Multibranch Pipeline Project Creation
</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel2">
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#run-jenkins-in-docker">Run Jenkins in Docker</a>
<ul class="sectlevel3">
<li><a href="#on-macos-and-linux">On macOS and Linux</a></li>
<li><a href="#on-windows">On Windows</a></li>
<li><a href="#accessing-the-jenkins-blue-ocean-docker-container">Accessing the Docker container</a></li>
<li><a href="#accessing-the-jenkins-console-log-through-docker-logs">Accessing the Docker logs</a></li>
<li><a href="#accessing-the-jenkins-home-directory">Accessing the Jenkins home directory</a></li>
<li><a href="#setup-wizard">Setup wizard</a></li>
<li><a href="#stopping-and-restarting-jenkins">Stopping and restarting Jenkins</a></li>
</ul>
</li>
<li><a href="#fork-and-clone-the-sample-repository-on-github">Fork and clone the sample repository</a></li>
<li><a href="#create-development-and-production-branches-in-your-repository">Create development and production branches in your repository</a></li>
<li><a href="#create-your-pipeline-project-in-blue-ocean">Create your Pipeline project in Blue Ocean</a></li>
<li><a href="#create-your-initial-pipeline-as-a-jenkinsfile-with-build-and-test-stages">Create your initial Pipeline as a Jenkinsfile with build and test stages</a></li>
<li><a href="#add-deliver-and-deploy-stages-to-your-pipeline">Add deliver and deploy stages to your Pipeline</a></li>
<li><a href="#pull-your-updated-jenkinsfile-into-the-other-repository-branches">Pull your updated Jenkinsfile into the other repository branches</a></li>
<li><a href="#run-your-pipeline-on-the-development-branch">Run your Pipeline on the development branch</a></li>
<li><a href="#run-your-pipeline-on-the-production-branch">Run your Pipeline on the production branch</a></li>
<li><a href="#follow-up-optional">Follow up (optional)</a></li>
<li><a href="#clearing-the-app-from-your-browser">Clearing the app from your browser</a>
<ul class="sectlevel3">
<li><a href="#on-chrome">On Chrome</a></li>
<li><a href="#on-firefox">On Firefox</a></li>
</ul>
</li>
<li><a href="#wrapping-up">Wrapping up</a></li>
</ul>
</div>
<div class="paragraph">
<p>This tutorial shows you how to use Jenkins to orchestrate building and testing
a simple <a href="https://nodejs.org/en/">Node.js</a> and <a href="https://reactjs.org/">React</a>
application with the <a href="https://www.npmjs.com/">Node Package Manager (npm)</a>, <em>as
well as</em> deliver different outcomes for development and production purposes.</p>
</div>
<div class="paragraph">
<p>Before starting this tutorial, it is recommended that you run through at least
one of the initial set of <a href="../#introductory-tutorials">Introductory
tutorials</a> from the <a href="..">Tutorials overview</a> page first to familiarize
yourself with CI/CD concepts (relevant to a technology stack you&#8217;re most
familiar with), how these concepts are implemented in Jenkins and the
fundamentals of Jenkins Pipelines.</p>
</div>
<div class="paragraph">
<p>In this tutorial, you&#8217;ll use the same application that the
<a href="../build-a-node-js-and-react-app-with-npm">Build a Node.js and React app
with npm</a> tutorial is based on. Therefore, you&#8217;ll be building and testing the
same application but this time, its delivery will be different depending on the
Git branch that Jenkins builds from. That is, the branch being built determines
which delivery stage of your Pipeline is executed.</p>
</div>
<div class="paragraph">
<p><strong>Duration:</strong> This tutorial takes 30-50 minutes to complete (assuming you&#8217;ve
already met the <a href="#prerequisites">Prerequisites</a> below). The exact duration will
depend on the speed of your machine and whether or not you&#8217;ve already
<a href="#run-jenkins-in-docker">run Jenkins in Docker</a> from <a href="..">another tutorial</a>.</p>
</div>
<div class="paragraph">
<p>You can stop this tutorial at any point in time and continue from where you left
off.</p>
</div>
<div class="paragraph">
<p>If you&#8217;ve already run though <a href="..">another tutorial</a>, you can skip the
<a href="#prerequisites">Prerequisites</a> and <a href="#run-jenkins-in-docker">Run Jenkins in
Docker</a> sections below and proceed on to <a href="#fork-sample-repository">forking the
sample repository</a>. (Just ensure you have
<a href="https://git-scm.com/downloads">Git</a> installed locally.) If you need to
restart Jenkins, simply follow the restart instructions in
<a href="#stopping-and-restarting-jenkins">Stopping and restarting Jenkins</a> and then
proceed on.</p>
</div>
<div class="sect2">
<h3 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h3>
<div class="paragraph">
<p>For this tutorial, you will require:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A macOS, Linux or Windows machine with:</p>
<div class="ulist">
<ul>
<li>
<p>256 MB of RAM, although more than 2 GB is recommended.</p>
</li>
<li>
<p>10 GB of drive space for Jenkins and your Docker images and containers.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The following software installed:</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.docker.com/">Docker</a> - Read more about installing Docker in the
<a href="/doc/book/installing/#installing-docker">Installing Docker</a> section of
the <a href="/doc/book/installing/">Installing Jenkins</a> page.<br>
<strong>Note:</strong> If you use Linux, this tutorial assumes that you are not running
Docker commands as the root user, but instead with a single user account that
also has access to the other tools used throughout this tutorial.</p>
</li>
<li>
<p><a href="https://git-scm.com/downloads">Git</a> and optionally
<a href="https://desktop.github.com/">GitHub Desktop</a>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="run-jenkins-in-docker"><a class="anchor" href="#run-jenkins-in-docker"></a>Run Jenkins in Docker</h3>
<div class="paragraph">
<p>In this tutorial, you&#8217;ll be running Jenkins as a Docker container from the
<a href="https://hub.docker.com/r/jenkins/jenkins/"><code>jenkins/jenkins</code></a> Docker
image.</p>
</div>
<div class="paragraph">
<p>To run Jenkins in Docker, follow the relevant instructions below for either
<a href="#on-macos-and-linux">macOS and Linux</a> or <a href="#on-windows">Windows</a>.</p>
</div>
<div class="paragraph">
<p>You can read more about Docker container and image concepts in the
<a href="../../book/installing/docker">Docker</a>
section of the <a href="../../book/installing">Installing Jenkins</a> page.</p>
</div>
<div class="sect3">
<h4 id="on-macos-and-linux"><a class="anchor" href="#on-macos-and-linux"></a>On macOS and Linux</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open up a terminal window.</p>
</li>
<li>
<p>Create a <a href="https://docs.docker.com/network/bridge/">bridge network</a> in
Docker using the following
<a href="https://docs.docker.com/engine/reference/commandline/network_create/"><code>docker network create</code></a>
command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="bash">docker network create jenkins</code></pre>
</div>
</div>
</li>
<li>
<p>In order to execute Docker commands inside Jenkins nodes, download and run
the <code>docker:dind</code> Docker image using the following
<a href="https://docs.docker.com/engine/reference/run/"><code>docker run</code></a>
command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="bash">docker run <span class="se">\</span>
  <span class="nt">--name</span> jenkins-docker <span class="se">\</span><i class="conum" data-value="1"></i><b>(1)</b>
  <span class="nt">--rm</span> <span class="se">\</span><i class="conum" data-value="2"></i><b>(2)</b>
  <span class="nt">--detach</span> <span class="se">\</span><i class="conum" data-value="3"></i><b>(3)</b>
  <span class="nt">--privileged</span> <span class="se">\</span><i class="conum" data-value="4"></i><b>(4)</b>
  <span class="nt">--network</span> jenkins <span class="se">\</span><i class="conum" data-value="5"></i><b>(5)</b>
  <span class="nt">--network-alias</span> docker <span class="se">\</span><i class="conum" data-value="6"></i><b>(6)</b>
  <span class="nt">--env</span> <span class="nv">DOCKER_TLS_CERTDIR</span><span class="o">=</span>/certs <span class="se">\</span><i class="conum" data-value="7"></i><b>(7)</b>
  <span class="nt">--volume</span> jenkins-docker-certs:/certs/client <span class="se">\</span><i class="conum" data-value="8"></i><b>(8)</b>
  <span class="nt">--volume</span> jenkins-data:/var/jenkins_home <span class="se">\</span><i class="conum" data-value="9"></i><b>(9)</b>
  <span class="nt">--publish</span> 2376:2376 <span class="se">\</span><i class="conum" data-value="10"></i><b>(10)</b>
  <span class="nt">--publish</span> 3000:3000 <span class="nt">--publish</span> 5000:5000 <span class="se">\</span><i class="conum" data-value="11"></i><b>(11)</b>
  docker:dind <span class="se">\</span><i class="conum" data-value="12"></i><b>(12)</b>
  <span class="nt">--storage-driver</span> overlay2 <i class="conum" data-value="13"></i><b>(13)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>( <em>Optional</em> ) Specifies the Docker container name to use for running the
image. By default, Docker will generate a unique name for the container.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>( <em>Optional</em> ) Automatically removes the Docker container (the instance of
the Docker image) when it is shut down.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>( <em>Optional</em> ) Runs the Docker container in the background. This instance
can be stopped later by running <code>docker stop jenkins-docker</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Running Docker in Docker currently requires privileged access to function
properly. This requirement may be relaxed with newer Linux kernel versions.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>This corresponds with the network created in the earlier step.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Makes the Docker in Docker container available as the hostname <code>docker</code>
within the <code>jenkins</code> network.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Enables the use of TLS in the Docker server. Due to the use
of a privileged container, this is recommended, though it requires the use of
the shared volume described below. This environment variable controls the root
directory where Docker TLS certificates are managed.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Maps the <code>/certs/client</code> directory inside the container to
a Docker volume named <code>jenkins-docker-certs</code> as created above.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Maps the <code>/var/jenkins_home</code> directory inside the container to the Docker
volume named <code>jenkins-data</code>. This will allow for other Docker
containers controlled by this Docker container&#8217;s Docker daemon to mount data
from Jenkins.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>( <em>Optional</em> ) Exposes the Docker daemon port on the host machine. This is
useful for executing <code>docker</code> commands on the host machine to control this
inner Docker daemon.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Exposes ports 3000 and 5000 from the docker in docker container, used by some of the tutorials.</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>The <code>docker:dind</code> image itself. This image can be downloaded before running
by using the command: <code>docker image pull docker:dind</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="13"></i><b>13</b></td>
<td>The storage driver for the Docker volume. See
<a href="https://docs.docker.com/storage/storagedriver/select-storage-driver">"Docker storage drivers"</a> for supported
options.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Note:</strong> If copying and pasting the command snippet above does not work, try
copying and pasting this annotation-free version here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="bash">docker run <span class="nt">--name</span> jenkins-docker <span class="nt">--rm</span> <span class="nt">--detach</span> <span class="se">\</span>
  <span class="nt">--privileged</span> <span class="nt">--network</span> jenkins <span class="nt">--network-alias</span> docker <span class="se">\</span>
  <span class="nt">--env</span> <span class="nv">DOCKER_TLS_CERTDIR</span><span class="o">=</span>/certs <span class="se">\</span>
  <span class="nt">--volume</span> jenkins-docker-certs:/certs/client <span class="se">\</span>
  <span class="nt">--volume</span> jenkins-data:/var/jenkins_home <span class="se">\</span>
  <span class="nt">--publish</span> 3000:3000 <span class="nt">--publish</span> 5000:5000 <span class="nt">--publish</span> 2376:2376 <span class="se">\</span>
  docker:dind <span class="nt">--storage-driver</span> overlay2</code></pre>
</div>
</div>
</li>
<li>
<p>Customise official Jenkins Docker image, by executing below two steps:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create Dockerfile with the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code>FROM jenkins/jenkins:2.375.1
USER root
RUN apt-get update &amp;&amp; apt-get install -y lsb-release
RUN curl -fsSLo /usr/share/keyrings/docker-archive-keyring.asc \
  https://download.docker.com/linux/debian/gpg
RUN echo "deb [arch=$(dpkg --print-architecture) \
  signed-by=/usr/share/keyrings/docker-archive-keyring.asc] \
  https://download.docker.com/linux/debian \
  $(lsb_release -cs) stable" &gt; /etc/apt/sources.list.d/docker.list
RUN apt-get update &amp;&amp; apt-get install -y docker-ce-cli
USER jenkins
RUN jenkins-plugin-cli --plugins "blueocean docker-workflow"</code></pre>
</div>
</div>
</li>
<li>
<p>Build a new docker image from this Dockerfile and assign the image a meaningful name, e.g. "myjenkins-blueocean:2.375.1-1":</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="bash">docker build <span class="nt">-t</span> myjenkins-blueocean:2.375.1-1 .</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keep in mind that the process described above will automatically download the official Jenkins Docker image
if this hasn&#8217;t been done before.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Run your own <code>myjenkins-blueocean:2.375.1-1</code> image as a container in Docker using the
following
<a href="https://docs.docker.com/engine/reference/run/"><code>docker run</code></a>
command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="bash">docker run <span class="se">\</span>
  <span class="nt">--name</span> jenkins-blueocean <span class="se">\</span><i class="conum" data-value="1"></i><b>(1)</b>
  <span class="nt">--detach</span> <span class="se">\</span><i class="conum" data-value="2"></i><b>(2)</b>
  <span class="nt">--network</span> jenkins <span class="se">\</span><i class="conum" data-value="3"></i><b>(3)</b>
  <span class="nt">--env</span> <span class="nv">DOCKER_HOST</span><span class="o">=</span>tcp://docker:2376 <span class="se">\</span><i class="conum" data-value="4"></i><b>(4)</b>
  <span class="nt">--env</span> <span class="nv">DOCKER_CERT_PATH</span><span class="o">=</span>/certs/client <span class="se">\</span>
  <span class="nt">--env</span> <span class="nv">DOCKER_TLS_VERIFY</span><span class="o">=</span>1 <span class="se">\</span>
  <span class="nt">--publish</span> 8080:8080 <span class="se">\</span><i class="conum" data-value="5"></i><b>(5)</b>
  <span class="nt">--publish</span> 50000:50000 <span class="se">\</span><i class="conum" data-value="6"></i><b>(6)</b>
  <span class="nt">--volume</span> jenkins-data:/var/jenkins_home <span class="se">\</span><i class="conum" data-value="7"></i><b>(7)</b>
  <span class="nt">--volume</span> jenkins-docker-certs:/certs/client:ro <span class="se">\</span><i class="conum" data-value="8"></i><b>(8)</b>
  <span class="nt">--volume</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">"</span>:/home <span class="se">\</span><i class="conum" data-value="9"></i><b>(9)</b>
  <span class="nt">--restart</span><span class="o">=</span>on-failure <span class="se">\</span><i class="conum" data-value="10"></i><b>(10)</b>
  <span class="nt">--env</span> <span class="nv">JAVA_OPTS</span><span class="o">=</span><span class="s2">"-Dhudson.plugins.git.GitSCM.ALLOW_LOCAL_CHECKOUT=true"</span> <span class="se">\</span><i class="conum" data-value="11"></i><b>(11)</b>
  myjenkins-blueocean:2.375.1-1 <i class="conum" data-value="12"></i><b>(12)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>( <em>Optional</em> ) Specifies the Docker container name for this instance of
the Docker image.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>( <em>Optional</em> ) Runs the current container in the background
(i.e. "detached" mode) and outputs the container ID. If you do not specify this
option, then the running Docker log for this container is output in the terminal
window.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Connects this container to the <code>jenkins</code> network defined in the earlier
step. This makes the Docker daemon from the previous step available to this
Jenkins container through the hostname <code>docker</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specifies the environment variables used by <code>docker</code>, <code>docker-compose</code>, and
other Docker tools to connect to the Docker daemon from the previous step.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Maps (i.e. "publishes") port 8080 of the current container to
port 8080 on the host machine. The first number represents the port on the host
while the last represents the container&#8217;s port. Therefore, if you specified <code>-p
49000:8080</code> for this option, you would be accessing Jenkins on your host machine
through port 49000.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>( <em>Optional</em> ) Maps port 50000 of the current container to
port 50000 on the host machine. This is only necessary if you have set up one or
more inbound Jenkins agents on other machines, which in turn interact with
your <code>jenkins-blueocean</code> container (the Jenkins "controller").
Inbound Jenkins agents communicate with the Jenkins
controller through TCP port 50000 by default. You can change this port number on
your Jenkins controller through the <a href="/doc/book/managing/security">Configure Global Security</a>
page. If you were to change the <strong>TCP port for inbound Jenkins agents</strong> of your Jenkins controller
to 51000 (for example), then you would need to re-run Jenkins (via this
<code>docker run &#8230;&#8203;</code> command) and specify this "publish" option with something like
<code>--publish 52000:51000</code>, where the last value matches this changed value on the
Jenkins controller and the first value is the port number on the machine hosting
the Jenkins controller. Inbound Jenkins agents communicate with the
Jenkins controller on that port (52000 in this example).
Note that <a href="/blog/2020/02/02/web-socket/">WebSocket agents</a> do not need this configuration.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Maps the <code>/var/jenkins_home</code> directory in the container to the Docker
<a href="https://docs.docker.com/engine/admin/volumes/volumes/">volume</a> with the name
<code>jenkins-data</code>. Instead of mapping the <code>/var/jenkins_home</code> directory to a Docker
volume, you could also map this directory to one on your machine&#8217;s local file
system. For example, specifying the option<br>
<code>--volume $HOME/jenkins:/var/jenkins_home</code> would map the container&#8217;s
<code>/var/jenkins_home</code> directory to the <code>jenkins</code> subdirectory within the <code>$HOME</code>
directory on your local machine, which would typically be
<code>/Users/&lt;your-username&gt;/jenkins</code> or <code>/home/&lt;your-username&gt;/jenkins</code>.
Note that if you change the source volume or directory for this, the volume
from the <code>docker:dind</code> container above needs to be updated to match this.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Maps the <code>/certs/client</code> directory to the previously created
<code>jenkins-docker-certs</code> volume. This makes the client TLS certificates needed
to connect to the Docker daemon available in the path specified by the
<code>DOCKER_CERT_PATH</code> environment variable.</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Maps the <code>$HOME</code> directory on the host (i.e. your local) machine (usually
the <code>/Users/&lt;your-username&gt;</code> directory) to the <code>/home</code> directory in the
container. Used to access local changes to the tutorial repository.</td>
</tr>
<tr>
<td><i class="conum" data-value="10"></i><b>10</b></td>
<td>Configure the Docker container restart policy to restart on failure as described in the <a href="/blog/2022/05/27/docker-image-new-lifecycle/">blog post</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="11"></i><b>11</b></td>
<td>Allow local checkout for the tutorial.
See <a href="/security/advisory/2022-05-17/#SECURITY-2478">SECURITY-2478</a> for the reasons why this argument should not be used on a production installation.</td>
</tr>
<tr>
<td><i class="conum" data-value="12"></i><b>12</b></td>
<td>The name of the Docker image, which you built in the previous step.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Note:</strong> If copying and pasting the command snippet above does not work, try
copying and pasting this annotation-free version here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="bash">docker run <span class="nt">--name</span> jenkins-blueocean <span class="nt">--detach</span> <span class="se">\</span>
  <span class="nt">--network</span> jenkins <span class="nt">--env</span> <span class="nv">DOCKER_HOST</span><span class="o">=</span>tcp://docker:2376 <span class="se">\</span>
  <span class="nt">--env</span> <span class="nv">DOCKER_CERT_PATH</span><span class="o">=</span>/certs/client <span class="nt">--env</span> <span class="nv">DOCKER_TLS_VERIFY</span><span class="o">=</span>1 <span class="se">\</span>
  <span class="nt">--publish</span> 8080:8080 <span class="nt">--publish</span> 50000:50000 <span class="se">\</span>
  <span class="nt">--volume</span> jenkins-data:/var/jenkins_home <span class="se">\</span>
  <span class="nt">--volume</span> jenkins-docker-certs:/certs/client:ro <span class="se">\</span>
  <span class="nt">--volume</span> <span class="s2">"</span><span class="nv">$HOME</span><span class="s2">"</span>:/home <span class="se">\</span>
  <span class="nt">--restart</span><span class="o">=</span>on-failure <span class="se">\</span>
  <span class="nt">--env</span> <span class="nv">JAVA_OPTS</span><span class="o">=</span><span class="s2">"-Dhudson.plugins.git.GitSCM.ALLOW_LOCAL_CHECKOUT=true"</span> <span class="se">\</span>
  myjenkins-blueocean:2.375.1-1</code></pre>
</div>
</div>
</li>
<li>
<p>Proceed to the <a href="#setup-wizard">Post-installation setup wizard</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="on-windows"><a class="anchor" href="#on-windows"></a>On Windows</h4>
<div class="paragraph">
<p>The Jenkins project provides a Linux container image, not a Windows container image.
Be sure that your Docker for Windows installation is configured to run <code>Linux Containers</code> rather than <code>Windows Containers</code>.
See the Docker documentation for instructions to <a href="https://docs.docker.com/docker-for-windows/#switch-between-windows-and-linux-containers">switch to Linux containers</a>.
Once configured to run <code>Linux Containers</code>, the steps are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open up a command prompt window and similar to the <a href="#on-macos-and-linux">macOS and Linux</a> instructions above do the following:</p>
</li>
<li>
<p>Create a bridge network in Docker</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="bash">docker network create jenkins</code></pre>
</div>
</div>
</li>
<li>
<p>Run a docker:dind Docker image</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code>docker run --name jenkins-docker --detach ^
  --privileged --network jenkins --network-alias docker ^
  --env DOCKER_TLS_CERTDIR=/certs ^
  --volume jenkins-docker-certs:/certs/client ^
  --volume jenkins-data:/var/jenkins_home ^
  --publish 3000:3000 --publish 5000:5000 --publish 2376:2376 ^
  docker:dind</code></pre>
</div>
</div>
</li>
<li>
<p>Customise official Jenkins Docker image, by executing below two steps:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create Dockerfile with the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code>FROM jenkins/jenkins:2.375.1
USER root
RUN apt-get update &amp;&amp; apt-get install -y lsb-release
RUN curl -fsSLo /usr/share/keyrings/docker-archive-keyring.asc \
  https://download.docker.com/linux/debian/gpg
RUN echo "deb [arch=$(dpkg --print-architecture) \
  signed-by=/usr/share/keyrings/docker-archive-keyring.asc] \
  https://download.docker.com/linux/debian \
  $(lsb_release -cs) stable" &gt; /etc/apt/sources.list.d/docker.list
RUN apt-get update &amp;&amp; apt-get install -y docker-ce-cli
USER jenkins
RUN jenkins-plugin-cli --plugins "blueocean docker-workflow"</code></pre>
</div>
</div>
</li>
<li>
<p>Build a new docker image from this Dockerfile and assign the image a meaningful name, e.g. "myjenkins-blueocean:2.375.1-1":</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="bash">docker build <span class="nt">-t</span> myjenkins-blueocean:2.375.1-1 .</code></pre>
</div>
</div>
<div class="paragraph">
<p>Keep in mind that the process described above will automatically download the official Jenkins Docker image
if this hasn&#8217;t been done before.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Run your own <code>myjenkins-blueocean:2.375.1-1</code> image as a container in Docker using the following
<a href="https://docs.docker.com/engine/reference/run/"><code>docker run</code></a>
command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code>docker run --name jenkins-blueocean --detach ^
  --network jenkins --env DOCKER_HOST=tcp://docker:2376 ^
  --env DOCKER_CERT_PATH=/certs/client --env DOCKER_TLS_VERIFY=1 ^
  --volume jenkins-data:/var/jenkins_home ^
  --volume jenkins-docker-certs:/certs/client:ro ^
  --volume "%HOMEDRIVE%%HOMEPATH%":/home ^
  --restart=on-failure ^
  --env JAVA_OPTS="-Dhudson.plugins.git.GitSCM.ALLOW_LOCAL_CHECKOUT=true" ^
  --publish 8080:8080 --publish 50000:50000 myjenkins-blueocean:2.375.1-1</code></pre>
</div>
</div>
</li>
<li>
<p>Proceed to the <a href="#setup-wizard">Setup wizard</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="accessing-the-jenkins-blue-ocean-docker-container"><a class="anchor" href="#accessing-the-jenkins-blue-ocean-docker-container"></a>Accessing the Docker container</h4>
<div class="paragraph">
<p>If you have some experience with Docker and you wish or need to access your
Docker container through a terminal/command prompt using the
<a href="https://docs.docker.com/engine/reference/commandline/exec/"><code>docker exec</code></a>
command, you can add an option like <code>--name jenkins-tutorial</code> to the <code>docker exec</code> command.
That will access the Jenkins Docker container named "jenkins-tutorial".</p>
</div>
<div class="paragraph">
<p>This means you could access your docker container (through a separate
terminal/command prompt window) with a <code>docker exec</code> command like:</p>
</div>
<div class="paragraph">
<p><code>docker exec -it jenkins-blueocean bash</code></p>
</div>
</div>
<div class="sect3">
<h4 id="accessing-the-jenkins-console-log-through-docker-logs"><a class="anchor" href="#accessing-the-jenkins-console-log-through-docker-logs"></a>Accessing the Docker logs</h4>
<div class="paragraph">
<p>There is a possibility you may need to access the Jenkins console log, for
instance, when <a href="#unlocking-jenkins">Unlocking Jenkins</a> as part of the
<a href="#setup-wizard">Post-installation setup wizard</a>.</p>
</div>
<div class="paragraph">
<p>The Jenkins console log is easily accessible through the terminal/command
prompt window from which you executed the <code>docker run &#8230;&#8203;</code> command.
In case if needed you can also access the Jenkins console log through the
<a href="https://docs.docker.com/engine/reference/commandline/logs/">Docker logs</a> of
your container using the following command:</p>
</div>
<div class="paragraph">
<p><code>docker logs &lt;docker-container-name&gt;</code></p>
</div>
<div class="paragraph">
<p>Your <code>&lt;docker-container-name&gt;</code> can be obtained using the <code>docker ps</code> command.</p>
</div>
</div>
<div class="sect3">
<h4 id="accessing-the-jenkins-home-directory"><a class="anchor" href="#accessing-the-jenkins-home-directory"></a>Accessing the Jenkins home directory</h4>
<div class="paragraph">
<p>There is a possibility you may need to access the Jenkins home directory, for
instance, to check the details of a Jenkins build in the <code>workspace</code>
subdirectory.</p>
</div>
<div class="paragraph">
<p>If you mapped the Jenkins home directory (<code>/var/jenkins_home</code>) to one on your
machine&#8217;s local file system (i.e. in the <code>docker run &#8230;&#8203;</code> command
<a href="#downloading-and-running-jenkins-in-docker">above</a>), then you can access the
contents of this directory through your machine&#8217;s usual terminal/command prompt.</p>
</div>
<div class="paragraph">
<p>Otherwise, if you specified the <code>--volume jenkins-data:/var/jenkins_home</code> option in
the <code>docker run &#8230;&#8203;</code> command, you can access the contents of the Jenkins home
directory through your container&#8217;s terminal/command prompt using the
<a href="https://docs.docker.com/engine/reference/commandline/container_exec/"><code>docker container exec</code></a>
command:</p>
</div>
<div class="paragraph">
<p><code>docker container exec -it &lt;docker-container-name&gt; bash</code></p>
</div>
<div class="paragraph">
<p>As mentioned <a href="#accessing-the-jenkins-console-log-through-docker-logs">above</a>,
your <code>&lt;docker-container-name&gt;</code> can be obtained using the
<a href="https://docs.docker.com/engine/reference/commandline/container_ls/"><code>docker container ls</code></a>
command. If you specified the<br>
<code>--name jenkins-blueocean</code> option in the <code>docker container run &#8230;&#8203;</code>
command above (see also
<a href="#accessing-the-jenkins-blue-ocean-docker-container">Accessing the Jenkins/Blue
Ocean Docker container</a>), you can simply use the <code>docker container exec</code> command:</p>
</div>
<div class="paragraph">
<p><code>docker container exec -it jenkins-blueocean bash</code></p>
</div>
</div>
<div class="sect3">
<h4 id="setup-wizard"><a class="anchor" href="#setup-wizard"></a>Setup wizard</h4>
<div class="paragraph">
<p>Before you can access Jenkins, there are a few quick "one-off" steps you&#8217;ll need
to perform.</p>
</div>
<div class="sect4">
<h5 id="unlocking-jenkins"><a class="anchor" href="#unlocking-jenkins"></a>Unlocking Jenkins</h5>
<div class="paragraph">
<p>When you first access a new Jenkins instance, you are asked to unlock it using
an automatically-generated password.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>After the 2 sets of asterisks appear in the terminal/command prompt window,
browse to <code>http://localhost:8080</code> and wait until the <strong>Unlock Jenkins</strong> page
appears.</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/setup-jenkins-01-unlock-jenkins-page.jpg" alt="Unlock Jenkins page" width="100%"></span></p>
</div>
</li>
<li>
<p>Display the Jenkins console log with the command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code>docker logs jenkins-blueocean</code></pre>
</div>
</div>
</li>
<li>
<p>From your terminal/command prompt window again, copy the
automatically-generated alphanumeric password (between the 2 sets of
asterisks).</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/setup-jenkins-02-copying-initial-admin-password.png" alt="Copying initial admin password" width="100%"></span></p>
</div>
</li>
<li>
<p>On the <strong>Unlock Jenkins</strong> page, paste this password into the <strong>Administrator
password</strong> field and click <strong>Continue</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="customizing-jenkins-with-plugins"><a class="anchor" href="#customizing-jenkins-with-plugins"></a>Customizing Jenkins with plugins</h5>
<div class="paragraph">
<p>After <a href="#unlocking-jenkins">unlocking Jenkins</a>, the <strong>Customize Jenkins</strong> page
appears.</p>
</div>
<div class="paragraph">
<p>On this page, click <strong>Install suggested plugins</strong>.</p>
</div>
<div class="paragraph">
<p>The setup wizard shows the progression of Jenkins being configured and the
suggested plugins being installed. This process may take a few minutes.</p>
</div>
</div>
<div class="sect4">
<h5 id="creating-the-first-administrator-user"><a class="anchor" href="#creating-the-first-administrator-user"></a>Creating the first administrator user</h5>
<div class="paragraph">
<p>Finally, Jenkins asks you to create your first administrator user.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When the <strong>Create First Admin User</strong> page appears, specify your details in the
respective fields and click <strong>Save and Finish</strong>.</p>
</li>
<li>
<p>When the <strong>Jenkins is ready</strong> page appears, click <strong>Start using Jenkins</strong>.<br>
<strong>Notes:</strong></p>
<div class="ulist">
<ul>
<li>
<p>This page may indicate <strong>Jenkins is almost ready!</strong> instead and if so, click
<strong>Restart</strong>.</p>
</li>
<li>
<p>If the page doesn&#8217;t automatically refresh after a minute, use your web browser
to refresh the page manually.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If required, log in to Jenkins with the credentials of the user you just
created and you&#8217;re ready to start using Jenkins!</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="stopping-and-restarting-jenkins"><a class="anchor" href="#stopping-and-restarting-jenkins"></a>Stopping and restarting Jenkins</h4>
<div class="paragraph">
<p>Throughout the remainder of this tutorial, you can stop your
Docker container by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="bash">docker stop jenkins-blueocean jenkins-docker</code></pre>
</div>
</div>
<div class="paragraph">
<p>To restart your Docker container:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the same <code>docker run &#8230;&#8203;</code> commands you ran for <a href="#on-macos-and-linux">macOS, Linux</a> or
<a href="#on-windows">Windows</a> above.<br></p>
</li>
<li>
<p>Browse to <code>http://localhost:8080</code>.</p>
</li>
<li>
<p>Wait until the log in page appears and log in.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="fork-and-clone-the-sample-repository-on-github"><a class="anchor" href="#fork-and-clone-the-sample-repository-on-github"></a>Fork and clone the sample repository</h3>
<div class="paragraph">
<p>Obtain the simple "Welcome to React" Node.js and React application from GitHub,
by forking the sample repository of the application&#8217;s source code into your own
GitHub account and then cloning this fork locally.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ensure you are signed in to your GitHub account. If you don&#8217;t yet have a
GitHub account, sign up for a free one on the <a href="https://github.com/">GitHub
website</a>.</p>
</li>
<li>
<p>Fork the
<a href="https://github.com/jenkins-docs/building-a-multibranch-pipeline-project"><code>building-a-multibranch-pipeline-project</code></a>
on GitHub into your local GitHub account. If you need help with this process,
refer to the <a href="https://help.github.com/articles/fork-a-repo/">Fork A Repo</a>
documentation on the GitHub website for more information.</p>
</li>
<li>
<p>Clone your forked <code>building-a-multibranch-pipeline-project</code> repository (on
GitHub) locally to your machine. To begin this process, do either of the
following (where <code>&lt;your-username&gt;</code> is the name of your user account on your
operating system):</p>
<div class="ulist">
<ul>
<li>
<p>If you have the GitHub Desktop app installed on your machine:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In GitHub, click the green <strong>Clone or download</strong> button on your forked
repository, then <strong>Open in Desktop</strong>.</p>
</li>
<li>
<p>In GitHub Desktop, before clicking <strong>Clone</strong> on the <strong>Clone a Repository</strong> dialog
box, ensure <strong>Local Path</strong> for:</p>
<div class="ulist">
<ul>
<li>
<p>macOS is <code>/Users/&lt;your-username&gt;/Documents/GitHub/building-a-multibranch-pipeline-project</code></p>
</li>
<li>
<p>Linux is <code>/home/&lt;your-username&gt;/GitHub/building-a-multibranch-pipeline-project</code></p>
</li>
<li>
<p>Windows is <code>C:\Users\&lt;your-username&gt;\Documents\GitHub\building-a-multibranch-pipeline-project</code></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Otherwise:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Open up a terminal/command line prompt and <code>cd</code> to the appropriate directory
on:</p>
<div class="ulist">
<ul>
<li>
<p>macOS - <code>/Users/&lt;your-username&gt;/Documents/GitHub/</code></p>
</li>
<li>
<p>Linux - <code>/home/&lt;your-username&gt;/GitHub/</code></p>
</li>
<li>
<p>Windows - <code>C:\Users\&lt;your-username&gt;\Documents\GitHub\</code> (although use a Git
bash command line window as opposed to the usual Microsoft command prompt)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Run the following command to continue/complete cloning your forked repo:<br>
<code>git clone https://github.com/YOUR-GITHUB-ACCOUNT-NAME/building-a-multibranch-pipeline-project</code><br>
where <code>YOUR-GITHUB-ACCOUNT-NAME</code> is the name of your GitHub account.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="create-development-and-production-branches-in-your-repository"><a class="anchor" href="#create-development-and-production-branches-in-your-repository"></a>Create development and production branches in your repository</h3>
<div class="paragraph">
<p>Before creating your Pipeline project in Jenkins, create "development" and
"production" branches of your locally cloned Git repository. You&#8217;ll be creating
a single Jenkinsfile (initially in the <code>master</code> branch, which you&#8217;ll pull into
the other branches) whose stages will be selectively executed based on the
branch that Jenkins is building from.</p>
</div>
<div class="paragraph">
<p>Within the <code>building-a-multibranch-pipeline-project</code> directory (i.e. your local
clone of the sample repository):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the following commands to create
these branches (from the contents of the <code>master</code> branch):</p>
<div class="ulist">
<ul>
<li>
<p><code>git branch development</code><br>
and</p>
</li>
<li>
<p><code>git branch production</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Check that these branches now exist by running the command <code>git branch</code>, which
should give you:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="bash">  development
<span class="k">*</span> master
  production</code></pre>
</div>
</div>
</li>
<li>
<p>If the asterisk (indicating the current branch) does not appear next to
<code>master</code>, run the command <code>git checkout master</code> to ensure that <code>master</code> is the
current branch.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="create-your-pipeline-project-in-blue-ocean"><a class="anchor" href="#create-your-pipeline-project-in-blue-ocean"></a>Create your Pipeline project in Blue Ocean</h3>
<div class="paragraph">
<p>Whenever you create <em>any</em> Pipeline project in Blue Ocean, Jenkins actually
creates this as a multibranch Pipeline project behind the scenes. This becomes
apparent if you were to access Jenkins&#8217;s classic interface after creating a
Pipeline project in Blue Ocean; you&#8217;ll see that Jenkins will have created your
project as a "Multibranch Pipeline" project.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go back to Jenkins and ensure you have accessed the Blue Ocean interface. To
do this, make sure you:</p>
<div class="ulist">
<ul>
<li>
<p>have browsed to <code>http://localhost:8080/blue</code> and are logged in<br>
or</p>
</li>
<li>
<p>have browsed to <code>http://localhost:8080/</code>, are logged in and have clicked <strong>Open
Blue Ocean</strong> on the left.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>Welcome to Jenkins</strong> box at the center of the Blue Ocean interface,
click <strong>Create a new Pipeline</strong> to begin the Pipeline creation wizard.<br>
<strong>Note:</strong> If you don&#8217;t see this box, click <strong>New Pipeline</strong> at the top right.</p>
</li>
<li>
<p>In <strong>Where do you store your code?</strong>, click <strong>Git</strong> (<em>not</em> <strong>GitHub</strong>).</p>
</li>
<li>
<p>In the <strong>Repository URL</strong> field (within <strong>Connect to a Git repository</strong>), specify
the directory path of your locally cloned repository
<a href="#fork-sample-repository">above</a>, which is from your
user account/home directory on your host machine, mapped to the <code>/home</code>
directory of the Jenkins container - i.e.</p>
<div class="ulist">
<ul>
<li>
<p>For macOS - <code>/home/Documents/GitHub/building-a-multibranch-pipeline-project</code></p>
</li>
<li>
<p>For Linux - <code>/home/GitHub/building-a-multibranch-pipeline-project</code></p>
</li>
<li>
<p>For Windows - <code>/home/Documents/GitHub/building-a-multibranch-pipeline-project</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Save</strong> to save your new Pipeline project.<br>
Blue Ocean detects the presence of the <code>Jenkinsfile</code> "Pipeline stub" in each
branch and proceeds to run each Pipeline against its respective branch, whose
build results are shown on the <strong>Activity</strong> page of the main Blue Ocean
interface.</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-01-main-blueocean-interface.png" alt="Main Blue Ocean interface" width="100%"></span></p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The Pipeline stub consists of the basic requirements for a valid Pipeline - i.e.
an <a href="/doc/book/pipeline/syntax#agent"><code>agent</code></a> and a
<a href="/doc/book/pipeline/syntax#stages"><code>stages</code></a> section, as well as a
<a href="/doc/book/pipeline/syntax#stage"><code>stage</code></a> directive.</p>
</div>
<div class="paragraph">
<p>The reason why the <code>building-a-multibranch-pipeline-project</code> repository includes
a <code>Jenkinsfile</code> Pipeline stub is that its presence in a branch makes Blue Ocean
detect that there&#8217;s something to build (i.e. the <code>Jenkinsfile</code>) immediately
after creating the Pipeline project in Blue Ocean, which in turn makes these
branches accessible through the Blue Ocean interface.</p>
</div>
<div class="paragraph">
<p>If you created a Pipeline project in Blue Ocean but didn&#8217;t have a Jenkinsfile in
one or more of your repository&#8217;s branches, then to access the branches in Blue
Ocean after subsequently pulling in/adding a <code>Jenkinsfile</code> to these branches,
either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the <strong>Scan Multibranch Pipeline Now</strong> feature in the Multibranch Pipeline
project (accessible through Jenkins&#8217;s classic interface),<br>
or</p>
</li>
<li>
<p>Implement webhooks into your Git repository.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="create-your-initial-pipeline-as-a-jenkinsfile-with-build-and-test-stages"><a class="anchor" href="#create-your-initial-pipeline-as-a-jenkinsfile-with-build-and-test-stages"></a>Create your initial Pipeline as a Jenkinsfile with build and test stages</h3>
<div class="paragraph">
<p>You&#8217;re now ready to create the Pipeline that will automate building your Node.js
and React application in Jenkins. Your Pipeline will be created as a
<code>Jenkinsfile</code>, which will be committed to the <code>master</code> branch of your locally
cloned Git repository (<code>building-a-multibranch-pipeline-project</code>).</p>
</div>
<div class="paragraph">
<p>First, create an initial Pipeline to download a Node Docker image and run it as
a Docker container that will build your simple Node.js and React application.
Also add a "Build" stage to the Pipeline to begin orchestrating this whole
process and a "Test" stage to check that the application renders satisfactorily.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using your favorite text editor or IDE, open the existing <code>Jenkinsfile</code> at the
root of your local <code>building-a-multibranch-pipeline-project</code> Git repository
and <em>clear</em> its contents.<br>
<strong>Note:</strong> Be sure you are performing this step on the <code>master</code> branch of your
repository.</p>
</li>
<li>
<p>Copy the following Declarative Pipeline code and paste it into your empty
<code>Jenkinsfile</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="o">{</span>
        <span class="n">docker</span> <span class="o">{</span>
            <span class="n">image</span> <span class="s1">'node:lts-alpine'</span>
            <span class="n">args</span> <span class="s1">'-p 3000:3000 -p 5000:5000'</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">environment</span> <span class="o">{</span>
        <span class="n">CI</span> <span class="o">=</span> <span class="s1">'true'</span>
    <span class="o">}</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Build'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">sh</span> <span class="s1">'npm install'</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Test'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">sh</span> <span class="s1">'./jenkins/scripts/test.sh'</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This <code>args</code> parameter makes the Node container (temporarily) accessible
through ports 3000 and 5000. The significance of this is explained in the
<code>jenkins/scripts/deliver-for-deployment.sh</code> and
<code>jenkins/scripts/deploy-for-production.sh</code> files of your cloned repository, and
are covered in subsequent sections of this tutorial.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Note:</strong> For an explanation of the other components of this <code>Jenkinsfile</code>, refer
to the annotations of the Declarative Pipeline in the
<a href="../build-a-node-js-and-react-app-with-npm/#create-your-initial-pipeline-as-a-jenkinsfile"><code>Create
your initial Pipeline&#8230;&#8203;''</a> and
<a href="../build-a-node-js-and-react-app-with-npm/#add-a-test-stage-to-your-pipeline"></code>Add
a test stage&#8230;&#8203;''</a> sections of the
<a href="../build-a-node-js-and-react-app-with-npm/">Build a Node.js and React app
with npm</a> tutorial.</p>
</div>
</li>
<li>
<p>Save your edited <code>Jenkinsfile</code> and commit it to your local
<code>building-a-multibranch-pipeline-project</code> Git repository. E.g. Within the
<code>building-a-multibranch-pipeline-project</code> directory, run the commands:<br>
<code>git stage .</code><br>
then<br>
<code>git commit -m "Add initial Jenkinsfile with 'Test' stage"</code></p>
</li>
<li>
<p>Go back to Jenkins again, log in again if necessary and ensure you&#8217;ve accessed
Jenkins&#8217;s Blue Ocean interface.</p>
</li>
<li>
<p>Click <strong>Branches</strong> at the top right to access the list of your Pipeline
project&#8217;s branches.</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-11-branches-page.png" alt="Branches page" width="100%"></span></p>
</div>
</li>
<li>
<p>Click the run icon
<span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-12-run-icon.png" alt="Run icon" width="3%"></span>
of the <code>master</code> branch of your Pipeline project, then quickly click the <strong>OPEN</strong>
link that appears briefly at the lower-right to see Jenkins building the
<code>master</code> branch with the amended <code>Jenkinsfile</code>. If you weren&#8217;t able to click
the <strong>OPEN</strong> link, click the <em>top</em> row on the Blue Ocean <strong>Activity</strong> page to
access this feature.<br>
Within a few minutes, the Blue Ocean interface turns green if Jenkins built
your Node.js and React application successfully from your <code>master</code> branch.</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-13-build-and-test-stages-run-successfully-with-output.png" alt="Build and test stages run successfully with output" width="100%"></span></p>
</div>
</li>
<li>
<p>Click the <strong>X</strong> at the top-right to return to the <strong>Activity</strong> page of the Blue
Ocean interface.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="add-deliver-and-deploy-stages-to-your-pipeline"><a class="anchor" href="#add-deliver-and-deploy-stages-to-your-pipeline"></a>Add deliver and deploy stages to your Pipeline</h3>
<div class="paragraph">
<p>Next, add "Deliver for development" and "Deploy for production" stages to your
Pipeline, which Jenkins will selectively execute based on the branch that Jenkins is building from.</p>
</div>
<div class="paragraph">
<p>This takes the "Pipeline-as-Code" concept to a new level, in which a single
<code>Jenkinsfile</code> describes your project&#8217;s entire build, test, delivery and
deployment processes in Jenkins for each branch of your repository. Read more
about Pipeline and what a Jenkinsfile is in the
<a href="/doc/book/pipeline">Pipeline</a> and <a href="/doc/book/pipeline/jenkinsfile">Using
a Jenkinsfile</a> sections of the User Handbook.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go back to your text editor/IDE and ensure your <code>Jenkinsfile</code> is open.</p>
</li>
<li>
<p>Copy and paste the following Declarative Pipeline syntax immediately under the
<code>Test</code> stage of your <code>Jenkinsfile</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy">        <span class="n">stage</span><span class="o">(</span><span class="s1">'Deliver for development'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">when</span> <span class="o">{</span>
                <span class="n">branch</span> <span class="s1">'development'</span>
            <span class="o">}</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">sh</span> <span class="s1">'./jenkins/scripts/deliver-for-development.sh'</span>
                <span class="n">input</span> <span class="nl">message:</span> <span class="s1">'Finished using the web site? (Click "Proceed" to continue)'</span>
                <span class="n">sh</span> <span class="s1">'./jenkins/scripts/kill.sh'</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Deploy for production'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">when</span> <span class="o">{</span>
                <span class="n">branch</span> <span class="s1">'production'</span>
            <span class="o">}</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">sh</span> <span class="s1">'./jenkins/scripts/deploy-for-production.sh'</span>
                <span class="n">input</span> <span class="nl">message:</span> <span class="s1">'Finished using the web site? (Click "Proceed" to continue)'</span>
                <span class="n">sh</span> <span class="s1">'./jenkins/scripts/kill.sh'</span>
            <span class="o">}</span>
        <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>so that you end up with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
    <span class="n">agent</span> <span class="o">{</span>
        <span class="n">docker</span> <span class="o">{</span>
            <span class="n">image</span> <span class="s1">'node:lts-alpine'</span>
            <span class="n">args</span> <span class="s1">'-p 3000:3000 -p 5000:5000'</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">environment</span> <span class="o">{</span>
        <span class="n">CI</span> <span class="o">=</span> <span class="s1">'true'</span>
    <span class="o">}</span>
    <span class="n">stages</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Build'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">sh</span> <span class="s1">'npm install'</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Test'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">sh</span> <span class="s1">'./jenkins/scripts/test.sh'</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Deliver for development'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">when</span> <span class="o">{</span>
                <span class="n">branch</span> <span class="s1">'development'</span> <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="o">}</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">sh</span> <span class="s1">'./jenkins/scripts/deliver-for-development.sh'</span>
                <span class="n">input</span> <span class="nl">message:</span> <span class="s1">'Finished using the web site? (Click "Proceed" to continue)'</span>
                <span class="n">sh</span> <span class="s1">'./jenkins/scripts/kill.sh'</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Deploy for production'</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">when</span> <span class="o">{</span>
                <span class="n">branch</span> <span class="s1">'production'</span>  <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="o">}</span>
            <span class="n">steps</span> <span class="o">{</span>
                <span class="n">sh</span> <span class="s1">'./jenkins/scripts/deploy-for-production.sh'</span>
                <span class="n">input</span> <span class="nl">message:</span> <span class="s1">'Finished using the web site? (Click "Proceed" to continue)'</span>
                <span class="n">sh</span> <span class="s1">'./jenkins/scripts/kill.sh'</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>These <a href="/doc/book/pipeline/syntax#when"><code>when</code></a> directives (along with
their <code>branch</code> conditions) determine whether or not the
<a href="/doc/book/pipeline/syntax#stage"><code>stages</code></a> (containing these <code>when</code>
directives) should be executed. If a <code>branch</code> condition&#8217;s value (i.e. pattern)
matches the name of the branch that Jenkins is running the build from, then the
<code>stage</code> that contains this <code>when</code> and <code>branch</code> construct will be executed.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Notes:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>For an explanation of the <code>input message</code> steps, refer to annotation <strong>4</strong> of
the Declarative Pipeline at the
<a href="../build-a-node-js-and-react-app-with-npm/#add-a-final-deliver-stage-to-your-pipeline">``Add
a final deliver stage&#8230;&#8203;'' section of the Build a Node.js and React app</a>
tutorial.</p>
</li>
<li>
<p>For an explanation of the <code>deliver-for-development.sh</code>,
<code>deploy-for-production.sh</code> and <code>kill.sh</code> script steps, refer to the contents
of these files located in the <code>jenkins/scripts</code> directory from the root of the
<code>building-a-multibranch-pipeline-project</code> repository.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Save your edited <code>Jenkinsfile</code> and commit it to your local
<code>building-a-multibranch-pipeline-project</code> Git repository. E.g. Within the
<code>building-a-multibranch-pipeline-project</code> directory, run the commands:<br>
<code>git stage .</code><br>
then<br>
<code>git commit -m "Add 'Deliver&#8230;&#8203;' and 'Deploy&#8230;&#8203;' stages"</code></p>
</li>
<li>
<p>Go back to Jenkins again, log in again if necessary and ensure you&#8217;ve accessed
Jenkins&#8217;s Blue Ocean interface.</p>
</li>
<li>
<p>Click <strong>Branches</strong> at the top right to access the list of your Pipeline
project&#8217;s branches.</p>
</li>
<li>
<p>Click the run icon
<span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-12-run-icon.png" alt="Run icon" width="3%"></span>
of the <code>master</code> branch of your Pipeline project, then quickly click the <strong>OPEN</strong>
link that appears briefly at the lower-right to see Jenkins building the
<code>master</code> branch with the amended <code>Jenkinsfile</code>. If you weren&#8217;t able to click
the <strong>OPEN</strong> link, click the <em>top</em> row on the Blue Ocean <strong>Activity</strong> page to
access this feature.<br>
Notice how Jenkins skips the last two stages you added, since the branch you
are running the build from (<code>master</code>) does not meet the <code>when</code> directives'
<code>branch</code> conditions in these stages.</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-21-complete-pipeline-runs-successfully-on-master-branch.png" alt="Complete Pipeline runs successfully on the 'master' branch" width="100%"></span></p>
</div>
</li>
<li>
<p>Click the <strong>X</strong> at the top-right to return to the <strong>Activity</strong> page of the Blue
Ocean interface.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="pull-your-updated-jenkinsfile-into-the-other-repository-branches"><a class="anchor" href="#pull-your-updated-jenkinsfile-into-the-other-repository-branches"></a>Pull your updated Jenkinsfile into the other repository branches</h3>
<div class="paragraph">
<p>Now that you have a completed <code>Jenkinsfile</code> to build your application in
Jenkins, you can pull this file from the <code>master</code> branch of your local
repository into its <code>development</code> and <code>production</code> branches.</p>
</div>
<div class="paragraph">
<p>Within your local repository&#8217;s <code>building-a-multibranch-pipeline-project</code>
directory:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run the following commands to pull changes from <code>master</code> to
<code>development</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>git checkout development</code><br>
and</p>
</li>
<li>
<p><code>git pull . master</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Also run the following commands to pull changes from <code>master</code> to <code>production</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>git checkout production</code><br>
and</p>
</li>
<li>
<p><code>git pull . master</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Your <code>development</code> and <code>production</code> branches should now have all your
<code>Jenkinsfile</code> updates you made on the <code>master</code> branch.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="run-your-pipeline-on-the-development-branch"><a class="anchor" href="#run-your-pipeline-on-the-development-branch"></a>Run your Pipeline on the development branch</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go back to Jenkins again, log in again if necessary and ensure you&#8217;ve accessed
Jenkins&#8217;s Blue Ocean interface.</p>
</li>
<li>
<p>Click <strong>Branches</strong> at the top right to access the list of your Pipeline
project&#8217;s branches.</p>
</li>
<li>
<p>Click the run icon
<span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-12-run-icon.png" alt="Run icon" width="3%"></span>
of the <code>development</code> branch of your Pipeline project, then quickly click the
<strong>OPEN</strong> link that appears briefly at the lower-right to see Jenkins building
the <code>development</code> branch with the amended <code>Jenkinsfile</code>. If you weren&#8217;t able
to click the <strong>OPEN</strong> link, click the <em>top</em> row on the Blue Ocean <strong>Activity</strong>
page to access this feature.</p>
</li>
<li>
<p>Within a few minutes and when the build pauses, ensure you are viewing the
<strong>Deliver for development</strong> stage (click it if necessary), then click the top
green <strong>Shell Script</strong> step to expand its contents and scroll down until you see
the <code>http://localhost:3000</code> link.</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-31-deliver-for-development-stage-opened.png" alt="Shell Script step 'Deliver for development' stage opened" width="100%"></span><br>
  <strong>Note:</strong> Since you are building the application on a different branch, the <code>npm
  install</code> step will require a few minutes for <code>npm</code> to download the many
  dependencies required to run your Node.js and React application (stored in a
  local <code>node_modules</code> directory within the Jenkins home directory). These
  dependencies are downloaded again because this Jenkins build would be the
  first time you are running your Pipeline project on the <code>development</code> branch
  and each branch has its own workspace directory (containing its own
  <code>node_modules</code> directory) within the Jenkins home directory.</p>
</div>
</li>
<li>
<p>Click the <code>http://localhost:3000</code> link to view your Node.js and React
application running in development mode (with the <code>npm start</code> command) in a
new web browser tab. You should see a page/site with the title <strong>Welcome to
React</strong> on it.</p>
</li>
<li>
<p>When you are finished viewing the page/site, click the <strong>Proceed</strong> button in
Blue Ocean to complete the Pipeline&#8217;s execution.<br>
The Blue Ocean interface turns green if Jenkins built your Node.js and React
application successfully from your <code>development</code> branch. Notice how the
<strong>Deliver for development</strong> stage was executed but the <strong>Deploy for production</strong>
stage was not.</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-32-complete-pipeline-runs-successfully-on-development-branch.png" alt="Complete Pipeline runs successfully on the 'development' branch" width="100%"></span></p>
</div>
</li>
<li>
<p>Click the <strong>X</strong> at the top-right to return to the <strong>Activity</strong> page of the Blue
Ocean interface.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="run-your-pipeline-on-the-production-branch"><a class="anchor" href="#run-your-pipeline-on-the-production-branch"></a>Run your Pipeline on the production branch</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Branches</strong> at the top right to access the list of your Pipeline
project&#8217;s branches.</p>
</li>
<li>
<p>Click the run icon
<span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-12-run-icon.png" alt="Run icon" width="3%"></span>
of the <code>production</code> branch of your Pipeline project, then quickly click the
<strong>OPEN</strong> link that appears briefly at the lower-right to see Jenkins building
the <code>production</code> branch with the amended <code>Jenkinsfile</code>. If you weren&#8217;t able to
click the <strong>OPEN</strong> link, click the <em>top</em> row on the Blue Ocean <strong>Activity</strong> page
to access this feature.</p>
</li>
<li>
<p>Within a few minutes and when the build pauses, ensure you are viewing the
<strong>Deploy for production</strong> stage (click it if necessary), then click the top
green <strong>Shell Script</strong> step to expand its contents and scroll down until you see
the <code>http://localhost:5000</code> link.</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-41-deploy-for-production-stage-opened.png" alt="Shell Script step 'Deploy for production' stage opened" width="100%"></span><br></p>
</div>
</li>
<li>
<p>Click the <code>http://localhost:5000</code> link to view your Node.js and React
application in a new web browser tab. This will be running in production mode
from a production build of your source code (generated using the <code>npm run
build</code> command). Again, you should see a page/site with the title <strong>Welcome to
React</strong> on it. However, this time, the application&#8217;s contents are served by the
<a href="https://www.npmjs.com/package/serve">npm <code>serve</code> module</a> and are also
likely to continue running in the background in your browser.</p>
</li>
<li>
<p>When you are finished viewing the page/site, click the <strong>Proceed</strong> button in
Blue Ocean to complete the Pipeline&#8217;s execution.<br>
The Blue Ocean interface turns green if Jenkins built your Node.js and React
application successfully from your <code>production</code> branch. Notice how the
<strong>Deploy for production</strong> stage was executed but the <strong>Deliver for development</strong>
stage was skipped.</p>
<div class="paragraph boxshadow">
<p><span class="image"><img src="../../book/resources/tutorials/multibranch-pipeline-42-complete-pipeline-runs-successfully-on-production-branch.png" alt="Complete Pipeline runs successfully on the 'production' branch" width="100%"></span></p>
</div>
</li>
<li>
<p>Click the <strong>X</strong> at the top-right to return to the <strong>Activity</strong> page of the Blue
Ocean interface.<br>
<strong>Note:</strong> Since your browser is likely to continue running the application&#8217;s
content served by the npm <code>serve</code> module, your browser will still show the
content you viewed at <code>http://localhost:5000</code> long after Jenkins has killed
off the <code>serve</code> process. Read more about how to clear the application and its
content from your browser <a href="#clearing-the-app-from-your-browser">below</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="follow-up-optional"><a class="anchor" href="#follow-up-optional"></a>Follow up (optional)</h3>
<div class="paragraph">
<p>This section takes you through a simulated development workflow using
Jenkins, whereby changes made to your application (i.e. the <code>App.js</code> source
file) can be examined from the <code>development</code> branch before they are deployed to
production (from the <code>production</code> branch) via the <code>master</code> branch.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Within your local repository&#8217;s <code>building-a-multibranch-pipeline-project</code>
directory, run the command <code>git checkout development</code> to change to the
<code>development</code> branch.</p>
</li>
<li>
<p>Go back to your text editor/IDE and open the <code>App.js</code> file in the <code>src</code>
directory of your local <code>building-a-multibranch-pipeline-project</code> Git
repository.</p>
</li>
<li>
<p>Copy and paste the following HTML syntax immediately under the <code>To get
started&#8230;&#8203;</code> line of your <code>App.js</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="html">          <span class="nt">&lt;br/&gt;</span>
          This is a new line I added.</code></pre>
</div>
</div>
<div class="paragraph">
<p>so that you end up with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="javascript"><span class="k">import</span> <span class="nx">React</span><span class="p">,</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">react</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">logo</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">./logo.svg</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="dl">'</span><span class="s1">./App.css</span><span class="dl">'</span><span class="p">;</span>

<span class="kd">class</span> <span class="nx">App</span> <span class="kd">extends</span> <span class="nx">Component</span> <span class="p">{</span>
  <span class="nx">render</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">App</span><span class="dl">"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">header</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">App-header</span><span class="dl">"</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">src</span><span class="o">=</span><span class="p">{</span><span class="nx">logo</span><span class="p">}</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">App-logo</span><span class="dl">"</span> <span class="nx">alt</span><span class="o">=</span><span class="dl">"</span><span class="s2">logo</span><span class="dl">"</span> <span class="o">/&gt;</span>
          <span class="o">&lt;</span><span class="nx">h1</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">App-title</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Welcome</span> <span class="nx">to</span> <span class="nx">React</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/header</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="nx">p</span> <span class="nx">className</span><span class="o">=</span><span class="dl">"</span><span class="s2">App-intro</span><span class="dl">"</span><span class="o">&gt;</span>
          <span class="nx">To</span> <span class="kd">get</span> <span class="nx">started</span><span class="p">,</span> <span class="nx">edit</span> <span class="o">&lt;</span><span class="nx">code</span><span class="o">&gt;</span><span class="nx">src</span><span class="o">/</span><span class="nx">App</span><span class="p">.</span><span class="nx">js</span><span class="o">&lt;</span><span class="sr">/code&gt; and save to reload</span><span class="err">.
</span>          <span class="o">&lt;</span><span class="nx">br</span><span class="o">/&gt;</span>
          <span class="nx">This</span> <span class="nx">is</span> <span class="nx">a</span> <span class="k">new</span> <span class="nx">line</span> <span class="nx">I</span> <span class="nx">added</span><span class="p">.</span>
        <span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">export</span> <span class="k">default</span> <span class="nx">App</span><span class="p">;</span></code></pre>
</div>
</div>
</li>
<li>
<p>Save the edited <code>App.js</code> file and commit it to your local
<code>building-a-multibranch-pipeline-project</code> Git repository. E.g. Within the
<code>building-a-multibranch-pipeline-project</code> directory, run the commands:<br>
<code>git stage .</code><br>
then<br>
<code>git commit -m "Update 'App.js'"</code></p>
</li>
<li>
<p>Back in Blue Ocean, run your Pipeline on the <code>development</code> branch (as you did
<a href="#run-your-pipeline-on-the-development-branch">above</a>) and check the results
through <code>http://localhost:3000</code> to see your new line added.</p>
</li>
<li>
<p>Assuming you&#8217;re happy with the change, then within your local repository&#8217;s
<code>building-a-multibranch-pipeline-project</code> directory, run the following set of
commands to pull your change into the <code>production</code> branch (via the <code>master</code>
branch):</p>
<div class="ulist">
<ul>
<li>
<p><code>git checkout master</code><br>
and</p>
</li>
<li>
<p><code>git pull . development</code><br>
then</p>
</li>
<li>
<p><code>git checkout production</code><br>
and</p>
</li>
<li>
<p><code>git pull . master</code><br></p>
</li>
</ul>
</div>
</li>
<li>
<p>Back in Blue Ocean, run your Pipeline on the <code>production</code> branch this time (as
you did <a href="#run-your-pipeline-on-the-production-branch">above</a>) and check the
results through <code>http://localhost:5000</code> to see your new line added.<br>
<strong>Notes:</strong></p>
<div class="ulist">
<ul>
<li>
<p>Since your browser is likely to cache the contents of the npm <code>serve</code> module,
you may need to refresh your browser page to see your change.</p>
</li>
<li>
<p>In a real software development environment with small to large teams of
people, pulling changes between branches is more likely to be conducted using
pull requests on a cloud- or web-hosted Git service (such as GitHub or
BitBucket).</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="clearing-the-app-from-your-browser"><a class="anchor" href="#clearing-the-app-from-your-browser"></a>Clearing the app from your browser</h3>
<div class="paragraph">
<p>Your browser is likely to continue running your application&#8217;s content served by
the <a href="https://www.npmjs.com/package/serve">npm <code>serve</code> module</a>, which means
that your browser will still show the content you viewed at
<code>http://localhost:5000</code> long after Jenkins has killed off the <code>serve</code> process.
To clear the application and its content from your browser:</p>
</div>
<div class="sect3">
<h4 id="on-chrome"><a class="anchor" href="#on-chrome"></a>On Chrome</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the following into your browser&#8217;s URL field:<br>
<code>chrome://serviceworker-internals/</code></p>
</li>
<li>
<p>Locate the "ServiceWorker" entry for <code>http://localhost:5000</code></p>
</li>
<li>
<p>Click its <strong>Unregister</strong> button.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="on-firefox"><a class="anchor" href="#on-firefox"></a>On Firefox</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the following into your browser&#8217;s URL field:<br>
<code>about:serviceworkers</code></p>
</li>
<li>
<p>Locate the "Registered Service Worker" entry for <code>http://localhost:5000</code></p>
</li>
<li>
<p>Click its <strong>Unregister</strong> button.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="wrapping-up"><a class="anchor" href="#wrapping-up"></a>Wrapping up</h3>
<div class="paragraph">
<p>Well done! You&#8217;ve just used Jenkins to build a multibranch Pipeline project
with selectively run stages!</p>
</div>
<div class="paragraph">
<p>This tutorial demonstrated the power of using a single <code>Jenkinsfile</code> across
multiple branches of your repository to orchestrate different build and delivery
outcomes in Jenkins.</p>
</div>
<div class="paragraph">
<p>Because Jenkins is extremely extensible, it can be modified and configured to
handle practically any aspect of build orchestration and automation.</p>
</div>
<div class="paragraph">
<p>To learn more about what Jenkins can do, check out:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <a href="/doc/tutorials">Tutorials overview</a> page for other introductory
tutorials.</p>
</li>
<li>
<p>The <a href="/doc/book">User Handbook</a> for more detailed information about using
Jenkins, such as <a href="/doc/book/pipeline">Pipelines</a> (in particular
<a href="/doc/book/pipeline/syntax">Pipeline syntax</a>) and the
<a href="/doc/book/blueocean">Blue Ocean</a> interface.</p>
</li>
<li>
<p>The <a href="/node">Jenkins blog</a> for the latest events, other tutorials and
updates.</p>
</li>
</ul>
</div>
<hr>
<!-- HTML inclusion for chapter and section layouts (i.e. as footers) as well as
     for use in AsciiDoc file inclusions. -->

<!--
This feedback form was prepared from a Google Form, based on the techniques in
the following documentation sources:
https://codepen.io/learningcode/post/customize-a-google-form-for-your-website,
https://mrhaki.blogspot.com.au/2014/06/awesome-asciidoc-include-raw-html.html,
https://www.freshtechtips.com/2013/05/custom-google-drive-contact-form.html,
https://stackoverflow.com/questions/24436165/set-value-of-hidden-input-inside-form
-->

<!-- Feedback form functionality in JavaScript - refer to comments in this file
     for details on the functionality. -->
<script>
var feedbackForm = {
    formKey : 'e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w'
};
$(document).ready(function() {
    window.onload = feedbackForm.start(window.location.href);
});
</script>
<script src="/js/feedback-form-functionality.js"></script>

<p><a href="#feedback" data-bs-toggle="collapse">Was this page helpful?</a></p>

<div id="feedback" class="collapse">

<p>Please submit your feedback about this page through this
<a href="/doc/feedback-form/">quick form</a>.</p>

<p>Alternatively, if you don't wish to complete the quick form, you can simply
indicate if you found this page helpful?</p>

<!-- Redirects to custom "thank you" page once form is submitted. -->
<script type="text/javascript">
var submitted=false;
</script>
<iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"
onload="if(submitted) {window.location='/doc/thank-you-for-your-feedback/';}">
</iframe>
<form action="https://docs.google.com/forms/d/e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w/formResponse" method="POST" id="ss-form" target="hidden_iframe" onsubmit="submitted=true;">

<!-- Set the value of the current URL into the form. -->
<input type="hidden" name="entry.1246830226" id="current-url" value=""/>

<!-- The answer bit -->
<p><input type="radio" name="entry.790002525" id="h1" value="Yes" required/>
<label for="h1">Yes</label>&nbsp;&nbsp;&nbsp;&nbsp;
<input type="radio" name="entry.790002525" id="h2" value="No"/>
<label for="h2">No</label></p>

<!-- The CAPTCHA bit -->

<p><label id="ssTestLabel" for="ssTestValue"></label><br/>
<input type="text" name="ssTestValue" value="" id="ssTestValue"/></p>

<!-- Submit button -->

<p><input class="button" type="submit" value="Submit"/></p>

</form>

<p>See existing feedback <a href="https://docs.google.com/spreadsheets/d/1IIdpVs39JDYKg0sLQIv-MNO928qcGApAIfdW5ohfD78" target="_blank" rel="noreferrer noopener">here</a>.</p>

</div>
</div>
</div>
</div>
</div>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//doc/tutorials/build-a-multibranch-pipeline-project.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
