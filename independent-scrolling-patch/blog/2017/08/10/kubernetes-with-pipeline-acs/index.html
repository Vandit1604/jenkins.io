<!DOCTYPE html>
<html lang="en">
<head>
<title>
CI/CD with Jenkins Pipeline and Azure
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2017/08/10/kubernetes-with-pipeline-acs/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="CI/CD with Jenkins Pipeline and Azure" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="CI/CD with Jenkins Pipeline and Azure" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="CI/CD with Jenkins Pipeline and Azure" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2017/08/10/kubernetes-with-pipeline-acs/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="CI/CD with Jenkins Pipeline and Azure" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.app-post-page h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<article class="container app-post-page">
<div class="app-!-display-flex">
<a class="app-back-link" href="/jenkins.io/independent-scrolling-patch/node/">
Back to blog
</a>
</div>
<h1>
CI/CD with Jenkins Pipeline and Azure
</h1>
<div class="post-attrs">
<a class="app-author-link" href="/blog/authors/rtyler/"><div class="app-avatar"><img alt="R. Tyler Croy" class="app-avatar__image" src="/images/avatars/rtyler.jpeg"></div> R. Tyler Croy</a>
August 10, 2017
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/intent/tweet?text=CI%2FCD+with+Jenkins+Pipeline+and+Azure&amp;url=https%3A%2F%2Fwww.jenkins.io%2Fjenkins.io%2Findependent-scrolling-patch%2Fblog%2F2017%2F08%2F10%2Fkubernetes-with-pipeline-acs%2F" rel="noreferrer nofollow" target="_blank">
Tweet
</a>
</div>
<div class="blog-content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This is a guest post by <a href="https://github.com/puicchan">Pui Chee Chen</a>,
Product Manager at Microsoft working on
<a href="https://jenkinsworld20162017.sched.com/event/AK4K/azure-devops-open-source-integrations">Azure
DevOps open source integrations</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Recently, we improved the <a href="https://plugins.jenkins.io/azure-credentials">Azure Credential plugin</a> by
adding a custom binding for Azure Credentials which allows you to use an
<a href="https://docs.microsoft.com/en-us/cli/azure/create-an-azure-service-principal-azure-cli?toc=%2fazure%2fazure-resource-manager%2ftoc.json">Azure
service principal</a> (the analog to a service or system account) via  the
Credentials Binding plugin. This means it&#8217;s now trivial to run Azure CLI
commands from a Jenkins Pipeline. We also recently published the first version
of the <a href="https://plugins.jenkins.io/azure-app-service">Azure App Service plugin</a> which makes it <em>very</em>
easy to deploy
<a href="https://azure.microsoft.com/en-us/services/app-service/web/">Azure Web
Apps</a> directly from Jenkins Pipeline. While we&#8217;ll have
much more to discuss in our Jenkins World presentation on
<a href="https://jenkinsworld20162017.sched.com/event/AK4K/azure-devops-open-source-integrations">Azure
DevOps open source integrations</a>, in this blog post I wanted to share some good
snippets of what is possible today with Jenkins Pipeline and Azure.</p>
</div>
<div class="paragraph">
<p>First, a simple example using the Azure CLI to list resources in the
subscription:</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-script"
        style="display: true">
    <div class="title">Jenkinsfile (Scripted Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy">node {
    <span style="color:#777">/* .. snip .. */</span>
    stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Deploy</span><span style="color:#710">'</span></span>) {
        withCredentials([azureServicePrincipal(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">principal-credentials-id</span><span style="color:#710">'</span></span>)]) {
            sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">az login --service-principal -u $AZURE_CLIENT_ID -p $AZURE_CLIENT_SECRET -t $AZURE_TENANT_ID</span><span style="color:#710">'</span></span>
            sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">az account set -s $AZURE_SUBSCRIPTION_ID</span><span style="color:#710">'</span></span>
            sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">az resource list</span><span style="color:#710">'</span></span>
        }
    }
}</code></pre>
</div></div></div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>azureServicePrincipal()</code> cannot be used in Declarative Pipeline until
<a href="https://issues.jenkins.io/browse/JENKINS-46103">JENKINS-46103</a> is
resolved.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once a Pipeline can interact with Azure, there are countless ways one could
implement continuous delivery with Jenkins and Azure. From a deploying a simple
webapp with the
<a href="https://azure.microsoft.com/en-us/blog/annoucing-jenkins-deploy-to-azure-app-service-plugin-and-new-managed-disk-support-for-azure-storage-plugin/">Azure
App Service plugin</a> and the <code>azureWebAppPublish</code> step, or a more advanced
container-based delivery pipeline to deliver new containers to
<a href="https://docs.microsoft.com/en-us/azure/container-service/kubernetes/container-service-tutorial-kubernetes-deploy-cluster">Kubernetes
via Azure Container Service</a>.</p>
</div>
<div class="paragraph">
<p>With the <a href="https://plugins.jenkins.io/docker-workflow">Docker Pipeline plugin</a> and a little bit of
extra scripting, a Jenkins Pipeline can also build and publish a Docker
container to an
<a href="https://azure.microsoft.com/en-us/services/container-registry/">Azure
Container Registry</a>:</p>
</div>
<div class="pipeline-block">  <div class="listingblock pipeline-script"
        style="display: true">
    <div class="title">Jenkinsfile (Scripted Pipeline)</div>
    <div class="content">
  <pre class="CodeRay highlight nowrap"><code class="language-groovy" data-lang="groovy"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">groovy.json.JsonSlurper</span>

node {
    <span style="color:#080;font-weight:bold">def</span> container
    <span style="color:#080;font-weight:bold">def</span> acrSettings

    withCredentials([azureServicePrincipal(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">principal-credentials-id</span><span style="color:#710">'</span></span>)]) {
        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Prepare Environment</span><span style="color:#710">'</span></span>) {
            sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">az login --service-principal -u $AZURE_CLIENT_ID -p $AZURE_CLIENT_SECRET -t $AZURE_TENANT_ID</span><span style="color:#710">'</span></span>
            sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">az account set -s $AZURE_SUBSCRIPTION_ID</span><span style="color:#710">'</span></span>
            acrSettings = <span style="color:#080;font-weight:bold">new</span> JsonSlurper().parseText(
                                            sh(<span style="color:#606">script</span>: <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">az acs show -o json -n my-acr</span><span style="color:#710">&quot;</span></span>, <span style="color:#606">returnStdout</span>: <span style="color:#069">true</span>))
        }

        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Build</span><span style="color:#710">'</span></span>) {
            container = docker.build(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>acrSettings.loginServer<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">/my-app:</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>env.BUILD_ID<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>)
        }

        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Publish</span><span style="color:#710">'</span></span>) {
            <span style="color:#777">/* https://issues.jenkins.io/browse/JENKINS-46108 */</span>
            sh <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">docker login -u </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>AZURE_CLIENT_ID<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20"> -p </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>AZURE_CLIENT_SECRET<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20"> </span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">${</span>acrSettings.loginServer<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
            container.push()
        }

        stage(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Deploy</span><span style="color:#710">'</span></span>) {
            echo <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Orchestrating a new deployment with kubectl is a simple exercise left to the reader ;)</span><span style="color:#710">'</span></span>
        }
    }
}</code></pre>
</div></div></div>
<hr>
<div class="paragraph">
<p>If you have been following our
<a href="https://azure.microsoft.com/en-us/blog/tag/jenkins/">Azure Blog</a>, you may
have noticed we have shipped a <strong>lot</strong> of updates to provide better support for
Azure on Jenkins, and vice versa, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Hosted Jenkins</strong>. New
<a href="https://azuremarketplace.microsoft.com/en-us/marketplace/apps/azure-oss.jenkins">Solution
Template</a> in Azure Marketplace lets you spin up a
Jenkins Controller on Azure in minutes. Not only is it easy and fast, the solution
template gives you option to scale up by selecting the VM disk type and size.
And guess what? You can even select the Jenkins release type you want to use -
LTS, weekly build or Azure verified - all under your control.</p>
</li>
<li>
<p><strong>Continuous integration experience</strong>. In the latest version of our
<a href="https://plugins.jenkins.io/azure-vm-agents">Azure VM Agents plugin</a>, we improved the user
experience and added the option to let you to select Managed Disk for disk
type (which is currently used extensively on
<a href="https://ci.jenkins.io">ci.jenknis.io</a>. You no longer need to worry about
exceeding the number of VMs on your subscription.</p>
</li>
<li>
<p><strong>Continuous deployment experience</strong>. Now, if
Azure CLI is not your cup of tea, we released our first plugin to provide
continuous deployment support to Azure App Service. The plugin supports all
languages Azure App Service supports. We even have a walkthrough
<a href="https://docs.microsoft.com/en-us/azure/jenkins/deploy-jenkins-app-service-plugin">here</a> in the
brand new Jenkins Hub where you can find all Jenkins on Azure resources.</p>
</li>
<li>
<p><strong>Pipeline readiness</strong>. Also, all Azure plugins are and will be pipeline ready.
Have you been leveraging our
<a href="https://plugins.jenkins.io/windows-azure-storage">Azure Storage plugin</a> in your Pipeline?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>So, what’s next? We have a big surprise in store at Jenkins World! :)</p>
</div>
<div class="paragraph">
<p>We are serious about supporting open source and the open source community.
Be sure to catch our talk on
<a href="https://jenkinsworld20162017.sched.com/event/AK4K/azure-devops-open-source-integrations">Azure
DevOps open source integrations</a>.
See you at
<a href="https://www.cloudbees.com/jenkinsworld">Jenkins World 2017</a>!</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Join the Azure DevOps team at
<a href="https://www.cloudbees.com/jenkinsworld/home">Jenkins World</a> in August,
register with the code <code>JWFOSS</code> for a 30% discount off your pass.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<ul class="app-tags">
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/plugins/">
plugins
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/kubernetes/">
kubernetes
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/pipeline/">
pipeline
</a>
</li>
</ul>
<h2>
About the author
</h2>
<!-- starting partial author.html.haml -->
<div class="app-author" id="about-the-author">
<!-- starting partial avatar.html.haml -->
<div class="app-avatar" style="min-width: 64px; width: 25vw; max-width: 128px">
<img alt="R. Tyler Croy" class="app-avatar__image" src="/jenkins.io/independent-scrolling-patch/images/avatars/rtyler.jpeg">
</div>

<!-- ending partial avatar.html.haml -->
<div class="app-author__content">
<p class="app-author__name">
<a href="/blog/authors/rtyler/">
R. Tyler Croy
</a>
</p>
<div class="paragraph">
<p>R&#46; Tyler Croy has been part of the Jenkins project for the past seven years.
While avoiding contributing any Java code, Tyler is involved in many of the
other aspects of the project which keep it running, such as this website,
infrastructure, governance, etc.</p>
</div>
<!-- starting partial social-media-buttons.html.haml -->
<ul class="app-social-media-buttons">
<li>
<a href="https://github.com/rtyler" rel="noreferrer noopener" target="_blank">
GitHub
</a>
</li>
<li>
<a href="https://twitter.com/agentdero" rel="noreferrer noopener" target="_blank">
Twitter
</a>
</li>
<li>
<a href="http://unethicalblogger.com" rel="noreferrer noopener" target="_blank">
Blog
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</div>
</div>

<!-- ending partial author.html.haml -->
<!-- starting partial discuss.html.haml -->

<!-- ending partial discuss.html.haml -->
</article>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//blog/2017/08/2017-08-10-kubernetes-with-pipeline-acs.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
