<!DOCTYPE html>
<html lang="en">
<head>
<title>
External Fingerprint Storage Phase-2 Updates
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2020/07/24/external-fingerprint-storage-phase-2/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="External Fingerprint Storage Phase-2 Updates" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="External Fingerprint Storage Phase-2 Updates" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/post-images/2020/07-external-fingerprint-storage-phase-2/opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="External Fingerprint Storage Phase-2 Updates" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2020/07/24/external-fingerprint-storage-phase-2/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="External Fingerprint Storage Phase-2 Updates" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/post-images/2020/07-external-fingerprint-storage-phase-2/opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.app-post-page h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<article class="container app-post-page">
<div class="app-!-display-flex">
<a class="app-back-link" href="/jenkins.io/independent-scrolling-patch/node/">
Back to blog
</a>
</div>
<h1>
External Fingerprint Storage Phase-2 Updates
</h1>
<div class="post-attrs">
<a class="app-author-link" href="/blog/authors/stellargo/"><div class="app-avatar"><img alt="Sumit Sarin" class="app-avatar__image" src="/images/avatars/stellargo.jpeg"></div> Sumit Sarin</a>
July 24, 2020
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/intent/tweet?text=External+Fingerprint+Storage+Phase-2+Updates&amp;url=https%3A%2F%2Fwww.jenkins.io%2Fjenkins.io%2Findependent-scrolling-patch%2Fblog%2F2020%2F07%2F24%2Fexternal-fingerprint-storage-phase-2%2F" rel="noreferrer nofollow" target="_blank">
Tweet
</a>
</div>
<div class="blog-content">
<div class="paragraph">
<p>As another great phase for the
<a href="/projects/gsoc/2020/projects/external-fingerprint-storage/">External Fingerprint Storage Project</a>
comes to an end, we summarise the work done during this phase in this blog post.
It was an exciting and fruitful journey, just like the previous phase, and offered some great learning experience.</p>
</div>
<div class="paragraph">
<p>To understand what the project is about and the past progress, please refer to the
<a href="/blog/2020/06/27/external-fingerprint-storage/">phase 1 blog post</a>.</p>
</div>
<div class="sect1">
<h2 id="new-stories-completed"><a class="anchor" href="#new-stories-completed"></a>New Stories Completed</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We targeted four stories in this phase, namely fingerprint cleanup, fingerprint migration, refactoring the current
implementation to use descriptors, and improved testing of the Redis Fingerprint Storage Plugin.
We explain these stories in detail below.</p>
</div>
<div class="sect2">
<h3 id="fingerprint-cleanup"><a class="anchor" href="#fingerprint-cleanup"></a>Fingerprint Cleanup</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/jenkinsci/jenkins/pull/4817" class="bare">https://github.com/jenkinsci/jenkins/pull/4817</a></p>
</li>
<li>
<p><a href="https://github.com/jenkinsci/redis-fingerprint-storage-plugin/pull/23" class="bare">https://github.com/jenkinsci/redis-fingerprint-storage-plugin/pull/23</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This story involved extending the <code>FingerprintStorage</code> API to allow external storage plugins to perform and configure
their own fingerprint cleanup strategies.
We added the following functionalities to Jenkins core API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FingerprintStorage#iterateAndCleanupFingerprints(TaskListener taskListener)</code></p>
<div class="ulist">
<ul>
<li>
<p>This allows external fingerprint storage implementations to implement their own custom fingerprint cleanup.
The method is called periodically by Jenkins core.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>FingerprintStorage#cleanFingerprint(Fingerprint fingerprint, TaskListener taskListener)</code></p>
<div class="ulist">
<ul>
<li>
<p>This is a reference implementation which can be called by external storage plugins to clean up a fingerprint.
It is upto the plugin implementation to decide whether to use this method.
They may choose to write a custom implementation.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>We consume these new API functionalities in the
<a href="https://github.com/jenkinsci/redis-fingerprint-storage-plugin">Redis Fingerprint Storage plugin</a>.
The plugin uses cursors to traverse the fingerprints, updating the build information, and deleting the build-less
fingerprints.</p>
</div>
<div class="paragraph">
<p>Earlier, fingerprint cleanup was always run periodically and there was no way to turn it off.
We also added an option to allow the user to turn off fingerprint cleanup.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/images/post-images/2020/07-external-fingerprint-storage-phase-2/cleanup_disable.png" alt="Fingerprint cleanup disable"></span></p>
</div>
<div class="paragraph">
<p>This was done because it may be the case that keeping redundant fingerprints in memory might be cheaper than the
cleanup operation (especially in the case of external storages, which are cheaper these days).</p>
</div>
</div>
<div class="sect2">
<h3 id="fingerprint-migration"><a class="anchor" href="#fingerprint-migration"></a>Fingerprint Migration</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/jenkinsci/jenkins/pull/4825" class="bare">https://github.com/jenkinsci/jenkins/pull/4825</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Earlier, there was no support for fingerprints stored in the local storage.
In this phase, we introduce migration support for users.
The old fingerprints are now migrated to the new configured external storage whenever they are used (lazy migration).
This allows gradual migration of old fingerprints from local disk storage to the new external storage.</p>
</div>
</div>
<div class="sect2">
<h3 id="refactor-fingerprintstorage-to-use-descriptors"><a class="anchor" href="#refactor-fingerprintstorage-to-use-descriptors"></a>Refactor <code>FingerprintStorage</code> to use descriptors</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/jenkinsci/jenkins/pull/4834" class="bare">https://github.com/jenkinsci/jenkins/pull/4834</a></p>
</li>
<li>
<p><a href="https://github.com/jenkinsci/redis-fingerprint-storage-plugin/pull/36" class="bare">https://github.com/jenkinsci/redis-fingerprint-storage-plugin/pull/36</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Earlier, whenever an external fingerprint storage plugin was installed, it was enabled by default.
We refactored the implementation to make use of <code>Descriptor</code> pattern so the fingerprint engine can now be selected
as a dropdown from the Jenkins configuration page.
The dropdown is shown only when multiple fingerprint storage engines are configured on the system.
<a href="https://github.com/jenkinsci/redis-fingerprint-storage-plugin">Redis Fingerprint Storage Plugin</a> was refactored
to use this new implementation.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="/images/post-images/2020/07-external-fingerprint-storage-phase-2/fingerprint_storage_engine_dropdown.png" alt="Fingerprint Storage Engine Dropdown"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="strengthened-testing-for-the-redis-fingerprint-storage-plugin"><a class="anchor" href="#strengthened-testing-for-the-redis-fingerprint-storage-plugin"></a>Strengthened testing for the Redis Fingerprint Storage Plugin</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/jenkinsci/redis-fingerprint-storage-plugin/pull/33" class="bare">https://github.com/jenkinsci/redis-fingerprint-storage-plugin/pull/33</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We introduced new connection tests in the
<a href="https://github.com/jenkinsci/redis-fingerprint-storage-plugin">Redis Fingerprint Storage Plugin</a>.
These tests allow testing of cases like slow connection, breakage of connection to Redis, etc.
These were implemented using the Toxiproxy module inside Testcontainers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/jenkinsci/redis-fingerprint-storage-plugin/pull/31" class="bare">https://github.com/jenkinsci/redis-fingerprint-storage-plugin/pull/31</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We introduced test for Configuration-as-code (JCasC) compatibility with the plugin.
The documentation for configuring the plugin using JCasC was also added.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/jenkinsci/redis-fingerprint-storage-plugin/pull/39" class="bare">https://github.com/jenkinsci/redis-fingerprint-storage-plugin/pull/39</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We introduced a suite of authentication tests, to verify the proper working of the Redis authentication system.
Authentication uses the credentials plugin.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/jenkinsci/redis-fingerprint-storage-plugin/pull/32" class="bare">https://github.com/jenkinsci/redis-fingerprint-storage-plugin/pull/32</a></p>
</li>
<li>
<p><a href="https://github.com/jenkinsci/redis-fingerprint-storage-plugin/pull/36" class="bare">https://github.com/jenkinsci/redis-fingerprint-storage-plugin/pull/36</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We strengthened our web UI testing to ensure that the configuration page for the plugin works properly as planned.</p>
</div>
</div>
<div class="sect2">
<h3 id="other-miscellaneous-tasks"><a class="anchor" href="#other-miscellaneous-tasks"></a>Other miscellaneous tasks</h3>
<div class="paragraph">
<p>Please refer to the <a href="https://issues.jenkins.io/browse/JENKINS-62754">Jira Epic</a> for this phase.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="releases"><a class="anchor" href="#releases"></a>Releases 🚀</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Changes in the Jenkins core (except migration) were released in <a href="/changelog/#v2.248">Jenkins 2.248</a>.</p>
</div>
<div class="paragraph">
<p>We drafted <a href="https://github.com/jenkinsci/redis-fingerprint-storage-plugin/releases/tag/redis-fingerprint-storage-parent-1.0-rc-1">1.0-rc-1</a>
release for the <a href="https://github.com/jenkinsci/redis-fingerprint-storage-plugin">Redis Fingerprint Storage Plugin</a>
to deliver the changes.
This was an increment from the <a href="https://github.com/jenkinsci/redis-fingerprint-storage-plugin/releases/tag/redis-fingerprint-storage-parent-0.1-alpha-1">alpha release</a>
we had drafted at the end of the previous phase.
The plugin is now available at <a href="https://plugins.jenkins.io/redis-fingerprint-storage/" class="bare">https://plugins.jenkins.io/redis-fingerprint-storage/</a>!</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trying-out-the-new-features"><a class="anchor" href="#trying-out-the-new-features"></a>Trying out the new features!</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The latest release for the plugin can be downloaded from the update center, instructions for which can be
found in the <a href="https://github.com/jenkinsci/redis-fingerprint-storage-plugin/blob/master/README.adoc">README</a>
of the plugin.
We appreciate you trying out the plugin, and welcome any suggestions, feature requests, bug reports, etc.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="acknowledgements"><a class="anchor" href="#acknowledgements"></a>Acknowledgements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Redis Fingerprint Storage plugin is built and maintained by the Google Summer of Code (GSoC) Team for
<a href="/projects/gsoc/2020/projects/external-fingerprint-storage/">External Fingerprint Storage for
Jenkins</a>. Special thanks to <a href="https://github.com/oleg-nenashev">Oleg Nenashev</a>,
<a href="https://github.com/afalko">Andrey Falko</a>, <a href="https://github.com/mikecirioli">Mike Cirioli</a>,
<a href="https://github.com/timja">Tim Jacomb</a>, and the entire Jenkins community for all the contribution to this project.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="future-work"><a class="anchor" href="#future-work"></a>Future Work</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some of the topics we aim to tackle in the next phase include a new reference implementation (possibly backed
by PostgreSQL), tracing, etc.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reaching-out"><a class="anchor" href="#reaching-out"></a>Reaching Out</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Feel free to reach out to us for any questions, feedback, etc. on the project&#8217;s <a href="https://gitter.im/jenkinsci/external-fingerprint-storage">Gitter Channel</a> or the <a href="mailto:jenkinsci-dev@googlegroups.com">Jenkins
Developer Mailing list</a>.
We use Jenkins <a href="https://issues.jenkins.io/">Jira</a> to track issues.
Feel free to file issues under <code>redis-fingerprint-storage-plugin</code> component.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="other-links"><a class="anchor" href="#other-links"></a>Other Links</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/jenkinsci/redis-fingerprint-storage-plugin">Redis Fingerprint Storage Plugin</a></p>
</li>
<li>
<p><a href="https://issues.jenkins.io/browse/JENKINS-62754">Issue Tracker for Phase 2</a></p>
</li>
<li>
<p><a href="https://github.com/jenkinsci/jep/blob/master/jep/226/README.adoc">JEP-226</a></p>
</li>
<li>
<p><a href="https://gitter.im/jenkinsci/external-fingerprint-storage">Gitter Channel</a></p>
</li>
<li>
<p><a href="/projects/gsoc/2020/projects/external-fingerprint-storage/">Project Page</a></p>
</li>
<li>
<p><a href="/blog/2020/06/27/external-fingerprint-storage/">Phase 1 Blog Post</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<ul class="app-tags">
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/plugins/">
plugins
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/fingerprint/">
fingerprint
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/cloud-native/">
cloud-native
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/external-storage/">
external-storage
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/developer/">
developer
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/redis/">
redis
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/gsoc/">
gsoc
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/gsoc2020/">
gsoc2020
</a>
</li>
</ul>
<h2>
About the author
</h2>
<!-- starting partial author.html.haml -->
<div class="app-author" id="about-the-author">
<!-- starting partial avatar.html.haml -->
<div class="app-avatar" style="min-width: 64px; width: 25vw; max-width: 128px">
<img alt="Sumit Sarin" class="app-avatar__image" src="/jenkins.io/independent-scrolling-patch/images/avatars/stellargo.jpeg">
</div>

<!-- ending partial avatar.html.haml -->
<div class="app-author__content">
<p class="app-author__name">
<a href="/blog/authors/stellargo/">
Sumit Sarin
</a>
</p>
<div class="paragraph">
<p>Jenkins Google Summer of Code 2020 student. Sumit is an engineering student (senior) at Netaji Subhas Institute of Technology, University of Delhi. He started his journey of contributing to Jenkins in December 2019. His tiny contribution revolved around the Jenkins Fingerprint engine. He is currently working on building <a href="/projects/gsoc/2020/projects/external-fingerprint-storage">External Fingerprint Storage for Jenkins</a>.</p>
</div>
<!-- starting partial social-media-buttons.html.haml -->
<ul class="app-social-media-buttons">
<li>
<a href="https://github.com/stellargo" rel="noreferrer noopener" target="_blank">
GitHub
</a>
</li>
<li>
<a href="https://medium.com/@sumitsarinofficial" rel="noreferrer noopener" target="_blank">
Blog
</a>
</li>
<li>
<a href="https://www.linkedin.com/in/sumit-sarin" rel="noreferrer noopener" target="_blank">
LinkedIn
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</div>
</div>

<!-- ending partial author.html.haml -->
<!-- starting partial discuss.html.haml -->

<!-- ending partial discuss.html.haml -->
</article>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//blog/2020/07/2020-07-24-external-fingerprint-storage-phase-2.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
