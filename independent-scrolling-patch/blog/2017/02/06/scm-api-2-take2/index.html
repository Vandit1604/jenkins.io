<!DOCTYPE html>
<html lang="en">
<head>
<title>
SCM API 2.0 Release Take 2
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2017/02/06/scm-api-2-take2/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="SCM API 2.0 Release Take 2" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="SCM API 2.0 Release Take 2" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="SCM API 2.0 Release Take 2" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2017/02/06/scm-api-2-take2/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="SCM API 2.0 Release Take 2" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.app-post-page h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<article class="container app-post-page">
<div class="app-!-display-flex">
<a class="app-back-link" href="/jenkins.io/independent-scrolling-patch/node/">
Back to blog
</a>
</div>
<h1>
SCM API 2.0 Release Take 2
</h1>
<div class="post-attrs">
<a class="app-author-link" href="/blog/authors/stephenc/"><div class="app-avatar"></div> Stephen Connolly</a>
February 06, 2017
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/intent/tweet?text=SCM+API+2.0+Release+Take+2&amp;url=https%3A%2F%2Fwww.jenkins.io%2Fjenkins.io%2Findependent-scrolling-patch%2Fblog%2F2017%2F02%2F06%2Fscm-api-2-take2%2F" rel="noreferrer nofollow" target="_blank">
Tweet
</a>
</div>
<div class="blog-content">
<div class="paragraph">
<p>In January we
<a href="/blog/2017/01/17/scm-api-2/">announced the release of SCM API 2.0</a>.
After the original release was published we identified four new high-impact
issues.  We decided to remove the new versions of the plugins from the update
center until those issues could be resolved. The issues have now been resolved
and the plugins are now available from the update center.</p>
</div>
<div class="sect1">
<h2 id="summary-for-busy-jenkins-administrators"><a class="anchor" href="#summary-for-busy-jenkins-administrators"></a>Summary for busy Jenkins Administrators</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Upgrading should make multi-branch projects much better.  When you are ready to
upgrade you must ensure that you upgrade all the required plugins.  If you miss
some, just upgrade them and restart to fix the issue. And of course, it&#8217;s
always a good idea to take a backup of your <code>JENKINS_HOME</code> before upgrading any
plugins.</p>
</div>
<div class="paragraph">
<p>In the list below, version numbers in <strong>bold</strong> indicate a change from the
original version in the
<a href="/blog/2017/01/17/scm-api-2/">original announcement</a></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Folders Plugin</dt>
<dd>
<p><strong>5.17</strong> or newer</p>
</dd>
<dt class="hdlist1">SCM API Plugin</dt>
<dd>
<p><strong>2.0.2</strong> or newer</p>
</dd>
<dt class="hdlist1">Branch API Plugin</dt>
<dd>
<p><strong>2.0.2</strong> or newer</p>
</dd>
<dt class="hdlist1">Git Plugin</dt>
<dd>
<p>This depends on the exact release line of the Git plugin that you are using.</p>
<div class="ulist">
<ul>
<li>
<p>Following the 2.6.x release line: <strong>2.6.4</strong> or newer</p>
</li>
<li>
<p>Following the 3.0.x release line (<em>recommended</em>): <strong>3.0.4</strong> or newer</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Mercurial Plugin</dt>
<dd>
<p>1.58 or newer</p>
</dd>
<dt class="hdlist1">GitHub Branch Source Plugin</dt>
<dd>
<p><strong>2.0.1</strong> or newer</p>
</dd>
<dt class="hdlist1">BitBucket Branch Source Plugin</dt>
<dd>
<p><strong>2.0.2</strong> or newer</p>
</dd>
<dt class="hdlist1">GitHub Organization Folders Plugin</dt>
<dd>
<p>1.6</p>
</dd>
<dt class="hdlist1">Pipeline Multibranch Plugin</dt>
<dd>
<p><strong>2.12</strong> or newer</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If you are using the <a href="https://plugins.jenkins.io/blueocean">Blue Ocean plugin</a></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Blue Ocean Plugin</dt>
<dd>
<p><strong>1.0.0-b22</strong> or newer</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Other plugins that may require updating:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">GitHub API Plugin</dt>
<dd>
<p>1.84 or newer</p>
</dd>
<dt class="hdlist1">GitHub Plugin</dt>
<dd>
<p>1.25.0 or newer</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you upgrade to Branch API 2.0.x and you have either the GitHub Branch Source or the BitBucket Branch Source plugins <strong>and</strong> you do not upgrade those instances to the 2.0.x line then your Jenkins instance will fail to start-up correctly.</p>
</div>
<div class="paragraph">
<p>The solution is just to upgrade the GitHub Branch Source or the BitBucket Branch Source plugin (as appropriate) to the 2.0.x line.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After an upgrade you will see the data migration warning (see the screenshot in
<a href="https://issues.jenkins.io/browse/JENKINS-41608">JENKINS-41608</a> for an
example) this is normal and expected.  The unreadable data will be removed by
the next scan / index or can be removed manually using the <em>Discard Unreadable
Data</em> button.  The warning will disappear on the next restart after the
unreadable data has been removed.</p>
</div>
<div class="paragraph">
<p>Please update to the versions listed above. If you want to know more about the
issues and how they were resolved, see the next section.</p>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="analysis-of-the-issues"><a class="anchor" href="#analysis-of-the-issues"></a>Analysis of the issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The issues described below are resolved with these plugin releases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Folders Plugin: <strong>5.17</strong></p>
</li>
<li>
<p>SCM API Plugin: <strong>2.0.2</strong></p>
</li>
<li>
<p>Branch API Plugin: <strong>2.0.2</strong></p>
</li>
<li>
<p>Git Plugin: <strong>Either</strong> <strong>2.6.4</strong> <strong>or</strong> <strong>3.0.4</strong></p>
</li>
<li>
<p>GitHub Branch Source Plugin: <strong>2.0.1</strong></p>
</li>
<li>
<p>BitBucket Branch Source Plugin: <strong>2.0.2</strong></p>
</li>
<li>
<p>Pipeline Multibranch Plugin: <strong>2.12</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://issues.jenkins.io/browse/JENKINS-41121">JENKINS-41121: GitHub Branch Source upgrade can cause a lot of rebuilds</a>:</p>
</div>
<div class="paragraph">
<p>Migration of GitHub branches from 1.x to 2.x resulted in a change of the
implementation class used to identify branches.  Some other other bugs in
Branch API had been fixed and the combined effect resulted in a rebuild of all
GitHub Branches (not PRs) after an upgrade to GitHub Branch Source Plugin
2.0.0.  This rebuild was referred to as a "build storm".</p>
</div>
<div class="paragraph">
<p><strong>Resolution:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The SCM API plugin was enhanced to add an extension point that allows for a second round of data migration when upgrading.</p>
</li>
<li>
<p>The second round of data migration allows plugins implementing the SCM API contract to fix implementation class issues in context.</p>
</li>
<li>
<p>The Branch API plugin was enhanced to use this new extension point.</p>
</li>
<li>
<p>The GitHub Branch Source plugin was enhanced to provide an implementation of this extension point.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://issues.jenkins.io/browse/JENKINS-41255">JENKINS-41255: Upgrading from a navigator that did not assign consistent source ids to a version that does assign consistent source ids causes a build storm on first scan</a>:</p>
</div>
<div class="paragraph">
<p>The GitHub Branch Source and BitBucket Branch Source plugins in 1.x were not
assigning consistent IDs to multi-branch projects discovered in an Organization
Folder.  Both plugins were fixed in 2.0.0 to assign consistent IDs as a change
of ID would result in a rebuild of all projects.  What was missed is that the
very first scan of an Organization Folder after an upgrade will change the
randomly assigned ID assigned by the 1.x plugins into the consistent ID
assigned by the 2.0.0 plugins and consequently trigger a rebuild of all
branches. This rebuild was referred to as a "build storm".</p>
</div>
<div class="paragraph">
<p><strong>Resolution:</strong></p>
</div>
<div class="paragraph">
<p>The Branch API plugin was enhanced to detect the case where a branch source has
been changed but the change is only changing the ID.  When such changes are
identified, the downstream references of the ID are all updated which will
prevent a build storm.</p>
</div>
<div class="paragraph">
<p><a href="https://issues.jenkins.io/browse/JENKINS-41313">JENKINS-41313: On first index after upgrade to 2.0.0 all open PRs are rebuilt</a>:</p>
</div>
<div class="paragraph">
<p>The BitBucket Branch Source 1.x did not store all the information about PRs
that is required by the SCM API 2.0.x model.  This could well have resulted in
subtle effects when manually triggering a rebuild of a merge PR if the PR&#8217;s
target branch has been modified after the PR branch was first detected by
Jenkins. Consequently, as the information is required, BitBucket Branch Source
plugin 2.0.0 populated the information with dummy values which would force the
correct information to be retrieved.  The side-effect is that all PR branches
would be rebuilt.</p>
</div>
<div class="paragraph">
<p><strong>Resolution:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The changes in SCM API 2.0.2 introduced to resolve JENKINS-41121 provided a path to resolve this issue without causing a rebuild of all PR branches.</p>
</li>
<li>
<p>The BitBucket Branch Source plugin was enhanced to provide an implementation of the new SCM API extension point that connects to BitBucket and retrieves the missing information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="https://issues.jenkins.io/browse/JENKINS-41124">JENKINS-41124: Can&#8217;t get a human readable job name anymore</a>:</p>
</div>
<div class="paragraph">
<p>During initial testing of the Branch API 2.0.0 release an issue was identified
with how Organization Folders handled unusual names.  None of the existing
implementations of the <code>SCMNavigator</code> API could generate such unusual names due
to form validation on GitHub / BitBucket replacing unusual characters with <code>-</code>
when creating a repository.</p>
</div>
<div class="paragraph">
<p>It would be irresponsible to rely on external services sanitizing their input
data for the correct operation of Organization Folders.  Consequently, in
Branch API 2.0.0 the names were all transformed into URL safe names, with the
original URLs still resolving to the original projects so that any existing
saved links would remain functional.</p>
</div>
<div class="paragraph">
<p>Quite a number of people objected to this change of URL scheme.</p>
</div>
<div class="paragraph">
<p><strong>Resolution:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>There has been a convention in Jenkins that the on-disk storage structure for
jobs mirrors the URL structure. This is only a convention and there is nothing specific in the code that
mandates following the convention.</p>
</li>
<li>
<p>The Folders Plugin was enhanced to allow for computed folders (where the item
names are provided by an external source) to provide a strategy to use when
generating the on-disk storage names as well as the URL component names for
the folder&#8217;s child items.</p>
</li>
<li>
<p>The Branch API plugin was enhanced to use this new strategy for name transformation.</p>
</li>
<li>
<p>The net effect of this change is that the URLs remain the same as for 1.x but
the on-disk storage uses transformed names that are future proofed against
any new SCMNavigator implementations where the backing service allows names
that are problematic to use as filesystem directory names.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Side-effect:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Branch API 2.0.0 approach handled the transformation of names by renaming the items using the Jenkins Item rename API.</p>
</li>
<li>
<p>The Branch API 2.0.2 approach does not rename the child items as it is only the on-disk storage location that is moved.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This means that the Jenkins Item rename API cannot be used.</p>
</div>
<div class="paragraph">
<p>At this time, the only known side-effect is in the  <a href="https://plugins.jenkins.io/jobConfigHistory">Job Configuration History</a> plugin.
The configuration history of each child item will still be tracked going
forward after the upgrade.  The pre-upgrade configuration history is also
retained.  Because the Jenkins Item rename API cannot be used to flag the
configuration file location change, there is no association between the
pre-upgrade history chain and the post-upgrade history chain.</p>
</div>
</div>
</div>
</div>
<ul class="app-tags">
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/development/">
development
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/plugins/">
plugins
</a>
</li>
</ul>
<h2>
About the author
</h2>
<!-- starting partial author.html.haml -->
<div class="app-author" id="about-the-author">
<!-- starting partial avatar.html.haml -->
<div class="app-avatar" style="min-width: 64px; width: 25vw; max-width: 128px"></div>

<!-- ending partial avatar.html.haml -->
<div class="app-author__content">
<p class="app-author__name">
<a href="/blog/authors/stephenc/">
Stephen Connolly
</a>
</p>
This author has no biography defined.
See social media links referenced below.
<!-- starting partial social-media-buttons.html.haml -->
<ul class="app-social-media-buttons">
<li>
<a href="https://github.com/stephenc" rel="noreferrer noopener" target="_blank">
GitHub
</a>
</li>
<li>
<a href="https://twitter.com/connolly_s" rel="noreferrer noopener" target="_blank">
Twitter
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</div>
</div>

<!-- ending partial author.html.haml -->
<!-- starting partial discuss.html.haml -->

<!-- ending partial discuss.html.haml -->
</article>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//blog/2017/02/2017-02-06-scm-api-2-take2.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
