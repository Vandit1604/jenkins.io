<!DOCTYPE html>
<html lang="en">
<head>
<title>
GSoC Project Intro: External Workspace Manager Plugin
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2016/05/23/external-workspace-manager-plugin/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="GSoC Project Intro: External Workspace Manager Plugin" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="GSoC Project Intro: External Workspace Manager Plugin" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="GSoC Project Intro: External Workspace Manager Plugin" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2016/05/23/external-workspace-manager-plugin/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="GSoC Project Intro: External Workspace Manager Plugin" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.app-post-page h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<article class="container app-post-page">
<div class="app-!-display-flex">
<a class="app-back-link" href="/jenkins.io/independent-scrolling-patch/node/">
Back to blog
</a>
</div>
<h1>
GSoC Project Intro: External Workspace Manager Plugin
</h1>
<div class="post-attrs">
<a class="app-author-link" href="/blog/authors/alexsomai/"><div class="app-avatar"></div> Alexandru Somai</a>
May 23, 2016
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/intent/tweet?text=GSoC+Project+Intro%3A+External+Workspace+Manager+Plugin&amp;url=https%3A%2F%2Fwww.jenkins.io%2Fjenkins.io%2Findependent-scrolling-patch%2Fblog%2F2016%2F05%2F23%2Fexternal-workspace-manager-plugin%2F" rel="noreferrer nofollow" target="_blank">
Tweet
</a>
</div>
<div class="blog-content">
<div class="sect2">
<h3 id="about-myself"><a class="anchor" href="#about-myself"></a>About myself</h3>
<div class="paragraph">
<p>My name is Alexandru Somai.
I&#8217;m following a major in Software Engineering at the Babes-Bolyai University of Cluj-Napoca, Romania.
I have more than two years hands-on experience working in Software Development.</p>
</div>
<div class="paragraph">
<p>I enjoy writing code in Java, Groovy and JavaScript.
The technologies and frameworks that I&#8217;m most familiar with are: Spring Framework, Spring Security, Hibernate,
JMS, Web Services, JUnit, TestNG, Mockito.
As build tools and continuous integration, I&#8217;m using Maven and Jenkins.
I&#8217;m a passionate software developer who is always learning, always looking for new challenges.
I want to start contributing to the open source community and Google Summer of Code is a starting point for me.</p>
</div>
</div>
<div class="sect2">
<h3 id="project-summary"><a class="anchor" href="#project-summary"></a>Project summary</h3>
<div class="paragraph">
<p>Currently, Jenkins’ build workspace may become very large in size due to the fact that some compilers generate
very large volumes of data.
The existing plugins that share the workspace across builds are able to do this by copying the files from
one workspace to another, process which is inefficient.
A solution is to have a Jenkins plugin that is able to manage and reuse the same workspace between multiple builds.</p>
</div>
<div class="paragraph">
<p>As part of the <a href="https://summerofcode.withgoogle.com/">Google Summer of Code</a> 2016 I will be working on
the <em>External Workspace Manager</em> plugin.
My mentors for this project are <a href="https://github.com/oleg-nenashev">Oleg Nenashev</a>
and <a href="https://github.com/martinda">Martin d&#8217;Anjou</a>.
This plugin aims to provide an external workspace management system.
It should facilitate workspace share and reuse across multiple Jenkins jobs.
It should eliminate the need to copy, archive or move files.
The plugin will be written for <a href="https://wiki.jenkins.io/display/JENKINS/Pipeline+Plugin">Pipeline</a> jobs.</p>
</div>
</div>
<div class="sect2">
<h3 id="usage"><a class="anchor" href="#usage"></a>Usage</h3>
<div class="sect3">
<h4 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Multiple physical disks accessible from controller.</p>
</li>
<li>
<p>The same physical disks must be accessible from Jenkins Nodes (renamed to Agents in Jenkins 2.0).</p>
</li>
<li>
<p>In the Jenkins global configuration, define a disk pool (or many) that will contain the physical disks.</p>
</li>
<li>
<p>In each Node configuration, define the mounting point from the current node to each physical disk.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following diagram gives you an overview of how an <em>External Workspace Manager</em> configuration may look like:</p>
</div>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/ewm/ewm-config.png" alt="ewm config" title="Simplified EWM config"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="example-one"><a class="anchor" href="#example-one"></a>Example one</h4>
<div class="paragraph">
<p>Let&#8217;s assume that we have one Jenkins job. In this job, we want to use the same workspace on multiple Jenkins nodes.
Our pipeline code may look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="n">stage</span> <span class="o">(</span><span class="s1">'Stage 1. Allocate workspace'</span><span class="o">)</span>
<span class="kt">def</span> <span class="n">extWorkspace</span> <span class="o">=</span> <span class="n">exwsAllocate</span> <span class="nl">id:</span> <span class="s1">'diskpool1'</span>

<span class="n">node</span> <span class="o">(</span><span class="s1">'linux'</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">exws</span> <span class="o">(</span><span class="n">extWorkspace</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Stage 2. Build on the build server'</span><span class="o">)</span>
        <span class="n">git</span> <span class="nl">url:</span> <span class="s1">'...'</span>
        <span class="n">sh</span> <span class="s1">'mvn clean install'</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">node</span> <span class="o">(</span><span class="s1">'test'</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">exws</span> <span class="o">(</span><span class="n">extWorkspace</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Stage 3. Run tests on a test machine'</span><span class="o">)</span>
        <span class="n">sh</span> <span class="s1">'mvn test'</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: The <code>stage()</code> steps are optional from the <em>External Workspace Manager</em> plugin perspective.</p>
</div>
<div class="sect4">
<h5 id="stage-1-allocate-workspace"><a class="anchor" href="#stage-1-allocate-workspace"></a>Stage 1. Allocate workspace</h5>
<div class="paragraph">
<p>The <code>exwsAllocate</code> step selects a disk from <em>diskpool1</em>
(default behavior: the disk with the most available size).
On that disk, let&#8217;s say <em>disk1</em>, it allocates a directory.
The computed directory path is: <code>/physicalPathOnDisk/$JOB_NAME/$BUILD_NUMBER</code>.</p>
</div>
<div class="paragraph">
<p>For example, Let&#8217;s assume that the <code>$JOB_NAME</code> is <em>integration</em> and the <code>$BUILD_NUMBER</code> is <em>14</em>.
Then, the resulting path is: <code>/jenkins-project/disk1/integration/14</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="stage-2-build-on-the-build-server"><a class="anchor" href="#stage-2-build-on-the-build-server"></a>Stage 2. Build on the build server</h5>
<div class="paragraph">
<p>All the nodes labeled <em>linux</em> must have access to the disks defined in the disk pool.
In the Jenkins Node configurations we have defined the local paths that are the mounting points to each disk.</p>
</div>
<div class="paragraph">
<p>The <code>exws</code> step concatenates the node&#8217;s local path with the path returned by the <code>exwsAllocate</code> step.
In our case, the node labeled <em>linux</em> has its local path to <em>disk1</em> defined as: <code>/linux-node/disk1/</code>.
So, the complete workspace path is: <code>/linux-node/disk1/jenkins-project/disk1/integration/14</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="stage-3-run-tests-on-a-test-machine"><a class="anchor" href="#stage-3-run-tests-on-a-test-machine"></a>Stage 3. Run tests on a test machine</h5>
<div class="paragraph">
<p>Further, we want to run our tests on a different node, but we want to reuse the previously created workspace.</p>
</div>
<div class="paragraph">
<p>In the node labeled <em>test</em> we have defined the local path to <em>disk1</em> as: <code>/test-node/disk1/</code>.
By applying the <code>exws</code> step, our tests will be able to run in the same workspace as the build.
Therefore, the path is: <code>/test-node/disk1/jenkins-project/disk1/integration/14</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="example-two"><a class="anchor" href="#example-two"></a>Example two</h4>
<div class="paragraph">
<p>Let&#8217;s assume that we have two Jenkins jobs, one called <em>upstream</em> and the other one called <em>downstream</em>.
In the <em>upstream</em> job, we clone the repository and build the project, and in the <em>downstream</em> job we run the tests.
In the <em>downstream</em> job we don&#8217;t want to clone and re-build the project, we need to use the same
workspace created in the <em>upstream</em> job.
We have to be able to do so without copying the workspace content from one location to another.</p>
</div>
<div class="paragraph">
<p>The pipeline code in the <em>upstream</em> job is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="n">stage</span> <span class="o">(</span><span class="s1">'Stage 1. Allocate workspace in the upstream job'</span><span class="o">)</span>
<span class="kt">def</span> <span class="n">extWorkspace</span> <span class="o">=</span> <span class="n">exwsAllocate</span> <span class="nl">id:</span> <span class="s1">'diskpool1'</span>

<span class="n">node</span> <span class="o">(</span><span class="s1">'linux'</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">exws</span> <span class="o">(</span><span class="n">extWorkspace</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Stage 2. Build in the upstream job'</span><span class="o">)</span>
           <span class="n">git</span> <span class="nl">url:</span> <span class="s1">'...'</span>
           <span class="n">sh</span> <span class="s1">'mvn clean install'</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And the <em>downstream</em>'s pipeline code is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="n">stage</span> <span class="o">(</span><span class="s1">'Stage 3. Allocate workspace in the downstream job'</span><span class="o">)</span>
<span class="kt">def</span> <span class="n">extWorkspace</span> <span class="o">=</span> <span class="n">exwsAllocate</span> <span class="nl">id:</span> <span class="s1">'diskpool1'</span><span class="o">,</span> <span class="nl">upstream:</span> <span class="s1">'upstream'</span>

<span class="n">node</span> <span class="o">(</span><span class="s1">'test'</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">exws</span> <span class="o">(</span><span class="n">extWorkspace</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">stage</span><span class="o">(</span><span class="s1">'Stage 4. Run tests in the downstream job'</span><span class="o">)</span>
        <span class="n">sh</span> <span class="s1">'mvn test'</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="stage-1-allocate-workspace-in-the-upstream-job"><a class="anchor" href="#stage-1-allocate-workspace-in-the-upstream-job"></a>Stage 1. Allocate workspace in the upstream job</h5>
<div class="paragraph">
<p>The functionality is the same as in example one - stage 1.
In our case, the allocated directory on the physical disk is: <code>/jenkins-project/disk1/upstream/14</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="stage-2-build-in-the-upstream-job"><a class="anchor" href="#stage-2-build-in-the-upstream-job"></a>Stage 2. Build in the upstream job</h5>
<div class="paragraph">
<p>Same functionality as example one - stage 2.
The final workspace path is: <code>/linux-node/disk1/jenkins-project/disk1/upstream/14</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="stage-3-allocate-workspace-in-the-downstream-job"><a class="anchor" href="#stage-3-allocate-workspace-in-the-downstream-job"></a>Stage 3. Allocate workspace in the downstream job</h5>
<div class="paragraph">
<p>By passing the <em>upstream</em> parameter to the <code>exwsAllocate</code> step,
it selects the most recent stable upstream workspace (default behavior).
The workspace path pattern is like this: <code>/physicalPathOnDisk/$UPSTREAM_NAME/$MOST_RECENT_STABLE_BUILD</code>.
Let&#8217;s assume that the last stable build number is <em>12</em>, then the resulting path is:
<code>/jenkins-project/disk1/upstream/12</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="stage-4-run-tests-in-the-downstream-job"><a class="anchor" href="#stage-4-run-tests-in-the-downstream-job"></a>Stage 4. Run tests in the downstream job</h5>
<div class="paragraph">
<p>The <code>exws</code> step concatenates the node&#8217;s local path with the path returned by the <code>exwsAllocate</code> step in stage 3.
In this scenario, the complete path for running tests is: <code>/test-node/disk1/jenkins-project/disk1/upstream/12</code>.
It will reuse the workspace defined in the upstream job.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="additional-details"><a class="anchor" href="#additional-details"></a>Additional details</h3>
<div class="paragraph">
<p>You may find the complete project proposal, along with the design details, features, more examples and use cases,
implementation ideas and milestones in the <a href="https://goo.gl/fq3RAe">design document</a>.
The plugin repository will be available on <a href="https://github.com/jenkinsci/external-workspace-manager-plugin">GitHub</a>.</p>
</div>
<div class="paragraph">
<p>A prototype version of the plugin should be available in late June and the releasable version in late August.
I will be holding plugin functionality demos within the community.</p>
</div>
<div class="paragraph">
<p>I do appreciate any feedback.
You may add comments in the <a href="https://goo.gl/fq3RAe">design document</a>.
I will be posting updates from time to time about the plugin status on the
<a href="https://groups.google.com/forum/#!forum/jenkinsci-dev">Jenkins developers</a> mailing list.</p>
</div>
</div>
<div class="sect2">
<h3 id="links"><a class="anchor" href="#links"></a>Links</h3>
<div class="paragraph">
<p><a href="https://gitter.im/jenkinsci/external-workspace-manager-plugin?utm_source=share-link&amp;utm_medium=link&amp;utm_campaign=share-link"><span class="image"><img src="https://badges.gitter.im/jenkinsci/external-workspace-manager-plugin.svg" alt="title: &quot;Gitter&quot;"></span></a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://goo.gl/fq3RAe">Design document</a></p>
</li>
<li>
<p><a href="https://summerofcode.withgoogle.com/">GSoC program</a></p>
</li>
<li>
<p><a href="https://wiki.jenkins.io/display/JENKINS/Google+Summer+Of+Code+2016">Jenkins GSoC Page</a></p>
</li>
<li>
<p><a href="https://github.com/jenkinsci/external-workspace-manager-plugin">Project repository</a></p>
</li>
</ul>
</div>
</div>
</div>
<ul class="app-tags">
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/pipeline/">
pipeline
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/plugins/">
plugins
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/gsoc/">
gsoc
</a>
</li>
</ul>
<h2>
About the author
</h2>
<!-- starting partial author.html.haml -->
<div class="app-author" id="about-the-author">
<!-- starting partial avatar.html.haml -->
<div class="app-avatar" style="min-width: 64px; width: 25vw; max-width: 128px"></div>

<!-- ending partial avatar.html.haml -->
<div class="app-author__content">
<p class="app-author__name">
<a href="/blog/authors/alexsomai/">
Alexandru Somai
</a>
</p>
This author has no biography defined.
See social media links referenced below.
<!-- starting partial social-media-buttons.html.haml -->
<ul class="app-social-media-buttons">
<li>
<a href="https://github.com/alexsomai" rel="noreferrer noopener" target="_blank">
GitHub
</a>
</li>
<li>
<a href="https://twitter.com/alex_somai" rel="noreferrer noopener" target="_blank">
Twitter
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</div>
</div>

<!-- ending partial author.html.haml -->
<!-- starting partial discuss.html.haml -->

<!-- ending partial discuss.html.haml -->
</article>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//blog/2016/2016-05-23-external-workspace-manager-plugin.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
