<!DOCTYPE html>
<html lang="en">
<head>
<title>
Security Validator for Jenkins Operator for Kubernetes
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Security validator adds an extra step of validation to detect potential security vulnerabilities in the plugins before creating a Jenkins custom resource.
" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2021/08/23/jenkins-operator-security-work-report/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="Security Validator for Jenkins Operator for Kubernetes" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Security Validator for Jenkins Operator for Kubernetes" name="twitter:title">
<meta content="Security validator adds an extra step of validation to detect potential security vulnerabilities in the plugins before creating a Jenkins custom resource.
" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logos/kubernetes-operator/kubernetes-operator.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Security Validator for Jenkins Operator for Kubernetes" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2021/08/23/jenkins-operator-security-work-report/" property="og:url">
<meta content="Security validator adds an extra step of validation to detect potential security vulnerabilities in the plugins before creating a Jenkins custom resource.
" name="og:description">
<meta content="Security Validator for Jenkins Operator for Kubernetes" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logos/kubernetes-operator/kubernetes-operator.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.app-post-page h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<article class="container app-post-page">
<div class="app-!-display-flex">
<a class="app-back-link" href="/jenkins.io/independent-scrolling-patch/node/">
Back to blog
</a>
</div>
<h1>
Security Validator for Jenkins Operator for Kubernetes
</h1>
<div class="post-attrs">
<a class="app-author-link" href="/blog/authors/sharmapulkit04/"><div class="app-avatar"><img alt="Pulkit Sharma" class="app-avatar__image" src="/images/avatars/sharmapulkit04.jpg"></div> Pulkit Sharma</a>
August 23, 2021
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/intent/tweet?text=Security+Validator+for+Jenkins+Operator+for+Kubernetes&amp;url=https%3A%2F%2Fwww.jenkins.io%2Fjenkins.io%2Findependent-scrolling-patch%2Fblog%2F2021%2F08%2F23%2Fjenkins-operator-security-work-report%2F" rel="noreferrer nofollow" target="_blank">
Tweet
</a>
</div>
<div class="blog-content">
<div class="sect1">
<h2 id="background"><a class="anchor" href="#background"></a>Background</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jenkins custom resources on a Kubernetes cluster are deployed using declarative YAML configuration files; hence some of the plugins declared in these files may contain security warnings.
So there is no way for the user to know other than manually checking for each on the site.
This project aims to add an extra step of validation before creating/updating a new Jenkins Custom Resource.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deliverables"><a class="anchor" href="#deliverables"></a>Deliverables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This project aims to add a validating admission webhook to the Jenkins Operator for Kubernetes to detect potential security vulnerabilities in the plugins before the object is created.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dependencies"><a class="anchor" href="#dependencies"></a>Dependencies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Webhooks communicate to the API server over HTTPS and use TLS. Thus, <a href="https://cert-manager.io/docs/">Jetstack/cert-manager</a> is used to provision TLS certificates and establish connection between Kubernetes API and webhook.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementation"><a class="anchor" href="#implementation"></a>Implementation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Operator-SDK takes care of creating a new webhook and appending it to the manager and creating handlers.
Tls certificates are managed using cert-manager.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Validation Logic:</p>
<div class="ulist">
<ul>
<li>
<p>Proposed Implementations: Iterate through the list of plugins to be installed and fetch warnings for each plugin from the plugin center API and check if the version of that plugin has any of those warnings.</p>
</li>
<li>
<p>Caveats: Webhooks add latency to an API request, hence they should evaluate as quickly as possible thus having max allowed timeout of 30s. In the earlier approach I was fetching the security warnings from the plugin site API in the validator interface itself, and since network operations are slow, it was causing a timeout in the case of validating a larger number of plugins or when the Internet connection was not good.</p>
</li>
<li>
<p>Updated Implementation: Instead of fetching information for each plugin, the information about all the plugins is downloaded and cached at the start of the operator and updated periodically, thus eliminating network calls and finishing validation in less than a second.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="evaluation-phase-1"><a class="anchor" href="#evaluation-phase-1"></a>Evaluation Phase 1:</h3>
<div class="ulist">
<ul>
<li>
<p>Scaffoled a new validation webhook</p>
</li>
<li>
<p>Added manifests for ValidatingWebhookConfiguration, certificates and volumes, and updated Makefile</p>
</li>
<li>
<p>Implemented the validator interface</p>
</li>
<li>
<p>Updated helm charts</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="evaluation-phase-2"><a class="anchor" href="#evaluation-phase-2"></a>Evaluation Phase 2:</h3>
<div class="ulist">
<ul>
<li>
<p>Reimplemented the validator interface.</p>
</li>
<li>
<p>Added unit tests for internal functions</p>
</li>
<li>
<p>Added e2e tests along with helm tests</p>
</li>
<li>
<p>Updated helm charts</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resources"><a class="anchor" href="#resources"></a>Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>Pull Requests</p>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/jenkinsci/kubernetes-operator/pull/585">Added validation webhook,manifests,and updated Makefile</a></p>
</li>
<li>
<p><a href="https://github.com/jenkinsci/kubernetes-operator/pull/593">Implemented validation logic,added tests and updated helm charts</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="https://www.youtube.com/watch?v=xO2jGmv1fLo">Phase 1 demo</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="user-guide"><a class="anchor" href="#user-guide"></a>User Guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The webhook feature is completely optional for the user. It can be easily deployed using Helm Chart by setting webhook.enabled in values.yaml and in the Operator command line flag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"> webhook.enabled=true</pre>
</div>
</div>
<div class="paragraph">
<p>To enable security validation in the jenkins custom resource set</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">jenkins.ValidateSecurityWarnings=true</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Note: The webhook takes some time to get up and running, also when helm renders the template, the validating webhook configuration is applied last, hence if the user wants to deploy the Jenkins Custom Resource with validation turned on, he needs to wait for some time. After the webhook is up and running the user can deploy the Jenkins Custom Resource using <strong>helm</strong> or <strong>kubectl</strong></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="future-work"><a class="anchor" href="#future-work"></a>Future work</h3>
<div class="ulist">
<ul>
<li>
<p>Implementing a post-install hook in the helm charts that checks whether the webhook is up and running.</p>
</li>
<li>
<p>Adding validation for required core version of plugin and core version of Jenkins.</p>
</li>
<li>
<p>Migrating other validation logic from controller to the webhook.</p>
</li>
<li>
<p>Adding validation for the dependencies of the plugins.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<ul class="app-tags">
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/gsoc21/">
gsoc21
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/kubernetes/">
kubernetes
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/security/">
security
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/plugins/">
plugins
</a>
</li>
</ul>
<h2>
About the author
</h2>
<!-- starting partial author.html.haml -->
<div class="app-author" id="about-the-author">
<!-- starting partial avatar.html.haml -->
<div class="app-avatar" style="min-width: 64px; width: 25vw; max-width: 128px">
<img alt="Pulkit Sharma" class="app-avatar__image" src="/jenkins.io/independent-scrolling-patch/images/avatars/sharmapulkit04.jpg">
</div>

<!-- ending partial avatar.html.haml -->
<div class="app-author__content">
<p class="app-author__name">
<a href="/blog/authors/sharmapulkit04/">
Pulkit Sharma
</a>
</p>
<div class="paragraph">
<p>A Student at the Indian Institute of Technology(BHU) Varanasi, Pulkit is currently working on a GSoC Project under Jenkins where he aims to add a security validator to the Jenkins Kubernetes Operator.</p>
</div>
<!-- starting partial social-media-buttons.html.haml -->
<ul class="app-social-media-buttons">
<li>
<a href="https://github.com/sharmapulkit04" rel="noreferrer noopener" target="_blank">
GitHub
</a>
</li>
<li>
<a href="https://twitter.com/anarchist_04" rel="noreferrer noopener" target="_blank">
Twitter
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</div>
</div>

<!-- ending partial author.html.haml -->
<!-- starting partial discuss.html.haml -->

<!-- ending partial discuss.html.haml -->
</article>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//blog/2021/08/2021-08-23-jenkins-operator-security-work-report.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
