<!DOCTYPE html>
<html lang="en">
<head>
<title>
Pipeline Best Practices
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/doc/book/pipeline/pipeline-best-practices/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="Pipeline Best Practices" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Pipeline Best Practices" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Pipeline Best Practices" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/doc/book/pipeline/pipeline-best-practices/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="Pipeline Best Practices" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.container .row .col-lg-9 h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<div class="container">
<div class="row body flex-lg-nowrap">
<div class="col-lg-3" id="sidebar-menu">
<div class="sidebar-nav tour" id="sidebar-content">
<p>
<a href="/jenkins.io/independent-scrolling-patch/doc/" class="">> User Documentation Home</a>
</p>
<h5>
User Handbook
</h5>
<ul>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/getting-started/" class="">User Handbook Overview</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/installing/" class="">Installing Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/using/" class="">Using Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/" class="active">Pipeline</a>
<small>
<ul style="padding-left: 1rem;">
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/getting-started/" class="">Getting started with Pipeline</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/jenkinsfile/" class="">Using a Jenkinsfile</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/running-pipelines/" class="">Running Pipelines</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/multibranch/" class="">Branches and Pull Requests</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/docker/" class="">Using Docker with Pipeline</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/shared-libraries/" class="">Extending with Shared Libraries</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/development/" class="">Pipeline Development Tools</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/syntax/" class="">Pipeline Syntax</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/pipeline-best-practices/" class="active">Pipeline Best Practices</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/scaling-pipeline/" class="">Scaling Pipelines</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/cps-method-mismatches/" class="">Pipeline CPS Method Mismatches</a>
</li>
</ul>
</small>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/blueocean/" class="">Blue Ocean</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/" class="">Managing Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/security/" class="">Securing Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/system-administration/" class="">System Administration</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/scaling/" class="">Scaling Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/troubleshooting/" class="">Troubleshooting Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/glossary/" class="">Glossary</a>
</li>
</ul>
<h5>
Tutorials
</h5>
<ul>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/pipeline/tour/getting-started/" class="">Guided Tour</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/tutorials#pipeline" class="">Jenkins Pipeline</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/tutorials#tools" class="">Using Build Tools</a>
</li>
</ul>
<h5>
Resources
</h5>
<ul>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/syntax/" class="">Pipeline Syntax reference</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/pipeline/steps/" class="">Pipeline Steps reference</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/upgrade-guide/" class="">LTS Upgrade guides</a>
</li>
</ul>
</div>
</div>
<div class="col-lg-9">
<div>
<div class="row">
<div class="col-md-4">
<a class="prev doc-page-link" href="../syntax">
⇐ Pipeline Syntax
</a>
</div>
<div class="col-md-4">
<a class="up doc-page-link" href="../">
⇑ Pipeline
</a>
<a class="index doc-page-link" href="../../">
Index
</a>
</div>
<div class="col-md-4">
<a class="next doc-page-link" href="../scaling-pipeline">
Scaling Pipelines ⇒
</a>
</div>
</div>
</div>
<div>
<div class="row body">
<div class="section">
<h1>
Pipeline Best Practices
</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#general">General</a>
<ul class="sectlevel2">
<li><a href="#making-sure-to-use-groovy-code-in-pipelines-as-glue">Making sure to use Groovy code in Pipelines as glue</a></li>
<li><a href="#running-shell-scripts-in-jenkins-pipeline">Running shell scripts in Jenkins Pipeline</a></li>
<li><a href="#avoiding-complex-groovy-code-in-pipelines">Avoiding complex Groovy code in Pipelines</a></li>
<li><a href="#reducing-repetition-of-similar-pipeline-steps">Reducing repetition of similar Pipeline steps</a></li>
<li><a href="#avoiding-calls-to-jenkins-getinstance">Avoiding calls to <code>Jenkins.getInstance</code></a></li>
<li><a href="#cleaning-up-old-jenkins-builds">Cleaning up old Jenkins builds</a></li>
</ul>
</li>
<li><a href="#using-shared-libraries">Using shared libraries</a>
<ul class="sectlevel2">
<li><a href="#do-not-override-built-in-pipeline-steps">Do not override built-in Pipeline steps</a></li>
<li><a href="#avoiding-large-global-variable-declaration-files">Avoiding large global variable declaration files</a></li>
<li><a href="#avoiding-very-large-shared-libraries">Avoiding very large shared libraries</a></li>
</ul>
</li>
<li><a href="#answering-additional-faqs">Answering additional FAQs</a>
<ul class="sectlevel2">
<li><a href="#dealing-with-concurrency-in-pipelines">Dealing with Concurrency in Pipelines</a></li>
<li><a href="#avoiding-notserializableexception">Avoiding <code>NotSerializableException</code></a></li>
</ul>
</li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide provides a small selection of best practices for pipelines and points out the most common mistakes.</p>
</div>
<div class="paragraph">
<p>The goal is to point pipeline authors and maintainers towards patterns that result in better Pipeline execution and away from pitfalls they might otherwise not be aware of.
This guide is not meant to be an exhaustive list of all possible Pipeline best practices but instead to provide a number of specific examples useful in tracking down common practices.
Use it as a "do this" generally and not as an incredibly detailed "how-to".</p>
</div>
<div class="paragraph">
<p>This guide is arranged by area, guideline, then listing specific examples.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="general"><a class="anchor" href="#general"></a>General</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="making-sure-to-use-groovy-code-in-pipelines-as-glue"><a class="anchor" href="#making-sure-to-use-groovy-code-in-pipelines-as-glue"></a>Making sure to use Groovy code in Pipelines as glue</h3>
<div class="paragraph">
<p>Use Groovy code to connect a set of actions rather than as the main functionality of your Pipeline.
In other words, instead of relying on Pipeline functionality (Groovy or Pipeline steps) to drive the build process forward, use single steps (such as <code>sh</code>) to accomplish multiple parts of the build.
Pipelines, as their complexity increases (the amount of Groovy code, number of steps used, etc.), require more resources (CPU, memory, storage) on the controller.
Think of Pipeline as a tool to accomplish a build rather than the core of a build.</p>
</div>
<div class="paragraph">
<p>Example: Using a single Maven build step to drive the build through its build/test/deploy process.</p>
</div>
</div>
<div class="sect2">
<h3 id="running-shell-scripts-in-jenkins-pipeline"><a class="anchor" href="#running-shell-scripts-in-jenkins-pipeline"></a>Running shell scripts in Jenkins Pipeline</h3>
<div class="paragraph">
<p>Using a shell script within Jenkins Pipeline can help simplify builds by combining multiple steps into a single stage.
The shell script also allows users to add or update commands without having to modify each step or stage separately.</p>
</div>
<div class="paragraph">
<p>This video reviews using a shell script in Jenkins Pipeline and the benefits it provides.</p>
</div>
<div class="videoblock">
<div class="content">
<iframe width="800" height="420" src="https://www.youtube.com/embed/mbeQWBNaNKQ?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
<div class="sect2">
<h3 id="avoiding-complex-groovy-code-in-pipelines"><a class="anchor" href="#avoiding-complex-groovy-code-in-pipelines"></a>Avoiding complex Groovy code in Pipelines</h3>
<div class="paragraph">
<p>For a Pipeline, Groovy code <strong>always</strong> executes on controller which means using controller resources(memory and CPU).
Therefore, it is critically important to reduce the amount of Groovy code executed by Pipelines (this includes any methods called on classes imported in Pipelines).
The following are the most common example Groovy methods to avoid using:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>JsonSlurper:</strong> This function (and some other similar ones like XmlSlurper or readFile) can be used to read from a file on disk, parse the data from that file into a JSON object, and inject that object into a Pipeline using a command like JsonSlurper().parseText(readFile("$LOCAL_FILE")). This command loads the local file into memory on the controller twice and, if the file is very large or the command is executed frequently, will require a lot of memory.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Solution: Instead of using JsonSlurper, use a shell step and return the standard out. This shell would look something like this: <code>def JsonReturn = sh label: '', returnStdout: true, script: 'echo "$LOCAL_FILE"| jq "$PARSING_QUERY"'</code>. This will use agent resources to read the file and the $PARSING_QUERY will help parse down the file into a smaller size.</p>
</li>
</ol>
</div>
</li>
<li>
<p><strong>HttpRequest:</strong> Frequently this command is used to grab data from an external source and store it in a variable. This practice is not ideal because not only is that request coming directly from the controller (which could give incorrect results for things like HTTPS requests if the controller does not have certificates loaded), but also the response to that request is stored twice.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Solution: Use a shell step to perform the HTTP request from the agent, for example using a tool like <code>curl</code> or <code>wget</code>, as appropriate. If the result must be later in the Pipeline, try to filter the result on the agent side as much as possible so that only the minimum required information must be transmitted back to the Jenkins controller.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="reducing-repetition-of-similar-pipeline-steps"><a class="anchor" href="#reducing-repetition-of-similar-pipeline-steps"></a>Reducing repetition of similar Pipeline steps</h3>
<div class="paragraph">
<p>Combine Pipeline steps into single steps as often as possible to reduce the amount of overhead caused by the Pipeline execution engine itself. For example, if you run three shell steps back-to-back, each of those steps has to be started and stopped, requiring connections and resources on the agent and controller to be created and cleaned up. However, if you put all of the commands into a single shell step, then only a single step needs to be started and stopped.</p>
</div>
<div class="paragraph">
<p>Example:
Instead of creating a series of  <code>echo</code> or <code>sh</code> steps, combine them into a single step or script.</p>
</div>
</div>
<div class="sect2">
<h3 id="avoiding-calls-to-jenkins-getinstance"><a class="anchor" href="#avoiding-calls-to-jenkins-getinstance"></a>Avoiding calls to <code>Jenkins.getInstance</code></h3>
<div class="paragraph">
<p>Using Jenkins.instance or its accessor methods in a Pipeline or shared library indicates a code misuse within that Pipeline/shared library. Using Jenkins APIs from an unsandboxed shared library means that the shared library is both a shared library and a kind of Jenkins plugin. You need to be very careful when interacting with Jenkins APIs from a Pipeline to avoid severe security and performance issues. If you must use Jenkins APIs in your build, the recommended approach is to create a minimal plugin in Java that implements a safe wrapper around the Jenkins API you want to access using Pipeline&#8217;s Step API. Using Jenkins APIs from a sandboxed Jenkinsfile directly means that you have probably had to whitelist methods that allow sandbox protections to be bypassed by anyone who can modify a Pipeline, which is a significant security risk. The whitelisted method is run as the System user, having overall admin permissions, which can lead to developers possessing higher permissions than intended.</p>
</div>
<div class="paragraph">
<p>Solution: The best solution would be to work around the calls being made, but if they must be done then it would be better to implement a Jenkins plugin which is able to gather the data needed.</p>
</div>
</div>
<div class="sect2">
<h3 id="cleaning-up-old-jenkins-builds"><a class="anchor" href="#cleaning-up-old-jenkins-builds"></a>Cleaning up old Jenkins builds</h3>
<div class="paragraph">
<p>As a Jenkins administrator, removing old or unwanted builds keeps the Jenkins controller running efficiently.
When you do not remove older builds, there are less resources for more current and relevant builds.
This video reviews using the <a href="/doc/book/pipeline/syntax/#options"><code>buildDiscarder</code></a> directive in individual Pipeline jobs.
The video also reviews the process to keep specific historical builds.</p>
</div>
<div class="videoblock">
<div class="title">How to clean up old Jenkins builds</div>
<div class="content">
<iframe width="800" height="420" src="https://www.youtube.com/embed/_Z7BlaTTGlo?rel=0" frameborder="0" allowfullscreen></iframe>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-shared-libraries"><a class="anchor" href="#using-shared-libraries"></a>Using shared libraries</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="do-not-override-built-in-pipeline-steps"><a class="anchor" href="#do-not-override-built-in-pipeline-steps"></a>Do not override built-in Pipeline steps</h3>
<div class="paragraph">
<p>Wherever possible stay away from customized/overwritten Pipeline steps.
Overriding built-in Pipeline Steps is the process of using shared libraries to overwrite the standard Pipeline APIs like <code>sh</code> or <code>timeout</code>.
This process is dangerous because the Pipeline APIs can change at any time causing custom code to break or give different results than expected.
When custom code breaks because of Pipeline API changes, troubleshooting is difficult because even if the custom code has not changed, it may not work the same after an API update.
So even if custom code has not changed, that does not mean after an API update it will keep working the same.
Lastly, because of the ubiquitous use of these steps throughout Pipelines, if something is coded incorrectly/inefficiently the results can be catastrophic to Jenkins.</p>
</div>
</div>
<div class="sect2">
<h3 id="avoiding-large-global-variable-declaration-files"><a class="anchor" href="#avoiding-large-global-variable-declaration-files"></a>Avoiding large global variable declaration files</h3>
<div class="paragraph">
<p>Having large variable declaration files can require large amounts of memory for little to no benefit, because the file is loaded for every Pipeline whether the variables are needed or not. Creating small variable files that contain only variables relevant to the current execution is recommended.</p>
</div>
</div>
<div class="sect2">
<h3 id="avoiding-very-large-shared-libraries"><a class="anchor" href="#avoiding-very-large-shared-libraries"></a>Avoiding very large shared libraries</h3>
<div class="paragraph">
<p>Using large shared libraries in Pipelines requires checking out a very large file before the Pipeline can start and loading the same shared library per job that is currently executing, which can lead to increased memory overhead and slower execution time.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="answering-additional-faqs"><a class="anchor" href="#answering-additional-faqs"></a>Answering additional FAQs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dealing-with-concurrency-in-pipelines"><a class="anchor" href="#dealing-with-concurrency-in-pipelines"></a>Dealing with Concurrency in Pipelines</h3>
<div class="paragraph">
<p>Try not to share workspaces across multiple Pipeline executions or multiple distinct Pipelines.
This practice can lead to either unexpected file modification within each Pipeline or workspace renaming.</p>
</div>
<div class="paragraph">
<p>Ideally, shared volumes/disks are mounted in a separate place and the files are copied from that place to the current workspace.
Then when the build is done the files can be copied back if there were updates done.</p>
</div>
<div class="paragraph">
<p>Build in distinct containers which create needed resources from scratch(cloud-type agents work great for this).
Building these containers will ensure that the build process begins at the start every time and is easily repeatable.
If building containers will not work, disable concurrency on the Pipeline or use the Lockable Resources Plugin to lock the workspace when it is running so that no other builds can use it while it is locked.
<strong>WARNING</strong>: Disabling concurrency or locking the workspace when it is running can cause Pipelines to become blocked when waiting on resources if those resources are arbitrarily locked.</p>
</div>
<div class="paragraph">
<p><strong>Also, be aware that both of these methods have slower time to results of builds than using unique resources for each job</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="avoiding-notserializableexception"><a class="anchor" href="#avoiding-notserializableexception"></a>Avoiding <code>NotSerializableException</code></h3>
<div class="paragraph">
<p>Pipeline code is CPS-transformed so that Pipelines are able to resume after a Jenkins restart.
That is, while the pipeline is running your script, you can shut down Jenkins or lose connectivity to an agent.
When it comes back, Jenkins remembers what it was doing and your pipeline script resumes execution as if it were never interrupted.
A technique known as "<a href="https://en.wikipedia.org/wiki/Continuation-passing_style">continuation-passing style (CPS)</a>" execution plays a key role in resuming Pipelines.
However, some Groovy expressions do not work correctly as a result of CPS transformation.</p>
</div>
<div class="paragraph">
<p>Under the hood, CPS relies on being able to serialize the pipeline&#8217;s current state along with the remainder of the pipeline to be executed.
This means that using Objects in the pipeline that are not serializable will trigger a <code>NotSerializableException</code> to be thrown when the pipeline attempts to persist its state.</p>
</div>
<div class="paragraph">
<p>See <a href="http://jenkins.io/redirect/pipeline-cps-method-mismatches">Pipeline CPS method mismatches</a> for more details and some examples of things that may be problematic.</p>
</div>
<div class="paragraph">
<p>Below will cover techniques to ensure the pipeline can function as expected.</p>
</div>
<div class="sect3">
<h4 id="ensure-persisted-variables-are-serializable"><a class="anchor" href="#ensure-persisted-variables-are-serializable"></a>Ensure Persisted Variables Are Serializable</h4>
<div class="paragraph">
<p>Local variables are captured as part of the pipeline&#8217;s state during serialization.
This means that storing non-serializable objects in variables during pipeline execution will result in a <code>NotSerializableException</code> to be thrown.</p>
</div>
</div>
<div class="sect3">
<h4 id="do-not-assign-non-serializable-objects-to-variables"><a class="anchor" href="#do-not-assign-non-serializable-objects-to-variables"></a>Do not assign non-serializable objects to variables</h4>
<div class="paragraph">
<p>One strategy to make use of non-serializable objects to always infer their value "just-in-time" instead of calculating their value and storing that value in a variable.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-noncps"><a class="anchor" href="#using-noncps"></a>Using <code>@NonCPS</code></h4>
<div class="paragraph">
<p>If necessary, you can use the <code>@NonCPS</code> annotation to disable the CPS transformation for a specific method whose body would not execute correctly if it were CPS-transformed.
Just be aware that this also means the Groovy function will have to restart completely since it is not transformed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Asynchronous Pipeline steps (such as <code>sh</code> and <code>sleep</code>) are always CPS-transformed, and may not be used inside of a method annotated with <code>@NonCPS</code>.
In general, you should avoid using pipeline steps inside of methods annotated with <code>@NonCPS</code></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="pipeline-durability"><a class="anchor" href="#pipeline-durability"></a>Pipeline Durability</h4>
<div class="paragraph">
<p>It is noteworthy that changing the pipeline&#8217;s durability can result in <code>NotSerializableException</code> not being thrown where they otherwise would have been.
This is because decreasing the pipeline&#8217;s durability through PERFORMANCE_OPTIMIZED means that the pipeline&#8217;s current state is persisted significantly less frequently.
Therefore, the pipeline never attempts to serialize the non-serializable values and as such, no exception is thrown.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This note exists to inform users as to the root cause of this behavior.
It is not recommended that the Pipeline&#8217;s durability setting be set to Performance Optimized purely to avoid serializability issues.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<hr>
<div>
<div class="row">
<div class="col-md-4">
<a class="prev doc-page-link" href="../syntax">
⇐ Pipeline Syntax
</a>
</div>
<div class="col-md-4">
<a class="up doc-page-link" href="../">
⇑ Pipeline
</a>
<a class="index doc-page-link" href="../../">
Index
</a>
</div>
<div class="col-md-4">
<a class="next doc-page-link" href="../scaling-pipeline">
Scaling Pipelines ⇒
</a>
</div>
</div>
</div>
<hr>
<div class="container"></div>
<!-- starting partial _feedback-footer.html -->
<!-- HTML inclusion for chapter and section layouts (i.e. as footers) as well as
     for use in AsciiDoc file inclusions. -->

<!--
This feedback form was prepared from a Google Form, based on the techniques in
the following documentation sources:
https://codepen.io/learningcode/post/customize-a-google-form-for-your-website,
https://mrhaki.blogspot.com.au/2014/06/awesome-asciidoc-include-raw-html.html,
https://www.freshtechtips.com/2013/05/custom-google-drive-contact-form.html,
https://stackoverflow.com/questions/24436165/set-value-of-hidden-input-inside-form
-->

<!-- Feedback form functionality in JavaScript - refer to comments in this file
     for details on the functionality. -->
<script>
var feedbackForm = {
    formKey : 'e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w'
};
$(document).ready(function() {
    window.onload = feedbackForm.start(window.location.href);
});
</script>
<script src="/js/feedback-form-functionality.js"></script>

<p><a href="#feedback" data-bs-toggle="collapse">Was this page helpful?</a></p>

<div id="feedback" class="collapse">

<p>Please submit your feedback about this page through this
<a href="/doc/feedback-form/">quick form</a>.</p>

<p>Alternatively, if you don't wish to complete the quick form, you can simply
indicate if you found this page helpful?</p>

<!-- Redirects to custom "thank you" page once form is submitted. -->
<script type="text/javascript">
var submitted=false;
</script>
<iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"
onload="if(submitted) {window.location='/doc/thank-you-for-your-feedback/';}">
</iframe>
<form action="https://docs.google.com/forms/d/e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w/formResponse" method="POST" id="ss-form" target="hidden_iframe" onsubmit="submitted=true;">

<!-- Set the value of the current URL into the form. -->
<input type="hidden" name="entry.1246830226" id="current-url" value=""/>

<!-- The answer bit -->
<p><input type="radio" name="entry.790002525" id="h1" value="Yes" required/>
<label for="h1">Yes</label>&nbsp;&nbsp;&nbsp;&nbsp;
<input type="radio" name="entry.790002525" id="h2" value="No"/>
<label for="h2">No</label></p>

<!-- The CAPTCHA bit -->

<p><label id="ssTestLabel" for="ssTestValue"></label><br/>
<input type="text" name="ssTestValue" value="" id="ssTestValue"/></p>

<!-- Submit button -->

<p><input class="button" type="submit" value="Submit"/></p>

</form>

<p>See existing feedback <a href="https://docs.google.com/spreadsheets/d/1IIdpVs39JDYKg0sLQIv-MNO928qcGApAIfdW5ohfD78" target="_blank" rel="noreferrer noopener">here</a>.</p>

</div>

<!-- ending partial _feedback-footer.html -->

</div>
</div>
</div>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//doc/book/pipeline/pipeline-best-practices.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
