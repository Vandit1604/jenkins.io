<!DOCTYPE html>
<html lang="en">
<head>
<title>
Jenkins code coverage diff in pull requests
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Report code coverage changes in pull requests" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2019/07/21/Jenkins-code-coverage-diff-for-pull-request/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="Jenkins code coverage diff in pull requests" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Jenkins code coverage diff in pull requests" name="twitter:title">
<meta content="Report code coverage changes in pull requests" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/post-images/2019-07-21-Jenkins-code-coverage-diff-for-pull-request/increase.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Jenkins code coverage diff in pull requests" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2019/07/21/Jenkins-code-coverage-diff-for-pull-request/" property="og:url">
<meta content="Report code coverage changes in pull requests" name="og:description">
<meta content="Jenkins code coverage diff in pull requests" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/post-images/2019-07-21-Jenkins-code-coverage-diff-for-pull-request/increase.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.app-post-page h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<article class="container app-post-page">
<div class="app-!-display-flex">
<a class="app-back-link" href="/jenkins.io/independent-scrolling-patch/node/">
Back to blog
</a>
</div>
<h1>
Jenkins code coverage diff in pull requests
</h1>
<div class="post-attrs">
<a class="app-author-link" href="/blog/authors/asavanchuk/"><div class="app-avatar"><img alt="Aliaksei Savanchuk" class="app-avatar__image" src="/images/avatars/asavanchuk.jpg"></div> Aliaksei Savanchuk</a>
July 21, 2019
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/intent/tweet?text=Jenkins+code+coverage+diff+in+pull+requests&amp;url=https%3A%2F%2Fwww.jenkins.io%2Fjenkins.io%2Findependent-scrolling-patch%2Fblog%2F2019%2F07%2F21%2FJenkins-code-coverage-diff-for-pull-request%2F" rel="noreferrer nofollow" target="_blank">
Tweet
</a>
</div>
<div class="blog-content">
<div class="paragraph">
<p>Hello.</p>
</div>
<div class="paragraph">
<p>As you may know, during the last year GSoC <a href="https://github.com/cizezsy">Mr. Shenyu Zheng</a> was working on the <a href="/projects/gsoc/2018/code-coverage-api-plugin/">Jenkins Code Coverage API Plugin</a>. With Mr. Zheng we made a change so the plugin now is able to check the difference in code coverage between pull requests and target branches.</p>
</div>
<div class="paragraph">
<p>In lots of projects it is a common practice to track if unit tests code coverage doesn&#8217;t decrease. So, with this plugin, you may skip separate services that track code coverage and have this feature right in your favorite CI system.</p>
</div>
<div class="sect1">
<h2 id="how-it-works"><a class="anchor" href="#how-it-works"></a>How it works</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you build a PR in Jenkins, using plugins like <a href="https://plugins.jenkins.io/github">Github</a> or <a href="https://plugins.jenkins.io/cloudbees-bitbucket-branch-source">Bitbucket Branch Source</a>, that use <a href="https://wiki.jenkins.io/display/JENKINS/SCM+API+Plugin">SCM API Plugin</a>, your PR knows what target branch commit it is based on. (The commit may change because of <em>Discover pull requests from origin</em> strategies). To calculate the diff, when you publish your coverage from PR, it looks for the target branch build for the commit that your PR was based on. If it finds the build on the target branch, it looks for any published code coverage for this target branch build. In case the build has it, the plugin calculates the percentage diff for the <strong>line coverage</strong> and shows it on the pull request build page. Also, it gives you a link to the target branch build that was used for the comparison.</p>
</div>
<div class="paragraph">
<p>That it how it looks like:</p>
</div>
<div class="paragraph">
<div class="title">Decreased coverage</div>
<p><span class="image"><img src="/images/post-images/2019-07-21-Jenkins-code-coverage-diff-for-pull-request/decrease.png" alt="decrease"></span></p>
</div>
<div class="paragraph">
<div class="title">Increased coverage</div>
<p><span class="image"><img src="/images/post-images/2019-07-21-Jenkins-code-coverage-diff-for-pull-request/increase.png" alt="increase"></span></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="how-to-enable-code-coverage-diff-for-pull-requests"><a class="anchor" href="#how-to-enable-code-coverage-diff-for-pull-requests"></a>How to enable code coverage diff for pull requests</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To enable this behavior you need to publish your code coverage with the <code>calculateDiffForChangeRequests</code> flag equals <code>true</code>, like this:
.Jenkinsfile</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="n">node</span><span class="o">(...)</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="c1">// Here we are using the istanbulCoberturaAdapter</span>
  <span class="n">publishCoverage</span> <span class="nl">adapters:</span> <span class="o">[</span><span class="n">istanbulCoberturaAdapter</span><span class="o">(</span><span class="s1">'cobertura-coverage.xml'</span><span class="o">)],</span>
    <span class="nl">sourceFileResolver:</span> <span class="n">sourceFiles</span><span class="o">(</span><span class="s1">'NEVER_STORE'</span><span class="o">),</span>
    <span class="nl">calculateDiffForChangeRequests:</span> <span class="kc">true</span>

  <span class="o">...</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="links-and-feedback"><a class="anchor" href="#links-and-feedback"></a>Links and Feedback</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you have some questions about this behavior, please ask me <a href="mailto:dntsaygoodbye@gmail.com">in email</a>.</p>
</div>
<div class="paragraph">
<p>You are free to contribute to this plugin to make it better for everyone. There are a lot of interesting features that can be added and issues that can be solved. Also, you can write some new plugins for other code coverage formats that use the Code Coverage API plugin as a base.</p>
</div>
<div class="paragraph">
<p>Here is the repo of the plugin - <a href="https://github.com/jenkinsci/code-coverage-api-plugin">Code Coverage API Plugin</a></p>
</div>
<div class="paragraph">
<p>Thank you.</p>
</div>
</div>
</div>
</div>
<ul class="app-tags">
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/plugins/">
plugins
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/codecoverage/">
codecoverage
</a>
</li>
</ul>
<h2>
About the author
</h2>
<!-- starting partial author.html.haml -->
<div class="app-author" id="about-the-author">
<!-- starting partial avatar.html.haml -->
<div class="app-avatar" style="min-width: 64px; width: 25vw; max-width: 128px">
<img alt="Aliaksei Savanchuk" class="app-avatar__image" src="/jenkins.io/independent-scrolling-patch/images/avatars/asavanchuk.jpg">
</div>

<!-- ending partial avatar.html.haml -->
<div class="app-author__content">
<p class="app-author__name">
<a href="/blog/authors/asavanchuk/">
Aliaksei Savanchuk
</a>
</p>
<div class="paragraph">
<p>Software developer from Minsk, Belarus.</p>
</div>
<!-- starting partial social-media-buttons.html.haml -->
<ul class="app-social-media-buttons">
<li>
<a href="https://github.com/tempora-mutantur" rel="noreferrer noopener" target="_blank">
GitHub
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</div>
</div>

<!-- ending partial author.html.haml -->
<!-- starting partial discuss.html.haml -->

<!-- ending partial discuss.html.haml -->
</article>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//blog/2019/07/2019-07-21-Jenkins-code-coverage-diff-for-pull-request.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
