<!DOCTYPE html>
<html lang="en">
<head>
<title>
Testing
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/doc/developer/testing/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="Testing" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Testing" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Testing" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/doc/developer/testing/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="Testing" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<style>
  h4 {
    font-size: 22px;
  }
  div.container .row.body {
    margin-right: 1em;
    margin-left: 1em;
    padding-left: 0;
    padding-right: 0;
  }
  .toc {
      float: right;
  }
  div.sidebar-nav > ul {
    list-style: none;
    padding-inline-start: 2em;
  }
  ion-icon {
    color: #bf6900;
  }
  .jenkins-developer-chapters {
    list-style: none;
    padding-inline-start: 0;
    padding-left: 0;
    padding-right: 0;
  }
  #dev-docs {
    margin-bottom: 1em;
  }
  #reference-topics {
    font-weight: normal;
  }
  #reference-topics:active {
    font-weight: bold;
  }
  #taglibs {
    margin-bottom: 2em;
    font-weight: normal;
  }
  #taglibs:active {
    font-weight: bold;
  }
  #how-to-guides {
    font-weight: normal;
  }
  #how-to-guides:active {
    font-weight: bold;
  }
  #plugin-tutorial {
    font-weight: normal;
  }
  #plugin-tutorial:active {
    font-weight: bold;
  }
  #javadoc {
    font-weight: normal;
  }
  #javadoc:active {
    font-weight: bold;
  }
</style>
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.container .row .col-8 h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<div class="container">
<div class="row body flex-nowrap">
<div class="col-4" id="sidebar-menu">
<div class="sidebar-nav tour" id="sidebar-content">
<p>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/" class="">> Developer Documentation Home</a>
</p>
<h4 id="dev-docs">
Developer Documentation
</h4>
<h5 id="plugin-tutorial">
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/tutorial/" class="">Plugin Tutorial</a>
</h5>
<h5 id="how-to-guides">
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/guides/" class="">How-To Guides</a>
</h5>
<h5 id="reference-topics">
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/book/" class="">Reference Topics</a>
</h5>
<ul>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/architecture/" class="">Architecture</a>
<span title="Partial work in progress">
<ion-icon name="warning" style="opacity: 0.5;"></ion-icon>
</span>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/initialization/" class="">Initialization and Startup</a>
<span title="Partial work in progress">
<ion-icon name="warning" style="opacity: 0.5;"></ion-icon>
</span>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/extensibility/" class="">Extensibility</a>
<span title="Partial work in progress">
<ion-icon name="warning" style="opacity: 0.5;"></ion-icon>
</span>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/model/" class="">Model</a>
<span title="Partial work in progress">
<ion-icon name="warning" style="opacity: 0.5;"></ion-icon>
</span>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/handling-requests/" class="">Handling Requests</a>
<span title="Partial work in progress">
<ion-icon name="warning" style="opacity: 0.5;"></ion-icon>
</span>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/security/" class="">Security</a>
<span title="Partial work in progress">
<ion-icon name="warning" style="opacity: 0.5;"></ion-icon>
</span>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/persistence/" class="">Persistent Objects</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/scheduling/" class="">Scheduling</a>
<span title="Early work in progress">
<ion-icon name="warning" style="opacity: 0.5;"></ion-icon>
</span>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/views/" class="">Views</a>
<span title="Partial work in progress">
<ion-icon name="warning" style="opacity: 0.5;"></ion-icon>
</span>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/forms/" class="">Forms</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/internationalization/" class="">Internationalization and Localization</a>
<span title="Partial work in progress">
<ion-icon name="warning" style="opacity: 0.5;"></ion-icon>
</span>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/distributed-builds/" class="">Distributed Builds</a>
<span title="Partial work in progress">
<ion-icon name="warning" style="opacity: 0.5;"></ion-icon>
</span>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/cli/" class="">Jenkins CLI</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/testing/" class="active">Testing</a>
<span title="Partial work in progress">
<ion-icon name="warning" style="opacity: 0.5;"></ion-icon>
</span>
<small>
<ul style="padding-left: 1rem;">
</ul>
</small>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/telemetry/" class="">Telemetry</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/plugin-development/" class="">Plugin Development</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/plugin-governance/" class="">Plugin Governance</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/publishing/" class="">Publishing Plugins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/blueocean-plugin-development/" class="">Blue Ocean</a>
<span title="Partial work in progress">
<ion-icon name="warning" style="opacity: 0.5;"></ion-icon>
</span>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/building/" class="">Building and Debugging</a>
<span title="Partial work in progress">
<ion-icon name="warning" style="opacity: 0.5;"></ion-icon>
</span>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/development-environment/" class="">Development Environment</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/crowdin/" class="">Jenkins Crowdin Integration</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/tutorial-improve/" class="">Improve a Plugin Tutorial</a>
</li>
</ul>
<h5>
Resources
</h5>
<h6 style="padding-left: 2rem;">
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/extensions/" class="">Extensions Index</a>
</h6>
<h6 id="javadoc" style="padding-left: 2rem;">
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/javadoc/" class="">Javadoc</a>
</h6>
<h6 id="taglibs" style="padding-left: 2rem;">
<a href="/jenkins.io/independent-scrolling-patch/doc/developer/development-environment/taglibs/" class="">Taglibs</a>
</h6>
<h5>
Tools
</h5>
<ul>
<li>
<a href="https://jenkinsci.github.io/maven-hpi-plugin/" rel="noreferrer noopener" target="_blank">
Maven HPI Plugin
</a>
</li>
</ul>
</div>
</div>
<div class="col-8">
<h1>
Testing
</h1>
<!-- starting partial wip.adoc -->
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This section is a work in progress.
Want to help?
Check out the <a href="https://groups.google.com/forum/#!forum/jenkinsci-docs">jenkinsci-docs mailing list</a>.
For other ways to contribute to the Jenkins project, see <a href="/participate">this page about participating and contributing</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<!-- ending partial wip.adoc -->
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Writing automated tests for Jenkins and its plugins is important to ensure that everything works as expected — in various scenarios, with multiple Java versions, and on different operating systems — while helping to prevent regressions from being introduced in later releases.</p>
</div>
<div class="paragraph">
<p>Whether you&#8217;re writing a new Jenkins plugin, or just looking to <a href="/participate/">participate in the Jenkins project</a>, this guide aims to cover everything you should need to get started writing various types of automated tests.
Basic experience of writing Java-based tests with the <a href="https://junit.org/">JUnit test framework</a> is assumed.</p>
</div>
<div class="paragraph">
<p>To make the development of tests simpler, Jenkins comes with a <a href="https://github.com/jenkinsci/jenkins-test-harness/">test harness</a>, based on the JUnit test framework.
This provides the following features:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Automated setup and teardown of a Jenkins installation, allowing each test method to run in a clean, isolated environment.</p>
</li>
<li>
<p>Helper classes and methods to simplify the creation of jobs, agents, security realms, SCM implementations and more.</p>
</li>
<li>
<p>Declarative annotations to specify the environment a test method will use; for example, setting the <code>JENKINS_HOME</code> contents.</p>
</li>
<li>
<p>Direct access to the Jenkins object model. This allows tests to assert directly against the internal state of Jenkins.</p>
</li>
<li>
<p><a href="https://htmlunit.sourceforge.io/">HtmlUnit</a> support, making it simple to test interaction with the web UI and other HTTP calls.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setting-up"><a class="anchor" href="#setting-up"></a>Setting Up</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="dependencies"><a class="anchor" href="#dependencies"></a>Dependencies</h3>
<div class="sect3">
<h4 id="jenkins-test-harness"><a class="anchor" href="#jenkins-test-harness"></a>Jenkins Test Harness</h4>
<div class="paragraph">
<p>By default, you don&#8217;t need to do anything to set up the <a href="https://github.com/jenkinsci/jenkins-test-harness/">Jenkins Test Harness</a> for your plugin.
All Jenkins plugins inherit from the <a href="https://github.com/jenkinsci/plugin-pom/">plugin parent POM</a> and therefore have the test harness dependency included automatically.</p>
</div>
<div class="paragraph">
<p>Similarly, JUnit is included as a dependency by the parent POM, so you don&#8217;t need to add it as a dependency.</p>
</div>
<div class="sect4">
<h5 id="overriding-the-test-harness-version"><a class="anchor" href="#overriding-the-test-harness-version"></a>Overriding the Test Harness Version</h5>
<div class="paragraph">
<p>If you&#8217;re using version 2.3 or newer of the plugin parent POM, you can change the test harness version used by overriding the <code>jenkins-test-harness.version</code> property, if you need newer features.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="xml"><span class="nt">&lt;project&gt;</span>
  …
  <span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;jenkins-test-harness.version&gt;</span>2.34<span class="nt">&lt;/jenkins-test-harness.version&gt;</span>
  <span class="nt">&lt;/properties&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="working-with-pipeline"><a class="anchor" href="#working-with-pipeline"></a>Working with Pipeline</h4>
<div class="paragraph">
<p>You are encouraged to test that your plugin works with <a href="/doc/pipeline/">Pipeline</a>.
You can do so without making your plugin itself dependent on various Pipeline-related plugins; instead you can include these as <code>test</code> dependencies, so that they are only used when compiling and running test cases.</p>
</div>
<div class="paragraph">
<p>This is done by adding the minimum required Pipeline plugins to the <code>&lt;dependencies&gt;</code> section of your POM.
The following list covers typical integration tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.jenkins-ci.plugins.workflow<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>workflow-basic-steps<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.jenkins-ci.plugins.workflow<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>workflow-cps<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.jenkins-ci.plugins.workflow<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>workflow-durable-task-step<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.jenkins-ci.plugins.workflow<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>workflow-job<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>(You will also need to specify <code>&lt;version&gt;</code>s, unless you are using the <a href="https://github.com/jenkinsci/bom/blob/master/README.md">BOM</a>.)</p>
</div>
</div>
<div class="sect3">
<h4 id="depending-on-other-plugins"><a class="anchor" href="#depending-on-other-plugins"></a>Depending on Other Plugins</h4>
<div class="paragraph">
<p>Any Jenkins plugins that you add as dependencies to your POM with <code>&lt;scope&gt;test&lt;/scope&gt;</code> will be available in the Jenkins installations created while running test cases, or when using <a href="/doc/developer/tutorial/run/"><code>mvn hpi:run</code></a>.</p>
</div>
<div class="paragraph">
<p>You can also apply the <a href="https://javadoc.jenkins.io/component/jenkins-test-harness/?org/jvnet/hudson/test/recipes/WithPlugin.html"><code>@WithPlugin</code></a> annotation to individual test cases, but this is rarely required.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="source-code-location"><a class="anchor" href="#source-code-location"></a>Source Code Location</h3>
<div class="paragraph">
<p>The source code for your test cases should be placed in the standard location for Maven projects, i.e. under the <code>src/test/java/</code> directory.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To see some working examples of plugin development,
including use of <code>JenkinsRule</code> to test plugin code in the context of temporary Jenkins installations,
try using one of the official <a href="https://github.com/jenkinsci/archetypes#usage">archetypes</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-tests"><a class="anchor" href="#running-tests"></a>Running Tests</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="from-the-command-line"><a class="anchor" href="#from-the-command-line"></a>From the Command Line</h3>
<div class="paragraph">
<p><code>mvn test</code> will run all test cases, report progress and results on the command line, and write those results to JUnit XML files following the pattern <code>target/surefire-reports/TEST-&lt;class name&gt;.xml</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="from-an-ide"><a class="anchor" href="#from-an-ide"></a>From an IDE</h3>
<div class="paragraph">
<p>Most Java IDEs should be able to run JUnit tests and report on the results.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-to-test"><a class="anchor" href="#what-to-test"></a>What to Test</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we can write a basic test, we should discuss what you should be testing…</p>
</div>
<div class="paragraph">
<p>TODO: Unit testing of your code, as much as possible. JenkinsRule testing: creating jobs that use your build steps, running them, asserting on the output</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="common-patterns"><a class="anchor" href="#common-patterns"></a>Common Patterns</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section covers patterns that you will commonly use in your test cases, plus scenarios that you should consider testing.</p>
</div>
<div class="sect2">
<h3 id="configuration-round-trip-testing"><a class="anchor" href="#configuration-round-trip-testing"></a>Configuration Round-trip Testing</h3>
<div class="paragraph">
<p>For Freestyle jobs, where users have to configure projects via the web interface, if you&#8217;re writing a <a href="https://javadoc.jenkins.io/byShortName/Builder"><code>Builder</code></a>, <a href="https://javadoc.jenkins.io/byShortName/Publisher"><code>Publisher</code></a> or similar, it&#8217;s a good idea to test that your configuration form works properly.
The process to follow is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start up a Jenkins installation and programmatically configure your plugin.</p>
</li>
<li>
<p>Open the relevant configuration page in Jenkins via HtmlUnit.</p>
</li>
<li>
<p>Submit the configuration page without making any changes.</p>
</li>
<li>
<p>Verify that your plugin is still identically configured.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This can be done easily with the <a href="https://javadoc.jenkins.io/component/jenkins-test-harness/org/jvnet/hudson/test/JenkinsRule.html#configRoundtrip--"><code>configRoundtrip</code></a> convenience methods in <code>JenkinsRule</code>.
Use <a href="https://github.com/jenkinsci/archetypes#usage">archetypes</a> to see examples.</p>
</div>
</div>
<div class="sect2">
<h3 id="providing-environment-variables"><a class="anchor" href="#providing-environment-variables"></a>Providing Environment Variables</h3>
<div class="paragraph">
<p>In Jenkins, you can set environment variables on the Configure System page, which then become available during builds.
To recreate the same configuration from a test method, you can do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><span class="nd">@Rule</span> <span class="kd">public</span> <span class="nc">JenkinsRule</span> <span class="n">j</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JenkinsRule</span><span class="o">();</span>

<span class="nd">@Test</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">someTest</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">EnvironmentVariablesNodeProperty</span> <span class="n">prop</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EnvironmentVariablesNodeProperty</span><span class="o">();</span>
  <span class="nc">EnvVars</span> <span class="n">env</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="na">getEnvVars</span><span class="o">();</span>
  <span class="n">env</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"DEPLOY_TARGET"</span><span class="o">,</span> <span class="s">"staging"</span><span class="o">);</span>
  <span class="n">j</span><span class="o">.</span><span class="na">jenkins</span><span class="o">.</span><span class="na">getGlobalNodeProperties</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">prop</span><span class="o">);</span>
  <span class="c1">// …</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="providing-test-data"><a class="anchor" href="#providing-test-data"></a>Providing Test Data</h3>
<div class="paragraph">
<p>In order to test parts of your plugin, you may want certain files to exist in the build workspace, or that Jenkins is configured in a certain way.
This section covers various ways to achieve this using the Jenkins Test Harness.</p>
</div>
<div class="sect3">
<h4 id="customizing-the-build-workspace"><a class="anchor" href="#customizing-the-build-workspace"></a>Customizing the Build Workspace</h4>
<div class="sect4">
<h5 id="using-a-dummy-scm"><a class="anchor" href="#using-a-dummy-scm"></a>Using a Dummy SCM</h5>
<div class="paragraph">
<p>Freestyle projects typically check out code from an SCM before running the build steps, and the test harness provides a few dummy SCM implementations which make it easy to "check out" files into the workspace.</p>
</div>
<div class="paragraph">
<p>The simplest of these is the <a href="https://javadoc.jenkins.io/component/jenkins-test-harness/?org/jvnet/hudson/test/SingleFileSCM.html"><code>SingleFileSCM</code></a> which, as its name suggests, provides a single file during checkout.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><span class="nd">@Rule</span> <span class="kd">public</span> <span class="nc">JenkinsRule</span> <span class="n">j</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JenkinsRule</span><span class="o">();</span>

<span class="nd">@Test</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">customizeWorkspaceWithFile</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
  <span class="c1">// Create a Freestyle project with a dummy SCM</span>
  <span class="nc">FreeStyleProject</span> <span class="n">project</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="na">createFreeStyleProject</span><span class="o">();</span>
  <span class="n">project</span><span class="o">.</span><span class="na">setScm</span><span class="o">(</span><span class="k">new</span> <span class="nc">SingleFileSCM</span><span class="o">(</span><span class="s">"greeting.txt"</span><span class="o">,</span> <span class="s">"hello"</span><span class="o">));</span>
  <span class="c1">// …</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once a build of this project starts, the file <code>greetings.txt</code> with the contents <code>hello</code> will be added to the workspace during the SCM checkout phase.</p>
</div>
<div class="paragraph">
<p>There are additional variants of the <code>SingleFileSCM</code> constructor which let you create the file contents from a byte array, or by reading a file from the resources folder, or another <code>URL</code> source.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><span class="kn">import</span> <span class="nn">io.jenkins.myplugin</span><span class="o">;</span>

<span class="c1">// Reads the contents from `src/test/resources/io/jenkins/myplugin/test.json`</span>
<span class="n">project</span><span class="o">.</span><span class="na">setScm</span><span class="o">(</span><span class="k">new</span> <span class="nc">SingleFileSCM</span><span class="o">(</span><span class="s">"data.json"</span><span class="o">,</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getResource</span><span class="o">(</span><span class="s">"test.json"</span><span class="o">)));</span>

<span class="c1">// Reads the contents from `src/test/resources/test.json` — note the slash prefix</span>
<span class="n">project</span><span class="o">.</span><span class="na">setScm</span><span class="o">(</span><span class="k">new</span> <span class="nc">SingleFileSCM</span><span class="o">(</span><span class="s">"data.json"</span><span class="o">,</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getResource</span><span class="o">(</span><span class="s">"/test.json"</span><span class="o">)));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to provide more than a single file, you can use <a href="https://javadoc.jenkins.io/component/jenkins-test-harness/?org/jvnet/hudson/test/ExtractResourceSCM.html"><code>ExtractResourceSCM</code></a>, which will extract the contents of a given zip file into the workspace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><span class="kn">import</span> <span class="nn">io.jenkins.myplugin</span><span class="o">;</span>

<span class="c1">// Extracts `src/test/resources/io/jenkins/myplugin/files-and-folders.zip` into the workspace</span>
<span class="n">project</span><span class="o">.</span><span class="na">setScm</span><span class="o">(</span><span class="k">new</span> <span class="nc">ExtractResourceSCM</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getResource</span><span class="o">(</span><span class="s">"files-and-folders.zip"</span><span class="o">)));</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="within-a-pipeline"><a class="anchor" href="#within-a-pipeline"></a>Within a Pipeline</h5>
<div class="paragraph">
<p>Pipeline projects don&#8217;t have the concept of a single SCM, like Freestyle projects do, but offer a variety of ways to places files into a workspace.</p>
</div>
<div class="paragraph">
<p>At its most simple, you can use the <a href="/doc/pipeline/steps/workflow-basic-steps/#writefile-write-file-to-workspace"><code>writeFile</code></a> step from the <a href="https://plugins.jenkins.io/workflow-basic-steps">Pipeline: Basic Steps plugin</a>. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><span class="nd">@Rule</span> <span class="kd">public</span> <span class="nc">JenkinsRule</span> <span class="n">j</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JenkinsRule</span><span class="o">();</span>

<span class="nd">@Test</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">customizeWorkspace</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="c1">// Create a new Pipeline with the given (Scripted Pipeline) definition</span>
    <span class="nc">WorkflowJob</span> <span class="n">project</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="na">createProject</span><span class="o">(</span><span class="nc">WorkflowJob</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">project</span><span class="o">.</span><span class="na">setDefinition</span><span class="o">(</span><span class="k">new</span> <span class="nc">CpsFlowDefinition</span><span class="o">(</span><span class="s">""</span> <span class="o">+</span>
        <span class="s">"node {"</span> <span class="o">+</span> <i class="conum" data-value="1"></i><b>(1)</b>
        <span class="s">"  writeFile text: 'hello', file: 'greeting.txt'"</span> <span class="o">+</span>
        <span class="s">"  // …"</span> <span class="o">+</span>
        <span class="s">"}"</span><span class="o">,</span> <span class="kc">true</span><span class="o">));</span>
    <span class="c1">// …</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>node</code> allocates a workspace on an agent, so that we have somewhere to write files to.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, you can use the <a href="/doc/pipeline/steps/pipeline-utility-steps/#unzip-extract-zip-file"><code>unzip</code></a> step from the <a href="https://plugins.jenkins.io/pipeline-utility-steps">Pipeline Utility Steps plugin</a> to copy multiple files and folders into the workspace.</p>
</div>
<div class="paragraph">
<p>First, add the plugin to your POM as a test dependency — you can find the <code>groupId</code> and <code>artifactId</code> values in the <a href="https://github.com/jenkinsci/pipeline-utility-steps-plugin/blob/master/pom.xml">plugin POM</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.jenkins-ci.plugins<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>pipeline-utility-steps<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.5.1<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can then write a test which starts by extracting that zip file.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><span class="kn">import</span> <span class="nn">io.jenkins.myplugin</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PipelineWorkspaceExampleTest</span> <span class="o">{</span>
  <span class="nd">@Rule</span> <span class="kd">public</span> <span class="nc">JenkinsRule</span> <span class="n">j</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JenkinsRule</span><span class="o">();</span>

  <span class="nd">@Test</span> <span class="kd">public</span> <span class="kt">void</span> <span class="nf">customizeWorkspaceFromZip</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
      <span class="c1">// Get a reference to the zip file from the `src/test/resources/io/jenkins/myplugin/files-and-folders.zip`</span>
      <span class="no">URL</span> <span class="n">zipFile</span> <span class="o">=</span> <span class="n">getClass</span><span class="o">().</span><span class="na">getResource</span><span class="o">(</span><span class="s">"files-and-folders.zip"</span><span class="o">);</span>

      <span class="c1">// Create a new Pipeline with the given (Scripted Pipeline) definition</span>
      <span class="nc">WorkflowJob</span> <span class="n">project</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="na">createProject</span><span class="o">(</span><span class="nc">WorkflowJob</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="n">project</span><span class="o">.</span><span class="na">setDefinition</span><span class="o">(</span><span class="k">new</span> <span class="nc">CpsFlowDefinition</span><span class="o">(</span><span class="s">""</span> <span class="o">+</span>
          <span class="s">"node {"</span> <span class="o">+</span> <i class="conum" data-value="1"></i><b>(1)</b>
          <span class="s">"  unzip '"</span> <span class="o">+</span> <span class="n">zipFile</span><span class="o">.</span><span class="na">getPath</span><span class="o">()</span> <span class="o">+</span> <span class="s">"'"</span> <span class="o">+</span> <i class="conum" data-value="1"></i><b>(1)</b>
          <span class="s">"  // …"</span> <span class="o">+</span>
          <span class="s">"}"</span><span class="o">,</span> <span class="kc">true</span><span class="o">));</span>
      <span class="c1">// …</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The path to the zip file is dynamic, so we pass it into the Pipeline definition.</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="using-filepath"><a class="anchor" href="#using-filepath"></a>Using <code>FilePath</code></h5>
<div class="paragraph">
<p>TODO: Expand this section, and explain the below example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><span class="nc">FilePath</span> <span class="n">workspace</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="na">jenkins</span><span class="o">.</span><span class="na">getWorkspaceFor</span><span class="o">(</span><span class="n">job</span><span class="o">);</span>
<span class="nc">FilePath</span> <span class="n">report</span> <span class="o">=</span> <span class="n">workspace</span><span class="o">.</span><span class="na">child</span><span class="o">(</span><span class="s">"target"</span><span class="o">).</span><span class="na">child</span><span class="o">(</span><span class="s">"lint-results.xml"</span><span class="o">);</span>
<span class="n">report</span><span class="o">.</span><span class="na">copyFrom</span><span class="o">(</span><span class="n">getClass</span><span class="o">().</span><span class="na">getResourceAsStream</span><span class="o">(</span><span class="s">"lint-results_r20.xml"</span><span class="o">));</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="customizing-the-jenkins_home-directory"><a class="anchor" href="#customizing-the-jenkins_home-directory"></a>Customizing the <code>JENKINS_HOME</code> Directory</h4>
<div class="paragraph">
<p>TODO: Write this section.</p>
</div>
</div>
<div class="sect3">
<h4 id="using-localdata"><a class="anchor" href="#using-localdata"></a>Using <code>@LocalData</code></h4>
<div class="paragraph">
<p>TODO: Properly write this section.</p>
</div>
<div class="paragraph">
<p>Runs a test case with a data set local to test method or the test class.</p>
</div>
<div class="paragraph">
<p>This recipe allows your test case to start with the preset HUDSON_HOME data loaded either from your test method or from the test class.
For example, if the test method is org.acme.FooTest.bar(), then you can have your test data in one of the following places in resources folder (typically src/test/resources):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Under org/acme/FooTest/bar directory (that is, you&#8217;ll have org/acme/FooTest/bar/config.xml), in the same layout as in the real JENKINS_HOME directory.</p>
</li>
<li>
<p>In org/acme/FooTest/bar.zip as a zip file.</p>
</li>
<li>
<p>Under org/acme/FooTest directory (that is, you&#8217;ll have org/acme/FooTest/config.xml), in the same layout as in the real JENKINS_HOME directory.</p>
</li>
<li>
<p>In org/acme/FooTest.zip as a zip file.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Search is performed in this specific order. The fall back mechanism allows you to write one test class that interacts with different aspects of the same data set, by associating the dataset with a test class, or have a data set local to a specific test method.
The choice of zip and directory depends on the nature of the test data, as well as the size of it.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-an-scm"><a class="anchor" href="#configuring-an-scm"></a>Configuring an SCM</h3>
<div class="paragraph">
<p>TODO: Write this section.
You can create a Git repository during a test using <code>@GitSampleRepoRule</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-agents"><a class="anchor" href="#using-agents"></a>Using Agents</h3>
<div class="paragraph">
<p>Agents can be used in tests creating a <code>DumbSlave</code> object to be used later in a Pipeline or in a Freestyle job.
After that, the agent can be connected to the Controller using the <code>JenkinsRule</code> methods or retrieving the <code>Computer</code> object from the agent.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><span class="kn">import</span> <span class="nn">org.jenkinsci.plugins.workflow.job.WorkflowJob</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jvnet.hudson.test.JenkinsRule</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jvnet.hudson.test.recipes.LocalData</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">hudson.model.Computer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">hudson.model.FreeStyleProject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">hudson.model.labels.LabelAtom</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">hudson.slaves.DumbSlave</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">hudson.slaves.JNLPLauncher</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">WithAgentTest</span> <span class="o">{</span>

  <span class="nd">@Rule</span>
  <span class="kd">public</span> <span class="nc">JenkinsRule</span> <span class="n">jenkinsRule</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JenkinsRule</span><span class="o">();</span>

  <span class="nd">@Test</span>
  <span class="nd">@LocalData</span> <span class="c1">// Suppose you have already created a Freestyle and a WorkflowJob</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test_agent</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="c1">// Creating the agent with a specific label</span>
    <span class="nc">LabelAtom</span> <span class="n">testingLabel</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LabelAtom</span><span class="o">(</span><span class="s">"testing"</span><span class="o">);</span>
    <span class="nc">DumbSlave</span> <span class="n">agent</span> <span class="o">=</span> <span class="n">jenkinsRule</span><span class="o">.</span><span class="na">createSlave</span><span class="o">(</span><span class="n">testingLabel</span><span class="o">);</span>
    <span class="cm">/* If you need to change the Launcher
    agent.setLauncher(new JNLPLauncher(true));
    agent.save();
    */</span>
    <span class="c1">// Connecting the agent</span>
    <span class="n">jenkinsRule</span><span class="o">.</span><span class="na">waitOnline</span><span class="o">(</span><span class="n">agent</span><span class="o">);</span>
    <span class="cm">/*
    Alternative to waitOnline would be to use the Computer object, but you must check the agent becomes
    online. Better use waitOnline

    Computer computer = agent.toComputer();
    while (!computer.isOnline()) {
      computer.connect(true);
    }
    */</span>

    <span class="nc">FreeStyleProject</span> <span class="n">freeStyleProject</span> <span class="o">=</span> <span class="n">jenkinsRule</span><span class="o">.</span><span class="na">jenkins</span><span class="o">.</span><span class="na">getItemByFullName</span><span class="o">(</span><span class="s">"my-freestyle"</span><span class="o">,</span> <span class="nc">FreeStyleProject</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">freeStyleProject</span><span class="o">.</span><span class="na">setAssignedLabel</span><span class="o">(</span><span class="n">testingLabel</span><span class="o">);</span>
    <span class="c1">// Testing the job</span>

    <span class="nc">WorkflowJob</span> <span class="n">workflowJob</span> <span class="o">=</span> <span class="n">jenkinsRule</span><span class="o">.</span><span class="na">jenkins</span><span class="o">.</span><span class="na">getItemByFullName</span><span class="o">(</span><span class="s">"my-workflow"</span><span class="o">,</span> <span class="nc">WorkflowJob</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="c1">// Testing the job</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For the pipeline, just make sure the definition uses the label set in the test.
For the example above, the pipeline might be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="n">pipeline</span> <span class="o">{</span>
  <span class="n">agent</span> <span class="o">{</span>
    <span class="n">label</span> <span class="s1">'testing'</span>
  <span class="o">}</span>

  <span class="n">stages</span> <span class="o">{</span>
    <span class="n">stage</span><span class="o">(</span><span class="s1">'Hello'</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">steps</span> <span class="o">{</span>
        <span class="n">sh</span> <span class="s1">'echo Hello world'</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The agent can be disconnected as follows using the <code>OfflineCause</code> that fits the test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><span class="n">computer</span><span class="o">.</span><span class="na">disconnect</span><span class="o">(</span><span class="k">new</span> <span class="nc">OfflineCause</span><span class="o">.</span><span class="na">IdleOfflineCause</span><span class="o">());</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enabling-security"><a class="anchor" href="#enabling-security"></a>Enabling security</h3>
<div class="paragraph">
<p>If you need a security realm for testing you can use a <code>MockAuthorizationStrategy()</code> where you can grant rights as needed for your test. In the following example everyone gets <code>READ</code> on the Jenkins instance and users <strong>alice</strong> and <strong>bob</strong> get individual rights. Using <code>LocalData</code> presets can be used if you need to setup a lot for your test.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><span class="kn">import</span> <span class="nn">com.gargoylesoftware.htmlunit.FailingHttpStatusCodeException</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Assert</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Rule</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.jvnet.hudson.test.JenkinsRule</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jvnet.hudson.test.MockAuthorizationStrategy</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyTest</span> <span class="o">{</span>

  <span class="nd">@Rule</span>
  <span class="kd">public</span> <span class="nc">JenkinsRule</span> <span class="n">j</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JenkinsRule</span><span class="o">();</span>

  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testAccess</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="c1">// create a dummy security realm</span>
    <span class="n">j</span><span class="o">.</span><span class="na">jenkins</span><span class="o">.</span><span class="na">setSecurityRealm</span><span class="o">(</span><span class="n">j</span><span class="o">.</span><span class="na">createDummySecurityRealm</span><span class="o">());</span>
    <span class="c1">// setup a MockAuthorizationStrategy</span>
    <span class="nc">MockAuthorizationStrategy</span> <span class="n">authorizationStrategy</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MockAuthorizationStrategy</span><span class="o">();</span>
    <span class="n">authorizationStrategy</span><span class="o">.</span><span class="na">grant</span><span class="o">(</span><span class="nc">Jenkins</span><span class="o">.</span><span class="na">READ</span><span class="o">).</span><span class="na">onRoot</span><span class="o">().</span><span class="na">toEveryone</span><span class="o">();</span>
    <span class="n">authorizationStrategy</span><span class="o">.</span><span class="na">grant</span><span class="o">(</span><span class="nc">Item</span><span class="o">.</span><span class="na">DISCOVER</span><span class="o">).</span><span class="na">everywhere</span><span class="o">().</span><span class="na">to</span><span class="o">(</span><span class="s">"alice"</span><span class="o">);</span>
    <span class="n">authorizationStrategy</span><span class="o">.</span><span class="na">grant</span><span class="o">(</span><span class="nc">Item</span><span class="o">.</span><span class="na">READ</span><span class="o">).</span><span class="na">everywhere</span><span class="o">().</span><span class="na">to</span><span class="o">(</span><span class="s">"bob"</span><span class="o">);</span>
    <span class="n">j</span><span class="o">.</span><span class="na">jenkins</span><span class="o">.</span><span class="na">setAuthorizationStrategy</span><span class="o">(</span><span class="n">authorizationStrategy</span><span class="o">);</span>

    <span class="c1">// create a freestyle project for test</span>
    <span class="n">j</span><span class="o">.</span><span class="na">createFreeStyleProject</span><span class="o">(</span><span class="s">"myproject"</span><span class="o">);</span>

    <span class="c1">// alice can discover project</span>
    <span class="nc">JenkinsRule</span><span class="o">.</span><span class="na">WebClient</span> <span class="n">alice</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="na">createWebClient</span><span class="o">().</span><span class="na">login</span><span class="o">(</span><span class="s">"alice"</span><span class="o">);</span>
    <span class="nc">FailingHttpStatusCodeException</span> <span class="n">e</span> <span class="o">=</span> <span class="n">assertThrows</span><span class="o">(</span><span class="nc">FailingHttpStatusCodeException</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">alice</span><span class="o">.</span><span class="na">goTo</span><span class="o">(</span><span class="s">"bypass/myproject"</span><span class="o">));</span>
    <span class="nc">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">"alice can discover"</span><span class="o">,</span> <span class="mi">403</span><span class="o">,</span> <span class="n">e</span><span class="o">.</span><span class="na">getStatusCode</span><span class="o">());</span>

    <span class="c1">// bob can read project</span>
    <span class="nc">JenkinsRule</span><span class="o">.</span><span class="na">WebClient</span> <span class="n">bob</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="na">createWebClient</span><span class="o">().</span><span class="na">login</span><span class="o">(</span><span class="s">"bob"</span><span class="o">);</span>
    <span class="n">bob</span><span class="o">.</span><span class="na">goTo</span><span class="o">(</span><span class="s">"bypass/myproject"</span><span class="o">);</span> <span class="c1">// success</span>
  <span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="verifying-logs"><a class="anchor" href="#verifying-logs"></a>Verifying Logs</h3>
<div class="paragraph">
<p>You can verify log messages using <code>@LoggerRule</code>.
This can also be useful for temporarily enabling certain loggers during interactive testing.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><span class="kn">import</span> <span class="nn">java.util.logging.Level</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Rule</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jvnet.hudson.test.LoggerRule</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">Matchers</span><span class="o">.</span><span class="na">containsString</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">junit</span><span class="o">.</span><span class="na">Assert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">jvnet</span><span class="o">.</span><span class="na">hudson</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">LoggerRule</span><span class="o">.</span><span class="na">recorded</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyTest</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="nd">@Rule</span> <span class="nc">LoggerRule</span> <span class="n">l</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">LoggerRule</span><span class="o">();</span>

  <span class="nd">@Test</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testLogs</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">l</span><span class="o">.</span><span class="na">capture</span><span class="o">(</span><span class="mi">3</span><span class="o">).</span><span class="na">record</span><span class="o">(</span><span class="s">"my.logger.name"</span><span class="o">,</span> <span class="nc">Level</span><span class="o">.</span><span class="na">ALL</span><span class="o">);</span>
    <span class="n">doThingThatLogs</span><span class="o">();</span>
    <span class="n">assertThat</span><span class="o">(</span><span class="n">l</span><span class="o">,</span> <span class="n">recorded</span><span class="o">(</span><span class="nc">Level</span><span class="o">.</span><span class="na">INFO</span><span class="o">,</span> <span class="n">containsString</span><span class="o">(</span><span class="s">"Thing started successfully"</span><span class="o">)));</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="increasing-tests-timeout"><a class="anchor" href="#increasing-tests-timeout"></a>Increasing Tests Timeout</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The default timeout for Jenkins integration tests is 180 seconds.</p>
</div>
<div class="paragraph">
<p>The tests that require more resources may fail on a slower computer.</p>
</div>
<div class="paragraph">
<p>To increase the timeout of the tests you can use the following commands:
<code>mvn -Djenkins.test.timeout=250 verify</code></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="performance-testing"><a class="anchor" href="#performance-testing"></a>Performance Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Starting from <a href="https://github.com/jenkinsci/jenkins-test-harness/releases/tag/jenkins-test-harness-2.50">Jenkins Test Harness 2.50</a>, the framework provides ways to run microbenchmarks using
<a href="https://openjdk.java.net/projects/code-tools/jmh/">Java Microbenchmark Harness</a>.</p>
</div>
<div class="paragraph">
<p>To use them in your plugin, please find documentation here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="/blog/2019/06/21/performance-testing-jenkins/">Blog post on running benchmarks</a></p>
</li>
<li>
<p><a href="https://github.com/jenkinsci/jenkins-test-harness/blob/master/docs/jmh-benchmarks.adoc">Creating Benchmarks</a></p>
</li>
<li>
<p><a href="https://github.com/jenkinsci/configuration-as-code-plugin/blob/master/docs/benchmarks/jmh-benchmarks.md">Using Configuration As Code to setup benchmarks</a></p>
</li>
<li>
<p><a href="https://github.com/jenkinsci/plugin-pom#running-benchmarks">Maven profile that runs benchmarks</a></p>
</li>
<li>
<p><a href="https://github.com/jenkins-infra/pipeline-library#runbenchmarks">Running benchmark through Jenkinsfile</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="further-pipeline-testing"><a class="anchor" href="#further-pipeline-testing"></a>Further Pipeline Testing</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="testing-durable-pipeline-steps"><a class="anchor" href="#testing-durable-pipeline-steps"></a>Testing Durable Pipeline Steps</h3>
<div class="paragraph">
<p>TODO: RestartableJenkinsRule.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="further-patterns"><a class="anchor" href="#further-patterns"></a>Further Patterns</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="custom-builder"><a class="anchor" href="#custom-builder"></a>Custom builder</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="advanced-and-tips-etc"><a class="anchor" href="#advanced-and-tips-etc"></a>Advanced and Tips etc.</h2>
<div class="sectionbody">

</div>
</div>

<h2>
References
</h2>
<ul>
<li><a href="https://wiki.jenkins.io/display/JENKINS/Mocking+in+Unit+Tests">Wiki: Mocking in Unit Tests</a></li>
<li><a href="https://wiki.jenkins.io/display/JENKINS/Unit+Test+on+Windows">Wiki: Unit Testing on Windows</a></li>
<li><a href="https://javadoc.jenkins.io/component/jenkins-test-harness/">Jenkins Test Harness Javadoc</a></li>
<li><a href="https://github.com/jenkinsci/acceptance-test-harness">Acceptance Test Harness</a></li>
</ul>
</div>
</div>
</div>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//doc/developer/testing/index.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
