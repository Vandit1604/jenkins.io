<!DOCTYPE html>
<html lang="en">
<head>
<title>
Securing your Jenkins CI/CD Container Pipeline with Anchore (in under 10 minutes)
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2018/06/20/anchore-image-scanning/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="Securing your Jenkins CI/CD Container Pipeline with Anchore (in under 10 minutes)" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Securing your Jenkins CI/CD Container Pipeline with Anchore (in under 10 minutes)" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Securing your Jenkins CI/CD Container Pipeline with Anchore (in under 10 minutes)" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2018/06/20/anchore-image-scanning/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="Securing your Jenkins CI/CD Container Pipeline with Anchore (in under 10 minutes)" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.app-post-page h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<article class="container app-post-page">
<div class="app-!-display-flex">
<a class="app-back-link" href="/jenkins.io/independent-scrolling-patch/node/">
Back to blog
</a>
</div>
<h1>
Securing your Jenkins CI/CD Container Pipeline with Anchore (in under 10 minutes)
</h1>
<div class="post-attrs">
<a class="app-author-link" href="/blog/authors/michaelneale/"><div class="app-avatar"><img alt="Michael Neale" class="app-avatar__image" src="/images/avatars/michaelneale.jpg"></div> Michael Neale</a>
June 20, 2018
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/intent/tweet?text=Securing+your+Jenkins+CI%2FCD+Container+Pipeline+with+Anchore+%28in+under+10+minutes%29&amp;url=https%3A%2F%2Fwww.jenkins.io%2Fjenkins.io%2Findependent-scrolling-patch%2Fblog%2F2018%2F06%2F20%2Fanchore-image-scanning%2F" rel="noreferrer nofollow" target="_blank">
Tweet
</a>
</div>
<div class="blog-content">
<div class="paragraph">
<p>(adapted from this <a href="https://anchore.com/blog/securing-jenkins-cicd-container-pipeline-anchore-10-minutes/">blog post</a> by Daniel Nurmi)</p>
</div>
<div class="paragraph">
<p>As more and more Jenkins users ship docker containers, it is worth thinking about the security implications of this model, where the variance in software being included by developers has increased dramatically from previous models. Security implications in this context include what makes up the image, but also the components of the app that get bundled into your image. Docker images are increasingly becoming a “unit of deployment”, and if you look at a typical app (especially if it is a microservice), much of the components, libraries, and system are someone else’s code.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/anchore/anchore-engine">Anchore</a> exists to provide technology to act as a last line of defense, verifying the contents of these new deployable units against user specified policies to enforce security and compliance requirements. In this blog you will get a quick tour of this capability, and how to add the open-source Anchore Engine API service into your pipeline to validate that the flow of images you are shipping comply with your specific requirements, from a security point of view.</p>
</div>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/2018-06-15-anchore/anchore-pipeline.png" alt="anchore pipeline" width="350" title="Sample Failure"></span></p>
</div>
<div class="paragraph">
<p>Key among the fundamental tenets of agile development is the notion of “fail fast, fail often”, which is where CI/CD comes in: A developer commits code into the source code repository, such as git, that automatically triggers Jenkins to perform a build of the application that is then run through automated tests. If these tests fail the developer is notified immediately and can quickly correct the code. This level of automation increases the overall quality of code and speeds development.</p>
</div>
<div class="paragraph">
<p>While some may feel that “fail fast” sounds rather negative (especially regarding security), you could better describe this process as “learn fast” as mistakes are found earlier in the development cycle and can be easily corrected. The increased use of CI/CD platforms such as Jenkins has helped to improve the efficiency of development teams and streamlined the testing process. We can leverage the same CI/CD infrastructure to improve the security of our container deployments.</p>
</div>
<div class="paragraph">
<p>For many organizations the last step before deploying an application is for the security team to perform an audit. This may entail scanning the image for vulnerable software components (like outdated packages that contain known security vulnerabilities) and verifying that the applications and OS are correctly configured. They may also check that the organization’s best practices and compliance policies have been correctly implemented.</p>
</div>
<div class="paragraph">
<p>In this post we walk through adding security and compliance checking into the CI/CD process so you can “learn fast” and correct any security or compliance issues early in the development cycle. This document will outline the steps to deploy Anchore’s open source security and compliance scanning engine with Jenkins to add analytics, compliance and governance to your CI/CD pipeline.</p>
</div>
<div class="paragraph">
<p>Anchore has been designed to plug seamlessly into the CI/CD workflow, where a developer commits code into the source code management system, which then triggers Jenkins to start a build that creates a container image. In the typical workflow this container image is then run through automated testing. If an image does not meet your organization’s requirements for security or compliance then it makes little sense to invest the time required to perform automated tests on the image, it would be better to “learn fast” by failing the build and returning the appropriate reports back to the developer to allow the issue to be addressed.</p>
</div>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/2018-06-15-anchore/anchore-flow.png" alt="anchore flow" width="600" title="Anchore process"></span></p>
</div>
<div class="paragraph">
<p>Anchore has published a <a href="https://plugins.jenkins.io/anchore-container-scanner">plugin</a> for Jenkins which, along with Anchore’s open source engine or Enterprise offering, allows container analysis and governance to be added quickly into the CI/CD process.</p>
</div>
<div class="sect2">
<h3 id="requirements"><a class="anchor" href="#requirements"></a>Requirements</h3>
<div class="paragraph">
<p>This guide presumes the following prerequisites have been met:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Jenkins 2.x installed and running on a virtual machine or physical server.</p>
</li>
<li>
<p>Anchore-Engine installed and running, with accessible engine API URL (later referred to as &lt;anchore_url&gt;) and credentials (later referred to as &lt;anchore_user&gt; and &lt;anchore_pass&gt;) available - see <a href="https://anchore.freshdesk.com/support/home">Anchore Engine overview and installation</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Anchore’s Jenkins plugin can work with single node installations or installations with multiple worker nodes.</p>
</div>
</div>
<div class="sect2">
<h3 id="step-1-install-the-anchore-plugin"><a class="anchor" href="#step-1-install-the-anchore-plugin"></a>Step 1: Install the Anchore plugin</h3>
<div class="paragraph">
<p>The Anchore plugin has been published in the Jenkins plugin registry and is available for installation on any Jenkins server. From the main Jenkins menu select <em>Manage Jenkins</em>, then <em>Manage Plugins</em>, select the Available tab, select and install <em>Anchore Container Image Scanner</em>.</p>
</div>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/2018-06-15-anchore/installing.png" alt="installing" width="500" title="installation"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="step-2-configure-anchore-plugin"><a class="anchor" href="#step-2-configure-anchore-plugin"></a>Step 2: Configure Anchore Plugin.</h3>
<div class="paragraph">
<p>Once the Anchore Container Image Scanner plugin is installed - select <em>Manage Jenkins</em> menu click <em>Configure System</em>, and locate the <em>Anchore Configuration</em> section.  Select and enter the following parameters in this section:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click Enable Anchore Scanning</p>
</li>
<li>
<p>Select Engine Mode</p>
</li>
<li>
<p>Enter your &lt;anchore_url&gt; in the Engine URL text box - for example: <a href="http://your-anchore-engine.com:8228/v1" class="bare">http://your-anchore-engine.com:8228/v1</a></p>
</li>
<li>
<p>Enter your &lt;anchore_user&gt; and &lt;anchore_pass&gt; in the Engine Username and Engine Password fields, respectively</p>
</li>
<li>
<p>Click Save</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example of a filled out configuration section is below, where we’ve used “http://192.168.1.3:8228/v1” as &lt;anchore_url&gt;, “admin” as &lt;anchore_user&gt; and “foobar” as &lt;anchore_pass&gt;:</p>
</div>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/2018-06-15-anchore/config.png" alt="config" width="500" title="configuration"></span></p>
</div>
<div class="paragraph">
<p>At this point the Anchore plugin is configured on Jenkins, and is available to be accessed by any project to perform Anchore security and policy checks as part of your container image build pipeline.</p>
</div>
</div>
<div class="sect2">
<h3 id="step-3-add-anchore-image-scanning-to-a-pipeline-build"><a class="anchor" href="#step-3-add-anchore-image-scanning-to-a-pipeline-build"></a>Step 3: Add Anchore image scanning to a pipeline build.</h3>
<div class="paragraph">
<p>In the Pipeline model the entire build process is defined as code. This code can be created, edited and managed in the same way as any other artifact of your software project, or input via the Jenkins UI.</p>
</div>
<div class="paragraph">
<p>Pipeline builds can be more complex including forks/joins and parallelism. The pipeline is more resilient and can survive the controller node failure and restarts. To add an Anchore scan you need to add a simple code snippet to any existing pipeline code that first builds an image and pushes it to a docker registry. Once the image is available in a registry accessible by your installed Anchore Engine, a pipeline script will instruct the Anchore plugin to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Send an API call to the Anchore Engine to add the image for analysis</p>
</li>
<li>
<p>Wait for analysis of the image to complete by polling the engine</p>
</li>
<li>
<p>Send an API call to the Anchore Engine service to perform a policy evaluation</p>
</li>
<li>
<p>Retrieve the evaluation result and potentially fail the build if the plugin is configured to fail the build on policy evaluation STOP result (by default it will)</p>
</li>
<li>
<p>Provide a report of the policy evaluation for review</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Below is an example end-to-end script that will make a Dockerfile, use the docker plugin to build and push the a docker container image to dockerhub, perform an Anchore image analysis on the image and the result, and cleanup the built container.  In this example, we’re using a pre-configured <code>docker-exampleuser</code> named dockerhub credential for dockerhub access, and <code>exampleuser/examplerepo:latest</code> as the image to build and push.  These values would need to be changed to reflect your own local settings, or you can use the below example to extract the <code>analyze</code> stage to integrate an anchore scan into any pre-existing pipeline script, any time after a container image is built and is available in a docker registry that your anchore-engine service can access.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code>pipeline {
    agent any
    stages {
        stage('build') {
            steps {
                sh'''
                    echo 'FROM debian:latest’ &gt; Dockerfile
                    echo ‘CMD ["/bin/echo", "HELLO WORLD...."]' &gt;&gt; Dockerfile
                '''
                script {
                    docker.withRegistry('https://index.docker.io/v1/', 'docker-exampleuser') {
                        def image = docker.build('exampleuser/examplerepo:latest')
                        image.push()
                    }
                }
            }
        }
        stage('analyze') {
            steps {
                sh 'echo "docker.io/exampleuser/examplerepo:latest `pwd`/Dockerfile" &gt; anchore_images'
                anchore name: 'anchore_images'
            }
        }
        stage('teardown') {
            steps {
                sh'''
                    for i in `cat anchore_images | awk '{print $1}'`;do docker rmi $i; done
                '''
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code snippet writes out the anchore_images file that is read by the plugin to determine which image is to be added to Anchore Engine for scanning.</p>
</div>
<div class="paragraph">
<p>This code snippet can be crafted by hand or built using the Jenkins UI, for any <em>Pipeline</em> project. In the project configuration, select <em>Pipeline Syntax</em> from the Project.</p>
</div>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/2018-06-15-anchore/pipe1.png" alt="pipe1" width="600" title="pipe editor"></span></p>
</div>
<div class="paragraph">
<p>This will launch the <em>Snippet Generator</em> where you can enter the available plugin parameters and press the <em>Generate Pipeline Script</em> button which will produce a snippet that you can use as a starting point.</p>
</div>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/2018-06-15-anchore/snippet.png" alt="snippet" width="600" title="snippet"></span></p>
</div>
<div class="paragraph">
<p>Using our example from above, next we save the project:</p>
</div>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/2018-06-15-anchore/pipe2.png" alt="pipe2" width="600" title="pipeline script"></span></p>
</div>
<div class="paragraph">
<p>Note that once you are happy with your script, you could also check it into a <code>Jenkinsfile</code>, alongside the source code.</p>
</div>
</div>
<div class="sect2">
<h3 id="step-4-run-the-build-and-review-the-results"><a class="anchor" href="#step-4-run-the-build-and-review-the-results"></a>Step 4: Run the build and review the results.</h3>
<div class="paragraph">
<p>Finally, we run the build, which will generate a report.  In the below screenshots, we’ve scanned the image <code>docker.io/library/debian:latest</code> to demonstrate some example results.  Once the build completes, the final build report will have some links that will take you to a page that describes the result of the Anchore Engine policy evaluation and security scan:</p>
</div>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/2018-06-15-anchore/result.png" alt="result" width="500" title="result"></span></p>
</div>
<div class="paragraph">
<p>In this case, since we left the <em>Fail build on policy STOP</em> result as its default (True), the build has failed due to anchore-engine reporting a policy violation.  In order to see the results, click the <em>Anchore Report (STOP)</em> link:</p>
</div>
<div class="paragraph">
<p><span class="image center"><img src="/images/post-images/2018-06-15-anchore/report.png" alt="report" width="500" title="report"></span></p>
</div>
<div class="paragraph">
<p>Here, we can see that there is a single policy check that has generated a ‘STOP’ action, which triggered due to a high severity vulnerability being found against a package installed in the image.  If there were only ‘WARN’ or ‘GO‘ check results here, they would also be displayed, but the build would have succeeded.</p>
</div>
<div class="paragraph">
<p>With the combination of Jenkins pipeline project capabilities, plus the Anchore scanner plugin, it’s quick and easy to add container image security scanning and policy checking to your Jenkins project.  In this example, we provide the mechanism for adding scanning to a Jenkins pipeline project using a simple policy that is doing an OS package vulnerability scan, but there are many more policy options that can be configured and loaded into Anchore Engine ranging from security checks to your own site-specific best practice checks (software licenses, package whitelist/blacklist, dockerfile checks, and many more).  For more information about the breadth of Anchore policies, you can find information about Anchore Engine configuration and usage <a href="https://anchore.freshdesk.com/support/home">here</a>.</p>
</div>
<div class="paragraph">
<p>For more information on Jenkins Pipelines and Anchore Engine, check out the following information sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://anchore.com/" class="bare">https://anchore.com/</a></p>
</li>
<li>
<p><a href="https://anchore.com/opensource/" class="bare">https://anchore.com/opensource/</a></p>
</li>
<li>
<p><a href="https://github.com/anchore/anchore-engine" class="bare">https://github.com/anchore/anchore-engine</a></p>
</li>
<li>
<p><a href="https://anchore.freshdesk.com/support/home" class="bare">https://anchore.freshdesk.com/support/home</a></p>
</li>
<li>
<p><a href="https://anchore.com/opensource/#slack">Chat on Anchore open source slack</a></p>
</li>
</ul>
</div>
</div>
</div>
<ul class="app-tags">
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/community/">
community
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/developer/">
developer
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/security/">
security
</a>
</li>
</ul>
<h2>
About the author
</h2>
<!-- starting partial author.html.haml -->
<div class="app-author" id="about-the-author">
<!-- starting partial avatar.html.haml -->
<div class="app-avatar" style="min-width: 64px; width: 25vw; max-width: 128px">
<img alt="Michael Neale" class="app-avatar__image" src="/jenkins.io/independent-scrolling-patch/images/avatars/michaelneale.jpg">
</div>

<!-- ending partial avatar.html.haml -->
<div class="app-author__content">
<p class="app-author__name">
<a href="/blog/authors/michaelneale/">
Michael Neale
</a>
</p>
<div class="paragraph">
<p>Michael is a CD enthusiast with a interest in User Experience.
He is a co-founder of CloudBees and a long time OSS developer, and can often be found
lurking around the jenkins-dev mailing list or #jenkins on irc (same nick as twitter name).
Before CloudBees he worked at Red Hat.</p>
</div>
<!-- starting partial social-media-buttons.html.haml -->
<ul class="app-social-media-buttons">
<li>
<a href="https://github.com/michaelneale" rel="noreferrer noopener" target="_blank">
GitHub
</a>
</li>
<li>
<a href="https://twitter.com/michaelneale" rel="noreferrer noopener" target="_blank">
Twitter
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</div>
</div>

<!-- ending partial author.html.haml -->
<!-- starting partial discuss.html.haml -->

<!-- ending partial discuss.html.haml -->
</article>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//blog/2018/06/2018-06-20-anchore-image-scanning.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
