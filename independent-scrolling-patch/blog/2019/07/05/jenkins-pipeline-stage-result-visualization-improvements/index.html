<!DOCTYPE html>
<html lang="en">
<head>
<title>
Jenkins Pipeline Stage Result Visualization Improvements
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2019/07/05/jenkins-pipeline-stage-result-visualization-improvements/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="Jenkins Pipeline Stage Result Visualization Improvements" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Jenkins Pipeline Stage Result Visualization Improvements" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Jenkins Pipeline Stage Result Visualization Improvements" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/blog/2019/07/05/jenkins-pipeline-stage-result-visualization-improvements/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="Jenkins Pipeline Stage Result Visualization Improvements" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.app-post-page h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<article class="container app-post-page">
<div class="app-!-display-flex">
<a class="app-back-link" href="/jenkins.io/independent-scrolling-patch/node/">
Back to blog
</a>
</div>
<h1>
Jenkins Pipeline Stage Result Visualization Improvements
</h1>
<div class="post-attrs">
<a class="app-author-link" href="/blog/authors/dwnusbaum/"><div class="app-avatar"></div> Devin Nusbaum</a>
July 05, 2019
<a class="twitter-share-button" data-lang="en" href="https://twitter.com/intent/tweet?text=Jenkins+Pipeline+Stage+Result+Visualization+Improvements&amp;url=https%3A%2F%2Fwww.jenkins.io%2Fjenkins.io%2Findependent-scrolling-patch%2Fblog%2F2019%2F07%2F05%2Fjenkins-pipeline-stage-result-visualization-improvements%2F" rel="noreferrer nofollow" target="_blank">
Tweet
</a>
</div>
<div class="blog-content">
<div class="paragraph">
<p>Some changes have recently been released to give Pipeline authors some new tools to improve Pipeline visualizations in Blue Ocean, in particular to address the highly-voted issue <a href="https://issues.jenkins.io/browse/JENKINS-39203">JENKINS-39203</a>, which causes all non-failing stages to be visualized as though they were unstable if the overall build result of the Pipeline was unstable. This issue made it difficult to quickly identify why a build was unstable, and forced users to read through builds logs and the Jenkinsfile to figure out what actually happened.</p>
</div>
<div class="paragraph">
<p>In order to fix this issue, we introduced a new Pipeline API that can be used to attach additional result information to individual Pipeline steps. Visualization tools like Blue Ocean use this new API when deciding how a given stage should be displayed. Steps like <code>junit</code> that used to set only the overall build result now additionally use the new API to set step-level result information. We created the new <code>unstable</code> and <code>warnError</code> steps so that Pipeline authors with more complicated use cases can still take advantage of this new API.</p>
</div>
<div class="paragraph">
<p>The core fixes for the issue are present in the following plugins, all of which require Jenkins 2.138.4 or newer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pipeline: API 2.34</p>
</li>
<li>
<p>Pipeline: Basic Steps 2.18 (requires a simultaneous update to Pipeline: Groovy 2.70)</p>
</li>
<li>
<p>Pipeline: Graph Analysis 1.10</p>
</li>
<li>
<p>Pipeline: Declarative 1.3.9</p>
</li>
<li>
<p>Blue Ocean 1.17.0</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is a screenshot from Blue Ocean of a Pipeline using the <code>unstable</code> step where only the failing stage is marked as unstable:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/post-images/2019/07/2019-07-05-jenkins-pipeline-stage-result-visualization-improvements/unstable-stage-example.png" alt="Visualization of a Pipeline in Blue Ocean with a single stage shown as unstable">
</div>
</div>
<div class="sect1">
<h2 id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here are some examples of how to update your Pipelines to use the new improvements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Use the new <a href="/doc/pipeline/steps/workflow-basic-steps/#warnerror-catch-error-and-set-build-and-stage-result-to-unstable"><code>warnError</code></a> step to catch errors and mark the build and stage as unstable.</strong> <code>warnError</code> requires a single <code>String</code> parameter, which is a message to log when an error is caught. When <code>warnError</code> catches an error, it logs the message  and the error and sets the build and stage result to unstable. Using it looks like this:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="n">warnError</span><span class="o">(</span><span class="s1">'Script failed!'</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">sh</span><span class="o">(</span><span class="s1">'false'</span><span class="o">)</span>
<span class="o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong>Use the new <a href="/doc/pipeline/steps/workflow-basic-steps/#unstable-set-stage-result-to-unstable"><code>unstable</code></a> step to set the build and stage result to unstable</strong>. This step can be used as a direct replacement for <code>currentBuild.result = 'UNSTABLE'</code>, and may be useful in cases where <code>warnError</code> is not flexible enough. <code>unstable</code> requires a single <code>String</code> parameter, which is a message to log when the step runs. Using it might look like this:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="groovy"><span class="k">try</span> <span class="o">{</span>
  <span class="n">sh</span><span class="o">(</span><span class="s1">'false'</span><span class="o">)</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">unstable</span><span class="o">(</span><span class="s1">'Script failed!'</span><span class="o">)</span>
<span class="o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p><strong><a href="https://plugins.jenkins.io/junit">JUnit Plugin</a></strong>: Update to version 1.28 or newer to pick up fixes for the <code>junit</code> step so that it correctly marks the stage as unstable.</p>
</li>
<li>
<p><strong><a href="https://plugins.jenkins.io/warnings-ng">Warnings Next Generation Plugin</a></strong>: Update to version 5.2.0 or newer to pick up fixes for the <code>publishIssues</code> and <code>recordIssues</code> steps so that they correctly mark the stage as unstable.</p>
</li>
<li>
<p><strong>Other Plugins</strong>: If your Pipeline is marked as unstable by a step in another plugin, please <a href="https://issues.jenkins.io">file a new issue</a> with the component set to that plugin (after checking for duplicates), clearly describing which step has the problem and under what circumstances it occurs, and link to the developer section of this post as a reference for how the maintainer might be able to address the problem.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="limitations"><a class="anchor" href="#limitations"></a>Limitations</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>If you do not migrate to the <code>unstable</code> or <code>warnError</code> steps, or update plugins that set the build result to versions that integrate with the new API, then in cases where the build is unstable, Blue Ocean will not show any stages as unstable.</p>
</li>
<li>
<p>Even after these changes, <code>currentBuild.result</code> continues to refer only to the overall build result. Unfortunately, it was not possible to adapt the <code>currentBuild</code> global variable to make it track step or stage-level results, since it is implemented as a global variable, which means it does not have any step-level context through which it could use the new API.</p>
</li>
<li>
<p><a href="https://plugins.jenkins.io/pipeline-stage-view">Pipeline Stage View Plugin</a> has not yet been updated to use the new API, so these changes do not affect the visualization it provides.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="history"><a class="anchor" href="#history"></a>History</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Jenkins Pipeline steps can complete in one of two ways: successfully, by returning a (possibly null) result, or unsuccessfully, by throwing an exception. When a step fails by throwing an exception, that exception propagates throughout the Pipeline until another step or Groovy code catches it, or it reaches the top level of the Pipeline, which causes the Pipeline itself to fail. Depending on the type of exception thrown, the final result of the Pipeline may be something other than failure (for example in some cases it will be aborted). Because of the way the exception propagates, it is easy for tools like Blue Ocean to identify steps (and therefore stages) which failed due to an exception.</p>
</div>
<div class="paragraph">
<p>In order for Pipelines to be able to interact with established Jenkins APIs, it was also necessary for Pipeline builds to have an overall build result that can be modified during the build. Among other things, this allows Pipelines to use build steps and wrappers that were originally written for use in Freestyle projects.</p>
</div>
<div class="paragraph">
<p>In some cases, it is desirable for a Pipeline step to be able to complete successfully so that the rest of the Pipeline continues normal execution, but for it to be able to note that some kind of error occurred so that visualizations are able to identify that something went wrong with the step, even though it didn&#8217;t fail completely. A good example of this is the <code>junit</code> step. This step looks at specified test results, and if there were any failures, marks the overall build result as unstable. This kind of behavior is problematic for visualization tools like Blue Ocean, because the step completed successfully, and there is no programmatic way to associate the overall build result with the step that ended up setting that result.</p>
</div>
<div class="paragraph">
<p>Looking at <a href="https://issues.jenkins.io/browse/JENKINS-39203">JENKINS-39203</a> again, we see that there were essentially two options for the visualization. If the overall build result was unstable, either all steps that completed successfully could be shown as unstable, because they may have been the step that caused the build to become unstable, or they could be shown as successful, because we have no way to relate the setting of the build result to a specific step. In the end, the first option was chosen.</p>
</div>
<div class="paragraph">
<p>To work around this issue, some users tried to do things like throw exceptions and add try/catch blocks around stages that handle exceptions so that Blue Ocean would be able to use the exceptions to mark step and stage results as desired, and then by catching the exception the Pipeline would be able to continue normal execution. These kinds of workarounds were hard to understand, fragile, and did not work well (if at all) for Declarative Pipelines.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="developers"><a class="anchor" href="#developers"></a>Developers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you are a developer of a plugin that integrates with Pipeline using a step, and want to take advantage of the new API so that your step can report an non-successful result without throwing an exception, please see <a href="https://groups.google.com/d/msg/jenkinsci-dev/5A7U1KmfX08/IP5Bg_OaAgAJ">this post</a> to the Jenkins Developers mailing list, and respond there if you have any questions.</p>
</div>
</div>
</div>
</div>
<ul class="app-tags">
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/pipeline/">
pipeline
</a>
</li>
<li>
<a class="app-tags__tag" href="/jenkins.io/independent-scrolling-patch/node/tags/blueocean/">
blueocean
</a>
</li>
</ul>
<h2>
About the author
</h2>
<!-- starting partial author.html.haml -->
<div class="app-author" id="about-the-author">
<!-- starting partial avatar.html.haml -->
<div class="app-avatar" style="min-width: 64px; width: 25vw; max-width: 128px"></div>

<!-- ending partial avatar.html.haml -->
<div class="app-author__content">
<p class="app-author__name">
<a href="/blog/authors/dwnusbaum/">
Devin Nusbaum
</a>
</p>
<div class="paragraph">
<p>Devin has worked on various areas of Jenkins for the past two years as a software engineer at CloudBees. He is currently a maintainer of core Jenkins Pipeline plugins and also works on Jenkins X Pipeline.</p>
</div>
<!-- starting partial social-media-buttons.html.haml -->
<ul class="app-social-media-buttons">
<li>
<a href="https://github.com/dwnusbaum" rel="noreferrer noopener" target="_blank">
GitHub
</a>
</li>
</ul>

<!-- ending partial social-media-buttons.html.haml -->
</div>
</div>

<!-- ending partial author.html.haml -->
<!-- starting partial discuss.html.haml -->

<!-- ending partial discuss.html.haml -->
</article>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//blog/2019/07/2019-07-05-jenkins-pipeline-stage-result-visualization-improvements.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
