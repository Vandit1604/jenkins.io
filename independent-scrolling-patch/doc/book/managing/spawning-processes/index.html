<!DOCTYPE html>
<html lang="en">
<head>
<title>
Spawning Processes From Build
</title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="description">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="ie=edge" http-equiv="x-ua-compatible">
<link href="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/doc/book/managing/spawning-processes/" rel="canonical">
<!-- Favicons -->
<link href="/favicon.ico" rel="shortcut icon" type="image/x-icon">
<link href="/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180">
<link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png">
<link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png">
<link href="/site.webmanifest" rel="manifest">
<link color="#5bbad5" href="/safari-pinned-tab.svg" rel="mask-icon">
<meta content="#2b5797" name="msapplication-TileColor">
<meta content="#ffffff" name="theme-color">
<meta content="Spawning Processes From Build" name="apple-mobile-web-app-title">
<!-- Twitter Card data -->
<meta content="summary_large_image" name="twitter:card">
<meta content="@JenkinsCI" name="twitter:site">
<meta content="Spawning Processes From Build" name="twitter:title">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="twitter:description">
<meta content="@JenkinsCI" name="twitter:creator">
<!-- Twitter Summary card images must be at least 120x120px -->
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="twitter:image">
<!-- Open Graph data -->
<meta content="Spawning Processes From Build" property="og:title">
<meta content="article" property="og:type">
<meta content="https://Vandit1604.github.io/jenkins.io/independent-scrolling-patch/doc/book/managing/spawning-processes/" property="og:url">
<meta content="Jenkins – an open source automation server which enables developers around the world to reliably build, test, and deploy their software" name="og:description">
<meta content="Spawning Processes From Build" property="og:site_name">
<meta content="/jenkins.io/independent-scrolling-patch/images/logo-title-opengraph.png" name="og:image">
<link href="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/css/bootstrap.min.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/jenkins.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/stylesheets/styles.css" media="screen" rel="stylesheet">
<!-- Non-obtrusive CSS styles -->
<link href="/jenkins.io/independent-scrolling-patch/css/footer.css" media="screen" rel="stylesheet">
<link href="/jenkins.io/independent-scrolling-patch/css/font-awesome.min.css" media="screen" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@docsearch/css@3" rel="stylesheet">
</head>
<body>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/jquery/jquery.min.js"></script>
<!-- starting partial toptoolbar.html.haml -->
<jio-navbar class="fixed-top" id="ji-toolbar" property="https://www.jenkins.io" showSearchBox=""></jio-navbar>
<!-- Spacing to make the fixed-top sticky navbar not occlude any content below it -->
<div class="pt-4">
&nbsp;
</div>

<!-- ending partial toptoolbar.html.haml -->
<!-- starting partial anchors.html.haml -->
<script>
  window.addEventListener('DOMContentLoaded', function () {
    for (var i = 1 ; i <= 6 ; i ++) {
      anchors.add('.container .row .col-lg-9 h' + i);
    }
  })
</script>

<!-- ending partial anchors.html.haml -->
<div class="container">
<div class="row body flex-lg-nowrap">
<div class="col-lg-3" id="sidebar-menu">
<div class="sidebar-nav tour" id="sidebar-content">
<p>
<a href="/jenkins.io/independent-scrolling-patch/doc/" class="">> User Documentation Home</a>
</p>
<h5>
User Handbook
</h5>
<ul>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/getting-started/" class="">User Handbook Overview</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/installing/" class="">Installing Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/using/" class="">Using Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/" class="">Pipeline</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/blueocean/" class="">Blue Ocean</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/" class="active">Managing Jenkins</a>
<small>
<ul style="padding-left: 1rem;">
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/system-configuration/" class="">Configuring the System</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/casc/" class="">Configuration as Code</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/tools/" class="">Managing Tools</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/plugins/" class="">Managing Plugins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/about-jenkins/" class="">About Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/system-info/" class="">System Information</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/system-properties/" class="">Jenkins Features Controlled with System Properties</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/change-system-timezone/" class="">Change System Time Zone</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/cli/" class="">Jenkins CLI</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/script-console/" class="">Script Console</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/groovy-hook-scripts/" class="">Groovy Hook Scripts</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/nodes/" class="">Managing Nodes</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/script-approval/" class="">In-process Script Approval</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/users/" class="">Manage Users</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/ui-themes/" class="">Themes for user interface</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/user-content/" class="">User Content</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/managing/spawning-processes/" class="active">Spawning Processes From Build</a>
</li>
</ul>
</small>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/security/" class="">Securing Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/system-administration/" class="">System Administration</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/scaling/" class="">Scaling Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/troubleshooting/" class="">Troubleshooting Jenkins</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/glossary/" class="">Glossary</a>
</li>
</ul>
<h5>
Tutorials
</h5>
<ul>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/pipeline/tour/getting-started/" class="">Guided Tour</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/tutorials#pipeline" class="">Jenkins Pipeline</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/tutorials#tools" class="">Using Build Tools</a>
</li>
</ul>
<h5>
Resources
</h5>
<ul>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/book/pipeline/syntax/" class="">Pipeline Syntax reference</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/pipeline/steps/" class="">Pipeline Steps reference</a>
</li>
<li>
<a href="/jenkins.io/independent-scrolling-patch/doc/upgrade-guide/" class="">LTS Upgrade guides</a>
</li>
</ul>
</div>
</div>
<div class="col-lg-9">
<div>
<div class="row">
<div class="col-md-4">
<a class="prev doc-page-link" href="../user-content">
⇐ User Content
</a>
</div>
<div class="col-md-4">
<a class="up doc-page-link" href="../">
⇑ Managing Jenkins
</a>
<a class="index doc-page-link" href="../../">
Index
</a>
</div>
<div class="col-md-4">
<a class="next doc-page-link" href="../../security">
Securing Jenkins ⇒
</a>
</div>
</div>
</div>
<div>
<div class="row body">
<div class="section">
<h1>
Spawning Processes From Build
</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#why">Why?</a></li>
<li><a href="#workarounds">Workarounds</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>It is possible to spawn a process from a build and have that process live longer than the build itself.
For example, perhaps the build launches a new application server with the result of the build.
In older releases, the build often did not terminate.
Instead, the specific step (such as the shell script, Ant, or Maven) terminates
but the build itself does not terminate.</p>
</div>
<div class="paragraph">
<p>Jenkins detects this situation and, instead of blocking indefinitely,  prints out a warning and terminates the build.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="why"><a class="anchor" href="#why"></a>Why?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This happens because of how file descriptors are used between processes in a build.
Jenkins and the child process are connected by three pipes (<code>stdin</code>, <code>stdout</code>, and <code>stderr</code>.)
This allows Jenkins to capture the output from the child process.
The child process may write a lot of data to the pipe and quit immediately after that, so Jenkins waits for end-of-file (EOF) to be sure that it has drained the pipes before it terminates the build.</p>
</div>
<div class="paragraph">
<p>Whenever a process terminates, the operating system closes all the file descriptors it owned. So, even if the process did not close <code>stdout</code> and <code>stderr</code>, Jenkins gets end of file (EOF).</p>
</div>
<div class="paragraph">
<p>The complication happens when those file descriptors are inherited by other processes.
Let&#8217;s say the child process forks another process to the background.
The background process (which is actually a daemon) inherits all the file descriptors of the parent, including the writing side of the <code>stdout</code> ad <code>stderr</code> pipes that connect the child process and Jenkins.
If the daemon forgets to close them, Jenkins does not get EOF for pipes even when the child process exits, because the daemon still has those descriptors open.
This is how this problem happens.</p>
</div>
<div class="paragraph">
<p>A daemon should close all file descriptors to avoid such issues but some daemons do not follow the rule.
You can mitigate this problem with various workarounds.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="workarounds"><a class="anchor" href="#workarounds"></a>Workarounds</h2>
<div class="sectionbody">
<div class="paragraph">
<p>On Unix, you can use a wrapper like <a href="http://www.clapper.org/software/daemonize/">this</a> to make the daemon behave.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">daemonize -E BUILD_ID=dontKillMe /path/to/your/command</pre>
</div>
</div>
<div class="paragraph">
<p>In a Jenkins Pipeline, use <code>JENKINS_NODE_COOKIE</code> instead of <code>BUILD_ID</code>.</p>
</div>
<div class="paragraph">
<p>Note that this will set the BUILD_ID environment variable for the process being spawned to something other than the current BUILD_ID.
Or you can start jenkins with <code>-Dhudson.util.ProcessTree.disable=true</code> - see <a href="/doc/book/using/long-running-agent-process">long running agent process</a> for details.</p>
</div>
<div class="paragraph">
<p>On Windows, use the <a href="http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/ntcmds.mspx?mfr=true">'at' command</a> to launch a process in the background.
For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;scriptdef name="get-next-minute" language="beanshell"&gt;
  &lt;attribute name="property" /&gt;

  date = new java.text.SimpleDateFormat("HH:mm")
    .format(new Date(System.currentTimeMillis() + 60000));
  project.setProperty(attributes.get("property"), date);
&lt;/scriptdef&gt;

&lt;get-next-minute property="next-minute" /&gt;
&lt;exec executable="at"&gt;
  &lt;arg value="${next-minute}" /&gt;
  &lt;arg value="/interactive" /&gt;
  &lt;arg value="${jboss.home}\bin\run.bat" /&gt;
&lt;/exec&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Another similar workaround on Windows is to use a wrapper script and launch your program through it:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">// antRunAsync.js - Wrapper script to run an executable detached in the
// background from Ant's &lt;exec&gt; task.  This works by running the executable
// using the Windows Scripting Host WshShell.Run method which doesn't copy
// the standard filehandles stdin, stdout and stderr. Ant finds them closed
// and doesn't wait for the program to exit.
//
// requirements:
//   Windows Scripting Host 1.0 or better.  This is included with Windows
//   98/Me/2000/XP.  Users of Windows 95 or Windows NT 4.0 need to download
//   and install WSH support from
//   http://msdn.microsoft.com/scripting/.
//
// usage:
// &lt;exec executable="cscript.exe"&gt;
//   &lt;env key="ANTRUN_TITLE" value="Title for Window" /&gt;  &lt;!-- optional --&gt;
//   &lt;env key="ANTRUN_OUTPUT" value="output.log" /&gt;  &lt;!-- optional --&gt;
//   &lt;arg value="//NoLogo" /&gt;
//   &lt;arg value="antRunAsync.js" /&gt;  &lt;!-- this script --&gt;
//   &lt;arg value="real executable" /&gt;
// &lt;/exec&gt;


var WshShell = WScript.CreateObject("WScript.Shell");
var exeStr = "%comspec% /c";
var arg = "";
var windowStyle = 1;
var WshProcessEnv = WshShell.Environment("PROCESS");
var windowTitle = WshProcessEnv("ANTRUN_TITLE");
var outputFile = WshProcessEnv("ANTRUN_OUTPUT");
var OS = WshProcessEnv("OS");
var isWindowsNT = (OS == "Windows_NT");

// On Windows NT/2000/XP, specify a title for the window.  If the environment
// variable ANTRUN_TITLE is specified, that will be used instead of a default.
if (isWindowsNT) {
  if (windowTitle == "")
     windowTitle = "Ant - " + WScript.Arguments(i);
  exeStr += "title " + windowTitle + " &amp;&amp;";
}

// Loop through arguments quoting ones with spaces
for (var i = 0; i &lt; WScript.Arguments.count(); i++) {
  arg = WScript.Arguments(i);
  if (arg.indexOf(' ') &gt; 0)
    exeStr += " \"" + arg + "\"";
  else
    exeStr += " " + arg;
}

// If the environment variable ANTRUN_OUTPUT was specified, redirect
// output to that file.
if (outputFile != "") {
  windowStyle = 7;  // new window is minimized
  exeStr += " &gt; \"" + outputFile + "\"";
  if (isWindowsNT)
    exeStr += " 2&gt;&amp;1";
}

// WScript.Echo(exeStr);
// WshShell.Run(exeStr);
WshShell.Run(exeStr, windowStyle, false);</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;exec executable="cscript.exe"&gt;
   &lt;env key="ANTRUN_TITLE" value="Title for Window" /&gt;  &lt;!-- optional --&gt;
   &lt;env key="ANTRUN_OUTPUT" value="output.log" /&gt;  &lt;!-- optional --&gt;
   &lt;arg value="//NoLogo" /&gt;
   &lt;arg value="antRunAsync.js" /&gt;  &lt;!-- this script --&gt;
   &lt;arg value="real executable" /&gt;
&lt;/exec&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Another workaround for Windows is to schedule a permanent task and force running it from the Ant script.
For example, run the command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">C:\&gt;SCHTASKS /Create /RU SYSTEM /SC ONSTART /TN Tomcat /TR
"C:\Program Files\Apache Software Foundation\Tomcat 6.0\bin\startup.bat"</pre>
</div>
</div>
<div class="paragraph">
<p>Note, that <code>ONSTART</code> can be replaced with <code>ONCE</code> if you do not want to keep Tomcat running.
Add the following code to your Ant script:</p>
</div>
<div class="literalblock">
<div class="content">
<pre class="nowrap">&lt;exec executable="SCHTASKS"&gt;
    &lt;arg value="/Run"/&gt;
    &lt;arg value="/TN"/&gt;
    &lt;arg value="Tomcat"/&gt;
&lt;/exec&gt;</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<hr>
<div>
<div class="row">
<div class="col-md-4">
<a class="prev doc-page-link" href="../user-content">
⇐ User Content
</a>
</div>
<div class="col-md-4">
<a class="up doc-page-link" href="../">
⇑ Managing Jenkins
</a>
<a class="index doc-page-link" href="../../">
Index
</a>
</div>
<div class="col-md-4">
<a class="next doc-page-link" href="../../security">
Securing Jenkins ⇒
</a>
</div>
</div>
</div>
<hr>
<div class="container"></div>
<!-- starting partial _feedback-footer.html -->
<!-- HTML inclusion for chapter and section layouts (i.e. as footers) as well as
     for use in AsciiDoc file inclusions. -->

<!--
This feedback form was prepared from a Google Form, based on the techniques in
the following documentation sources:
https://codepen.io/learningcode/post/customize-a-google-form-for-your-website,
https://mrhaki.blogspot.com.au/2014/06/awesome-asciidoc-include-raw-html.html,
https://www.freshtechtips.com/2013/05/custom-google-drive-contact-form.html,
https://stackoverflow.com/questions/24436165/set-value-of-hidden-input-inside-form
-->

<!-- Feedback form functionality in JavaScript - refer to comments in this file
     for details on the functionality. -->
<script>
var feedbackForm = {
    formKey : 'e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w'
};
$(document).ready(function() {
    window.onload = feedbackForm.start(window.location.href);
});
</script>
<script src="/js/feedback-form-functionality.js"></script>

<p><a href="#feedback" data-bs-toggle="collapse">Was this page helpful?</a></p>

<div id="feedback" class="collapse">

<p>Please submit your feedback about this page through this
<a href="/doc/feedback-form/">quick form</a>.</p>

<p>Alternatively, if you don't wish to complete the quick form, you can simply
indicate if you found this page helpful?</p>

<!-- Redirects to custom "thank you" page once form is submitted. -->
<script type="text/javascript">
var submitted=false;
</script>
<iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"
onload="if(submitted) {window.location='/doc/thank-you-for-your-feedback/';}">
</iframe>
<form action="https://docs.google.com/forms/d/e/1FAIpQLSfCEexH09x_-ytEyE7wetizqOvE_-06WkK89dpBLEJcYnOp8w/formResponse" method="POST" id="ss-form" target="hidden_iframe" onsubmit="submitted=true;">

<!-- Set the value of the current URL into the form. -->
<input type="hidden" name="entry.1246830226" id="current-url" value=""/>

<!-- The answer bit -->
<p><input type="radio" name="entry.790002525" id="h1" value="Yes" required/>
<label for="h1">Yes</label>&nbsp;&nbsp;&nbsp;&nbsp;
<input type="radio" name="entry.790002525" id="h2" value="No"/>
<label for="h2">No</label></p>

<!-- The CAPTCHA bit -->

<p><label id="ssTestLabel" for="ssTestValue"></label><br/>
<input type="text" name="ssTestValue" value="" id="ssTestValue"/></p>

<!-- Submit button -->

<p><input class="button" type="submit" value="Submit"/></p>

</form>

<p>See existing feedback <a href="https://docs.google.com/spreadsheets/d/1IIdpVs39JDYKg0sLQIv-MNO928qcGApAIfdW5ohfD78" target="_blank" rel="noreferrer noopener">here</a>.</p>

</div>

<!-- ending partial _feedback-footer.html -->

</div>
</div>
</div>


<script src="/jenkins.io/independent-scrolling-patch/assets/bower/anchor-js/anchor.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/@popperjs/core/umd/popper.min.js"></script>
<script src="/jenkins.io/independent-scrolling-patch/assets/bower/bootstrap/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lit@2.5.0/polyfill-support.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.6.0/webcomponents-loader.js"></script>
<script data="ionicons" defer="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.esm.js" type="module"></script>
<script data="ionicons" defer="" nomodule="" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/5.5.2/ionicons/ionicons.js"></script>
<script defer="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/+esm" type="module"></script>
<script defer="" nomodule="" src="https://cdn.jsdelivr.net/npm/@jenkinsci/jenkins-io-components/"></script>
<jio-footer githubBranch="master" githubRepo="jenkins-infra/jenkins.io" property="https://www.jenkins.io" sourcePath="content//doc/book/managing/spawning-processes.adoc"></jio-footer>
<script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
 
ga('create', 'UA-000000-0', 'auto');
ga('send', 'pageview');
ga('set', 'anonymizeIp', true);

</script>

<script>
  $(function(){
    var $body = $(document.body);
    $body.on("keydown", function(){
      $body.removeClass("no-outline");
    })
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" type="text/javascript"></script>
<script type="text/javascript">
docsearch({
  container: document.querySelector('input.searchbox').parentNode,
  indexName: 'jenkins',
  appId: "M6L7Q4Z8HS",
  apiKey: "52f8dfbff76ffd9106f1c68fee16154b",
  algoliaOptions: { 'facetFilters': ["tags:en"] },
  debug: false
});
</script>
</body>
</html>
